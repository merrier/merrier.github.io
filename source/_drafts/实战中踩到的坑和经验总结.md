---
title: 实战中踩到的坑和经验总结
urlname: pits-stepped-on-in-actual-combat
id: 876
categories:
    - 总结
tags:
    - 技巧
    - 笔记
    - 经验
date: 2017-06-16 20:21:11
---

## antd-dayjs-webpack-plugin插件替换moment之后，TypeScript声明文件还是要求传参类型为moment.Moment

具体报错信息为：

```
类型“Dayjs”缺少类型“Moment”的以下属性: calendar, local, isLocal, utc 及其他 50 项。
```

在 [github issue](https://github.com/ant-design/antd-dayjs-webpack-plugin/issues/23) 上找到了解决方案，即把 Moment 声明改成 Dayjs：

```ts
declare module 'moment' {
  import { Dayjs } from 'dayjs'
  namespace moment {
    type Moment = Dayjs
  }
  export = moment
  export as namespace moment
}
```

## 复制图片至剪贴板

见：https://stackoverflow.com/questions/33175909/copy-image-to-clipboard

## Mac 系统安卓多个版本的 Chrome

具体的见：https://www.cnblogs.com/slmk/p/10015976.html

## Chrome 浏览器花屏

碰到了一个浏览器花屏的问题，表现类似下图：

<p align="center"><img src="https://00f74ba44b248df1810dff46e657382208fc000669-apidata.googleusercontent.com/download/storage/v1/b/monorail-prod.appspot.com/o/16%2Fattachments%2F88b324cc-1380-445d-a0fa-8f30cb80b00f?jk=AFshE3VfewbRMXafCcS7okC4nnm89HQQDhNDMgCRjVUJCiCmyuPzGvn5OtpjvPkyabt1NWj6QWtdthdfblyLjRkHAIyZmp_ZwohmIsC3bkQPAhWJJB9HeWspaLiasFUvj_hR3YspGqVnFmE4Smwhm_NaScfNlvA1S37QG0dRzTIfb_1fXD6ar5qV1vR1-LGjaK70R0AO4oM4oLyfwxegvhLT-cl28DO7toqEAgKpWbrQ8OeaayI0zZ3RmjpkOepZlebUwU-C2Un4XlTFHgrvHs2He1h8RU8Ij412yNi_6e6CAt1r2wBEtgSBD3Zfzs9ow7tAHVR5zHHSQuy5TDxbT8rq10ZFKV78U4WWQ_VVb1dx59kojKonJfFuqeWc6FqTiz2ULT0wO8t0iyBufw4PQpJ1tRqiwoTE-N_Zw59BWo6QjP2OA9MS-8dyZHKT_WThSFMJFv6d8f5MqimbuU40qIk7fUO3TesxoaYmJ9_rg6oggxFiixLWZKxAV3W2s-QYBhBdFas7rE0lXRi_2pINjymrVxpFkgkJI12OGNmUHwIyv0k6G9xQMMDvwpfAb6vIg0puUAYpKEyK22uMVoyjNd3lhDo2F8xGpah1MN0Nec8e3GJl3ds5ZSvIGunmt_3G_budoGrHG4-NB-4nBsT899XEghnxxGjfjbtJK_ood1_5BY-jzVjiCSYlQP59LyOWaY_Q3w6plic-xifDs9_1z-rX9vhrFdpFQbMq7LprBftYvNQ4hC5T1Ggw_sErfRgMK1TDQIR4u7TTG4FzU0CiXsN_jldGozu4x2KGZEhR4jeJqbZKPLZak1W-kWByn4geWWfeIXEPqZnRcJ9yU1Hi036V01HspTtdVtXdFv9AtFIPbEGjcTi31m5jZwccZNInVCC-v98cBlcp7f36-Oy3yw0R5wl5G5x6YlJuJYuSkuM4PXkRDSyyaLrR74SS9B-u1rM"></p>

这个是 [Chrome 的一个 bug](https://bugs.chromium.org/p/chromium/issues/detail?id=1068170)，可以通过禁掉 GPU 加速解决：访问 chrome://flags/#enable-gpu-rasterization，然后 disable 掉就可以了，当然有一些 Electron App 也有可能出现，那只能重启电脑解决了。。


## CSS 报错：Gradient has outdated direction syntax. New syntax is like `to left` instead of `right`

写渐变背景的时候遇到的一个报错，原因是这样写的渐变：

```css
.main {
    background-image: linear-gradient(top, rgba(0,0,0,1), rgba(0,0,0,0.2));
}
```

报错信息翻译过来就是：渐变有过时的方向语法。新语法与 “to left” 类似。
意思是这个写法过时了，需要加上 to，然后改变方向，比如 right 改为 to left，left 则改为 to right。改成下面这样就不报错了：

```css
.main {
    background-image: linear-gradient(to top, rgba(0,0,0,1), rgba(0,0,0,0.2));
}
```

## setTimeout和setInterval的程序休眠问题

背景是这样的：
在我们使用到 setTimeoutout 或者 setInterval 的时候，我们将浏览器最小化，过了一段时间后再打开，发现 setTimeou/setInterval 会暂时进入休眠状态，但并不是不执行程序，它会把 setInterval/setTimeout 的回调函数放在队列中,等浏览器再次打开的时候，一瞬间全部执行。这样就会出现一系列的问题，比如我在做一个弹幕的组件，使用 setTimeout 控制弹幕的发射，但是浏览器缩小后，过了很久打开，就会发现一下子很多弹幕出来，造成弹幕重叠；或者倒计时也会出现频繁闪烁时间跳跃的问题。那么如何解决呢？

**如果页面是不可见的时候，那么我们就清除定时器，如果页面可见的时候，那么我们重新开启定时器**

首先，先了解一下这几个 API：

* document.onvisibilitychange：只要页面中发生变化，不管是切换到其他页面还是把浏览器缩小，都会触发这个事件。
* document.hidden：这个是指前页面不是当前页面的时候，否则为 false
* document.visibilityState：当前页面可见性，有以下四个值：

1. visible：当前网页是可见或者是部分可见的
2. hidden：当前网页是不可见的
3. prerender：网页内容被预渲染并且用户不可见
4. unloaded：文档被卸载

使用以上 API，可以通过以下实现解决这个问题：

```js
document.onvisibilitychange = function () {
    if (document.visibilityState == "visible") {
        timer = setInterval(slidemove, 1000);
    }
    else {
        clearInterval(timer);
    }
}
```

上面的实现可能有兼容性问题，不过目前没有深入研究。

另外如果你是在小程序中，那么可以利用好微信小程序的生命周期，实现起来就更简单了：

```js
onShow() {
    _this.timerCheck = setTimeout(function () {}, 1000);
},
onHide() {
    clearTimeout(_this.timerCheck);
}
```

## git 解决远程仓库文件大小写问题

有一次为了规范项目目录，把项目的文件名称全都改成了小写。本地修改是没什么问题的，可提交到远程仓库后，问题就出来了：

<p align="center"><img src="https://upload-images.jianshu.io/upload_images/71635-c8acaea0291b3b42.png?imageMogr2/auto-orient/strip|imageView2/2/w/340/format/webp"></p>

如上图所示，出现了文件重复的情况，也就是远程仓库的文件并没有被修改，经过一番上网查询后找到了解决方案：

1. 设置本地 git 环境识别大小写，执行以下命令：

```bash
git config core.ignorecase false
```

2. 修改文件夹名称，全部改为小写，然后 push 到远程仓库。这时就会如我前面的图片所示，仓库里就会有重名的文件(文件夹)了。

3. 删除多余的文件

```bash
# 删除Header文件夹下的所有文件
$ git rm --cached src/components/Header -r
# 删除Footer文件夹下的所有文件
$ git rm --cached src/components/Footer -r
# 删除Menu文件夹下的所有文件
$ git rm --cached src/components/Menu -r
```

如果显示如下，说明操作成功：

```bash
rm 'src/components/Menu/Header.js'
rm 'src/components/Menu/Header.less'
...
```

4. 提交到远程仓库

```bash
# 添加到缓存
$ git add .
# 提交到本地
$ git commit -m 'rm files'
# 提交到远程仓库
& git push
```

这时，如果上面的步骤都顺利，那在远程仓库刷新一下，效果就符合预期了


## Chrome 访问 https 页面显示 ERR_CERT_INVALID，且无法跳过继续访问

在访问网页的时候，因为浏览器自身的安全设置问题，对于 https 的网页访问会出现安全隐私的提示，甚至无法访问对应的网站，尤其是 chrome 浏览器，主要表现是这样的：

<p align="center"><img src="https://image-static.segmentfault.com/263/743/2637435914-29d5f807da50ebd2_articlex"></p>

有以下几个解决方案：

### 方案一

在chrome该页面上，直接键盘敲入这12个字符：`thisisunsafe`

**注意：鼠标点击当前页面任意位置，让页面处于最上层即可输入**

### 方案二

访问：chrome://net-internals/#hsts，把对应的域名从 HSTS 中删除，如下图：

<p align="center"><img src="https://image-static.segmentfault.com/264/772/2647726935-5e5609623704c_articlex"></p>

### 方案三

访问：chrome://flags/#allow-insecure-localhost，允许无效证书选项：

<p align="center"><img src="https://image-static.segmentfault.com/359/244/3592449253-5e560a175d18d_articlex"></p>

### 方案四（Windows）

1. 找到你的Chrome快捷方式
2. 右键图标，选择属性
3. 找到“目标”文本框，里面的内容是你的 Chrome 程序路径，类似这样：`C:\Users\Administrator\AppData\Local\Google\Chrome\Application\chrome.exe`
4. 在这段文本的后面输入一个空格，然后输入`-ignore-certificate-errors`
5. 修改后的文本应该类似于这样：`C:\Users\Administrator\AppData\Local\Google\Chrome\Application\chrome.exe -ignore-certificate-errors`
6. 点击确定
7. 重新打开你的 Chrome 浏览器

### 方案五（Mac）

打开`/etc/chromium.d/default-flags`编辑，添加两行：

```bash
Disable HTTPS Error Report
export CHROMIUM_FLAGS="$CHROMIUM_FLAGS --ignore-certificate-errors --test-type"
```

其中`--ignore-certificate-errors`是重点，跳过不信任 Error。不加`--test-type`打开浏览器会有警告，加上之后就没事儿了。

## 父元素随子元素宽度自动撑开问题

想要实现的是父元素会根据子元素的宽度变化而自动撑满，直接上代码（可以 [点击这里](https://merrier.wang/code-demo/overflow/index.html) 直接查看最后实现效果）：

```html
<div class="father">
    <div class="child">
        <div></div>
    </div>
</div>
```

```less
.father {
    width: 200px; height: 400px; border: 1px solid red; overflow: auto;
    .child {
        background: #ccc;
        div {
            width: 400px; height: 900px;
        }
    }
}
```

得到的效果：

<p align="center"><img src="https://image-static.segmentfault.com/315/466/3154666447-5ae2f41227249_articlex"></p>

这里本来想要的是里面的`child`元素要随着它的子集`div`的宽度变化而自动撑满，但是得到的效果则是`child`元素宽度与`father`的宽度一致，这里我分析是因为`width`得到了它父元素的可视宽度。后来在`StackOverflow`上找到了想要的答案：

```less
.father {
    width: 200px; height: 400px; border: 1px solid red; overflow: auto;
    .child {
        background: #ccc;
        min-width: 100%; display: inline-block; // 这里加上这两个属性
        div {
            width: 400px; height: 900px;
        }
    }
}
```

这样就能完美实现想要的效果：

<p align="center"><img src="https://image-static.segmentfault.com/345/440/3454402268-5ae2f5d9659f0_articlex"></p>

还有一种实现方案是给`child`元素加上`display:table;`属性。

## Safari 10 can not declare a let variable twice 'e'

背景是一个 H5 页面在 iOS 10 出现白屏，而其他机型不会。手机连上电脑之后在电脑端的Safari里，看到了如下的报错：

```
SyntaxError: Cannot declare a let variable twice: 'e'.
```

可是我怎么可能把一个名为e的变量定义两次呢？然后就定位到报错的那行代码，看到了这样美丽的代码：　

```js
let e = e => {
    console.log(e);
    for (let e of [1, 2, 3])
        console.log(e);
};
```

况且很显然，这段代码是编译后的代码。经过查询之后发现这是 Safari 的一个 bug。他们在第十七万一千零四十一号 bug 中承认了自己的错误：

> We incorrectly throw a syntax error when declaring a top level for-loop iteration variable the same as a parameter
> 当你定义一个与参数同名的for循环迭代变量时，我们错误地认为这是一个语法错误。

那如何解决呢？

1. 进入`build`文件夹；
2. 找到`webpack.prod.conf.js`文件；
3. 在`UglifyPlugin`的定义里添加关于`mangle`的选项，使它变成下面这个样子：

```js
// 修改 webpack(v4.5) 配置文件
const UglifyJSPlugin = require('uglifyjs-webpack-plugin');

const config = {
    // ...
    minimizer: [
        new UglifyJSPlugin({
            cache: true,
            parallel: true,
            sourceMap: true,
            uglifyOptions: {
                safari10: true,
            },
        }),
    ],
    // ...
}

```

## git add 时 Argument list too long

背景是项目重构，然后 `git add .` 会提交很多文件，然后控制台报错：`Argument list too long`，查了一下，是因为脚本匹配到了非常多的文件，然后生成了一个非常长的命令，就无法执行了，解决思路就是用递归的方式依次执行 `git add` 命令，具体就是这样执行：

```sh
git ls-files --modified | xargs git add
```

然后正常执行 `git commit` 就可以了，关于这个问题的更多讨论可以查看：

* [How To: Solve: rm * : Argument list too long](https://community.webcore.cloud/tutorials/bash_bin_rm_argument_list_too_long_solution/)
* [Argument list too long error for rm, cp, mv commands](https://stackoverflow.com/questions/11289551/argument-list-too-long-error-for-rm-cp-mv-commands)
* [Recursively add files by pattern](https://stackoverflow.com/questions/2855140/recursively-add-files-by-pattern/43332460#43332460)

## NPM Error：gyp: No Xcode or CLT version detected!

安装 NPM 包的时候遇到了以下问题：

```sh
> node-gyp rebuild

gyp: No Xcode or CLT version detected!
gyp ERR! configure error
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/local/lib/node_modules/npm/node_modules/node-gyp/lib/configure.js:351:16)
gyp ERR! stack     at ChildProcess.emit (events.js:210:5)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:272:12)
```

可尝试使用如下命令进行修复：

```sh
xcode-select --install
```

不过如果已经安装过，可能会提示以下信息：

```sh
xcode-select: error: command line tools are already installed, use "Software Update" to install updates
```

没看懂上面提到的 `Software Update` 是什么意思，最后在 [Stack Overflow](https://github.com/schnerd/d3-scale-cluster/issues/7) 上找到了如下解决方案：

```sh
sudo rm -rf $(xcode-select -print-path)
xcode-select --install
```

其实这个命令就是重新安装 Xcode，也可以在[官网](https://developer.apple.com/download/more/)找到 `Command Line Tools for Xcode` 下载安装即可


## Xcode 找不到 Command Line Tools

我是在换新 Mac 电脑，迁移数据之后遇到的这个问题，在 Terminal 中输入 git 指令时报以下错：

```sh
sh: line 1:  1549 Abort trap: 6      /Applications/Xcode.app/Contents/Developer/usr/bin/xcodebuild -sdk / -find clang 2> /dev/null
clang: error: unable to find utility "clang", not a developer tool or in PATH
```

根据 [Stack Overflow 上的一个回答](https://stackoverflow.com/questions/30781214/troubles-when-i-use-homebrew)，我找到了解决方案：

1. 首先在 Terminal 中执行：`xcode-select --print-path`
2. 如果路径是：`/Applications/Xcode.app/Contents/Developer`，那么可以通过执行：`sudo xcode-select --switch /Library/Developer/CommandLineTools` 来设置命令行工具
3. 如果没有 `/Library/Developer/CommandLineTools` 文件夹，可以在 [官网](https://developer.apple.com/downloads/) 下载

## Safari 中的 cookie 问题

Safari 默认是不允许第三方网站跨域带 cookie 的，所以只能像客户端那样，通过 Header 来传递用户认证的 token 了。

## border-image 和 boder-radius 不兼容问题

我们在给 border 做渐变效果时会使用 border-image 这个属性，但是 border-image 和 border-radius 不能同时使用，为什么呢？

1. border-radius 是一个边框的样式，当没有边框的时候会作用到背景上。
2. border-image（[MDN](https://developer.mozilla.org/zh-CN/docs/Web/CSS/border-image)） 也是边框的一个属性，但是只有这个属性无法显示时才会显示 border 的默认样式，即：

```css
border:15px solid #F33;
```

所以一旦有了 border-image，浏览器应用了之后，border-radius 的属性会被覆盖即失效。如果想要在实现渐变效果的同时有圆角应该怎么做呢？有两种解决方案（[demo预览]()）：

### 方案一：伪元素

主要思路是将本来想作用在border上的渐变效果通过伪元素的背景色实现，然后因为 background-image 和 border-radius 不冲突，这样就间接的实现了想要的效果：

```css
.container{
    position: relative;
    border-radius: 20px;
    background: #fff;
}
.container:after{
    content: "";
	display: block;
	position: absolute;
	top: -5px;
	right: -5px;
	bottom: -5px;
	left: -5px;
	border-radius: 20px;
	background: linear-gradient(to top, red, orange, yellow);
	z-index: -1;
}
```

### 方案二：外层添加父元素

和方案一的实现思路类似，都是利用 background-image 间接实现 border 渐变效果，主要区别是通过在外层添加 padding 的方式来间接实现 border 效果：

```css
.container {
    background-image: linear-gradient(to top, red, orange, yellow);
    /* 相当于有个5px的 border */
    padding: 5px;
    border-radius: 20px;
}

.container-child{
    background: #fff;
    border-radius: 20px;
    height: 100%;
}
```

具体的demo可以[点击这里](//merrier.wang/code-demo/border-image/index.html)查看

## iPhone上的点击事件

有这样一段代码：
```javascript
<div class="name">点我</div>
$(document).on("click", ".name", function() {
    alert("name");
});
```
以上代码在电脑浏览器和安卓上都能触发 alert 事件，但是在 iOS 上却完全没有反应，是因为：**iPhone手机上的 div 元素没有 click 事件，只有 touch 事件**，就是说如果这个是 button 这种可 click 的元素，click 事件是可以触发的，但是 div 这种本身默认不可点击的元素就不能触发了，有以下两种解决方案：

### 给这个元素添加样式

```css
.name{
    cursor:pointer;
}
```

### 将 click 改为 touchstart

可以让 click 和 touchstart 共存：
```javascript
$(document).on("click touchstart", ".name", function() {
    alert("name");
});
```

本人推荐第一种解决方案，方便简单

## 结合 React Hooks 添加 Scroll 事件

如果单纯添加滚动事件，很简单：

```javascript
useEffect(() => {
    const onScroll = e => {
        const top = e.target.documentElement.scrollTop;
        // ...
    };
    window.addEventListener("scroll", onScroll);

    return () => window.removeEventListener("scroll", onScroll);
}, []);
```

但是如果你需要根据当前的 `scrollTop` 值判断是否在滚动的话，需要将 `scrollTop` 添加进依赖项，比如：

```javascript
useEffect(() => {
    const onScroll = e => {
        setScrollTop(e.target.documentElement.scrollTop);
        setScrolling(e.target.documentElement.scrollTop > scrollTop);
    };
    window.addEventListener("scroll", onScroll);

    return () => window.removeEventListener("scroll", onScroll);
}, [scrollTop]);
```

## antd 中 table rowKey 不一致导致 bug

antd 中的 rowKey 要求比较严格的一个属性，如果 rowKey 的值有重合会直接报 warning：

<div align='center'><img src='/images/hexo_post_352.png' alt=''/></div>

而 rowKey 不一致还会导致各种莫名其妙的 bug，如表格错位等

# 变量与选择器

需求是这样的，类似于标签页，当我点击某个 tab 时需要显示对应的 content，同时将其他 content 隐藏，所以一般都会这样写：

```javascript
var ip = \$(this).parents(".tab").attr("data-ip");

\$(".content").find(".content-item\[data-ip=" + ip + "\]").show().siblings().hide();
```

理论上这样写是没有问题的，但是如果你的 ip 从后台传过来的时候是以数字的形式传过来的话，在页面中展示是没有问题的，但是获取之后再用上面这种方法就会找不到该元素，原因就是如果没有变量的话，选择器是这样的$(".content-item\[data-ip='1000'\]"),也就是说data-ip一定要是个字符串，所以在用上面那种形式定位的时候，JS会先判断你的ip变量是否是字符串类型，如果不是就直接报错；所以正确的写法是强行加一对单引号' '在ip变量周围：$(".content-item\[data-ip='" + ip + "' \]")（注意单引号的位置）

# video 无法播放

video 作为 h5 新增的标签，自然问题不少，但是在开发的过程中遇到了之前从来没有遇到过的问题（之前也用的比较少），就是 video 无法播放的问题，经过排查，src 的路径是正确的，其他参数该有的都有，但是仍然无法播放，经过向前辈们请教，才发现新大陆：

## 1.video 和 audio 都有跨域问题

可以看一下[MDN 的这篇文章](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/video)，重点看一下 crossorigin 属性

## 2.video 中的 src 地址有猫腻

解决完跨域问题之后，发现仍然无法播放，所以就咨询了一下前辈，前辈看了一下我的 video 标签的 src 属性就发现了问题所在，因为有些网站为了自己的资源不被“非法人员”引用，同时也是为了节省自己网站流量，就会在自己视频的链接地址中加一些安全内容，比如 signature、cookie 相关代码，或者时间戳等常见保护措施，从而导致其他不在他“白名单”中的网站是没办法将他网站的视频加入到自己网站上的，所以就会出现无法正常播放的问题，解决方案很简单：联系视频来源网站或者换一家网站的视频

# django 模板中的数组索引

django 作为一个比较简单的前端 web 框架，其本身的 template 提供了很多功能，如变量、标签、过滤等，但是我在前端模板中想要通过索引获取数组中某一项时却遇到了麻烦，比如后来 render 的时候传给前端一个数组 array，我想取得 array 的第一项，大部分语言可以通过 array\[0\]获取到，然而在 django 中却报错：template syntex error；后来查阅了一些资料之后才知道，django 模板中的数组索引需要用小数点.来进行查找（array.0），援引[Django 模板系统](http://blog.csdn.net/zhangxinrun/article/details/8095118)中的解释，当模板系统遇到变量名里有小数点时会按以下顺序查找：

1.  **字典**查找，如**foo\["bar"\]**
2.  **属性**查找，如**foo.bar**
3.  **方法**调用，如**foo.bar()**
4.  列表的**索引**查找，如**foo\[bar\]**

小数点可以**多级纵深查询**，例如{ { person.name.upper }}表示字典查询 person\['name'\]然后调用 upper()方法；也就是说，**在 django 模板中是不存在"\[\]"的，小数点.可以达到各种你想要的结果！**

# jsonp 不是万能的

比如我现在页面的 url 是https://toutiao.com/...，然后我需要向www.toutiao.com请求数据，理论上这应该属于跨域，所以就需要设置ajax的dataType为jsonp类型，然后请求并没有发送成功，这是为什么呢？因为虽然当前页面的域名是toutiao.com，但是其实服务器已经做了重定向（301到了www.toutiao.com），所以如果向www.toutiao.com请求数据是不会跨域的，dataType改为json就可以了；但是有时候即便没有跨域，dataType设置为jsonp也是可以的，这又是为什么呢？因为看后台配不配合了，因为jsonp是需要前端和后端约定好jsonp的callback的，所以稳妥起见：**如果没有跨域，就不要用jsonp了！**

# 移动端慎用 tap

做过移动端的前端同学可能会知道，zepto 对于移动端封装了一个独特的事件叫做 tap，其行为特点和平常我们经常用到的 click 差不多，只不过 tap 更强调是“手指按一下屏幕而不是划过”，而 click 在移动端也会有延迟的问题，但是我在项目中遇到一个很坑的问题是：给一个元素绑定了 tap 事件，但是我按一下就会触发两次事件。后来把 tap 换成 click（移动端也可以用 click）之后就没有再出现这个问题了，所以如果你今后在开发移动端项目的时候碰到了 tap 事件，一定要谨慎啊！（后来查资料得知，有一个叫做[fastclick](https://github.com/ftlabs/fastclick)的插件可以解决 click 在移动端上的延迟问题，如果你对用户体验要求苛刻同时又想避免 tap 的“点透”问题，可以尝试一下这个插件） 推荐文章：[移动端 web，tap 与 click 事件](http://www.jianshu.com/p/19eebc1921b6)

# ant design select 问题

https://github.com/ant-design/ant-design/issues/4832

# Object 属性遍历问题

http://jartto.wang/2016/10/25/does-js-guarantee-object-property-order/

# IOS Javascript Date 的坑

http://www.iamaddy.net/2015/02/ios-javascript-date/

# 优化移动端 window.onscroll 的执行频率方案

https://zhuanlan.zhihu.com/p/32061260

# 移动端输入框填坑系列

http://www.alloyteam.com/2017/03/moves-the-input-box-fill-series-a/

# nodeJS 踩坑-记本地地址 127.0.0.1 与 0.0.0.0 的区别

https://www.imooc.com/article/7581

# H5 与 APP 混合开发遇到的问题总结

https://juejin.im/post/5aa8b00c51882555627cfa0e

# decodeURIComponent 报错的坑

https://cnodejs.org/topic/4fd6b7ba839e1e581407aac8 https://stackoverflow.com/questions/28063750/decodeuricomponent-throwing-an-error-uri-malformed

# -webkit-box-orient 不见了， webkit 和 autoprefixer 的坑

https://blog.csdn.net/sinat_24070543/article/details/79755285

# 移动端弹框后禁止背景屏幕滑动的解决方案

https://dancon.gitbooks.io/git-books/content/js/essay/dialog_forbid_back_scroll.html

## 无法生成 package-lock.json 文件

习惯用 cnpm 进行依赖的安装，但是有一次通过 cnpm install 时没有办法生成 / 更新 package-lock.json 文件，后来试了一下 npm install 就可以了。。所以如果你需要手动生成 package-lock.json 文件又不想用 npm install 命令时，可以尝试手动设置 registry：

```bash
npm --registry https://registry.npm.taobao.org install
```

如果安装不成功，尝试将 node_modules 文件夹删掉后再试试- -，npm 就是如此神奇。如果想更方便的切换源，可以安装 nrm：

```bash
npm i nrm -g
```

## || 和 &&

&& 和 || 是有优先级之分的（&& 的优先级为 6，|| 的优先级为 5），所以可以理解成 && 的结合优先级高于 ||，用人脑模拟一下就是加上小括号：

```javascript
console.log(true || (false && false)); // true
```

上面这道题可以理解为 `true || (false && false)`，所以结果为 true

### Markdown 编辑表格时如何输入竖线

https://blog.csdn.net/u013553529/article/details/51024733

## react 怎么实现点击空白关闭？

https://zhuanlan.zhihu.com/p/27721969

## -webkit-box-orient: vertical; 不生效

试试下面这段 CSS 代码：

```css
/* autoprefixer: off */
-webkit-box-orient: vertical;
/* autoprefixer: on */
```

## React 中插入 HTML 代码

```
dangerouslySetInnerHTML={{ __html: data }}
```

## prop-types 中的布尔类型

prop-types 中的布尔类型是 `bool`，而不是 `boolean`

## IOS Javascript Date 的坑

http://www.iamaddy.net/2015/02/ios-javascript-date/

## html2canvas font-size 解析错误

在 issue 中找到了答案：https://github.com/niklasvh/html2canvas/issues/1661#issuecomment-424327354，需要将 `font-variant` 属性设置为 normal

## moment() 对象问题

moment 是一个很知名的 JS 日期处理类库，但是在使用的时候遇到了一个坑，不过不是 moment 的问题，是 JS 本身语言特性导致。具体如下：首先，`moment()` 的返回值是一个 moment 对象，所以当我们对如下数组进行遍历时，最终得到的值会不符合预期：

```javascript
const momentNow = moment("2019-03-01", "YYYY-MM-DD");
const test = [momentNow.startOf("month"), momentNow.subtract(1, "weeks"), momentNow.subtract(30, "days")];

test.map(d => {
    console.log(d.unix()); // 1548172800 1548172800 1548172800
});
```

我们声明的 `momentNow` 是一个对象，所以当我们遍历时，其实是对这个对象进行了连续操作，像上面我们打印出来了三次相同的值，都是等于 `moment('2019-03-01', 'YYYY-MM-DD').startOf('month').subtract(1, 'weeks').subtract(30, 'days').unix()`，所以当我们想对一个 `moment` 对象进行遍历时，最好是 `分开声明`，不要缓存变量：

```javascript
const test = [
    moment("2019-03-01", "YYYY-MM-DD").startOf("month"),
    moment("2019-03-01", "YYYY-MM-DD").subtract(1, "weeks"),
    moment("2019-03-01", "YYYY-MM-DD").subtract(30, "days")
];

test.map(d => {
    console.log(d.unix()); // 1551369600 1550764800 1548777600
});
```

## focus() 不生效的问题

有时候会遇到 focus() 不生效的问题，尤其是这个 focus 事件在某元素的 click 事件中时，此时可以考虑将 click 事件换成 movedown 事件，然后 focus 放到 setTimeout 中，这样就可以解决不生效的问题。

## Git 默认不区分文件大小写

这是个很难察觉的问题，因为 git 默认对于文件名的大小写是不敏感的，所以如果你只是修改了文件名的大小写，git 是察觉不到的，会提示代码没有任何改动。。不过也可以通过配置让 git 识别文件名大小写变化：

### 第一种，更改 git 配置

```bash
git config core.ignorecase false
```

### 第二种，先删除再提交

```bash
# 删除
git rm readme.md
# 重新添加
git add Readme.md
# 提交
git commit -m 'Readme.md'
```

推荐第一种方法，第二种只能临时解决；关于为什么 git 会如此设计，可以参考知乎——[为什么 git 默认不区分文件夹大小写？](https://www.zhihu.com/question/57779034)

### 扩展阅读

-   [浅谈 blur 与 click 冲突的问题](https://blog.csdn.net/zhouziyu2011/article/details/53942285)
-   [关于 focus()不生效的问题](https://blog.csdn.net/jingjingshizhu/article/details/79802326)

## typescript 中 使用 react-router-dom 问题

在项目迁移 typescript 过程中，遇到了一个 react-router-dom 问题，下面的代码会报错：

```tsx
import * as React from "react";
import { withRouter } from "react-router-dom";

interface IProps {
    title: string;
}

class MyComp extends React.Component<IProps> {
    public render() {
        return <h1>{this.props.title}</h1>;
    }
}

export default withRouter(MyComp);
```

在 [stackoverflow](https://stackoverflow.com/questions/48219432/react-router-typescript-errors-on-withrouter-after-updating-version) 上面找到了解决方案：

```tsx
import * as React from "react";
import { RouteComponentProps, withRouter } from "react-router-dom";

interface IProps extends RouteComponentProps<any> {
    title: string;
}

class MyComp extends React.Component<IProps> {
    public render() {
        return <h1>{this.props.title}</h1>;
    }
}

export default withRouter<IProps>(MyComp);
```

## @types/XXX 文件安装之后仍不生效

在使用库 dom-to-image 时，需要手动安装类型定义文件：

```bash
npm install @types/dom-to-image -D
```

然而安装之后编辑器（VSCode）还是报错，然后重启编辑器之后就不报错了。。

## Antd Form 组件在 typescript 中的使用问题

在 TypeScript 中使用 Form.create() 可能会抛出类似下面的错误：

```bash
error TS2339: Property 'loading' does not exist on type 'IntrinsicAttributes & IntrinsicClassAttributes<Compone
nt<{}, ComponentState>> & Readonly<{ childr...'.
```

这是因为 props 的类型没有通过检查，以下是正确的方式（来自 [Antd 官方文档](<https://pro.ant.design/docs/uset-typescript-cn#Form.create()>)）：

```ts
import { FormComponentProps } from "antd/lib/form/Form";

interface IFormComponentProps extends FormComponentProps {
  test: string;
}

class FormComponent extends React.Component<IFormComponentProps> {
  constructor(props: IFormComponentProps) {
    super(props);
    ....
  }
  render() {
    const { getFieldDecorator } = this.props.form;
    return ....;
  }
}
```

## 其他人遇到的问题和解决方案

- [关于 input 的一些问题解决方法分享](https://juejin.im/post/5af68903f265da0b84557fab)
- [移动端常见 bug 汇总 001](https://juejin.im/post/5af918636fb9a07ac5603ecb)
- [JavaScript 复制内容到剪贴板](https://github.com/axuebin/articles/issues/26)
- [移动 Web 开发问题和优化小结](https://juejin.im/post/59c4c9d85188254f58412d17)
- [移动端输入框填坑系列（一）](http://www.alloyteam.com/2017/03/moves-the-input-box-fill-series-a/)
- [移动端H5页面开发坑点指南](https://juejin.im/post/5dafc3df5188257a63539c64)
- [https://juejin.im/post/5d6e1899e51d453b1e478b29](https://juejin.im/post/5d6e1899e51d453b1e478b29)