{"name":"jQuery","postlist":[{"title":"jQuery事件：不要再(滥)用return false了","slug":"jQuery事件：不要再(滥)用return false了","date":"2017-08-03T10:25:21.000Z","updated":"2019-02-07T13:01:36.415Z","comments":true,"path":"api/articles/jQuery事件：不要再(滥)用return false了.json","excerpt":null,"keywords":"merrier 博客 前端 北邮人","cover":null,"content":"<p>无意中在 stackoverflow 上看到一个<a href=\"https://stackoverflow.com/questions/1357118/event-preventdefault-vs-return-false\" target=\"_blank\" rel=\"noopener\">关于jQuery中event.preventDefault()和return false的提问</a>，后来从评论中发现一篇<a href=\"https://web.archive.org/web/20160614140933/http://fuelyourcoding.com/jquery-events-stop-misusing-return-false/\" target=\"_blank\" rel=\"noopener\">关于这个问题的很不错的文章</a>，遂翻译了一下，希望能够帮助大家更好的理解 jQuery 中的 return false；当你刚开始学习 jQuery 中的事件时，也许你首先碰到的知识点就是“取消浏览器的默认行为”这一概念。比如，一个讲 click 的初级教程里可能会有如下代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$(<span class=\"string\">\"a.toggle\"</span>).click(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    $(<span class=\"string\">\"#mydiv\"</span>).toggle();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>; <span class=\"comment\">// 禁止浏览器访问'#'</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>上面这个方法动态的控制 #mydiv 的显示与隐藏，然后取消了浏览器的默认行为——访问锚标签的 href，这是一个非常简单的例子，同时也让很多前端小白养成了使用 return false 取消浏览器默认行为的习惯。关于取消浏览器事件这一问题，我将从以下两个主题重点讲解：</p>\n<ul>\n<li>使用正确的方法：return false、preventDefault、stopPropagation 和 stopImmediatePropagation</li>\n<li>头部、底部或中间某个位置：我们应该在事件回调函数的哪个位置取消默认行为？</li>\n</ul>\n<h2 id=\"使用正确的方法\"><a href=\"#使用正确的方法\" class=\"headerlink\" title=\"使用正确的方法\"></a>使用正确的方法</h2><p>之所以 return false 被大量滥用，是因为它确实满足了我们的需求——超链接不再跳转，表单也不再提交等等，那么为什么我说好多人都误用了呢？</p>\n<h3 id=\"return-false-到底做了什么\"><a href=\"#return-false-到底做了什么\" class=\"headerlink\" title=\"return false 到底做了什么\"></a>return false 到底做了什么</h3><p>首先，大部分人都没有搞明白的是，jQuery 中的 return false 其实做了下面三件事：</p>\n<ol>\n<li><strong>event.preventDefault();</strong></li>\n<li><strong>event.stopPropagation();</strong></li>\n<li><strong>阻止剩下的代码执行，同时立即返回</strong></li>\n</ol>\n<p>“等一下”。你是不是很惊讶，大部分人用 return false 其实只是为了阻止默认行为，也就是上面的第一件事，另外两件其实根本不需要。上面3件事中，只有 event.preventDefault() 会取消默认行为。除非你真的打算阻止事件冒泡，否则使用 return false 将大大增加你的代码的脆弱性。让我们来看看现实应用中这种滥用是如何产生的： 我们有如下HTML代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"post\"</span>&gt;</span><br><span class=\"line\">    &lt;h2&gt;<span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"/path/to/page\"</span>&gt;</span>My Page<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span></span><br><span class=\"line\">    &lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"content\"</span>&gt;</span><br><span class=\"line\">        Teaser text...</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;/</span>div&gt;</span><br><span class=\"line\">&lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"post\"</span>&gt;</span><br><span class=\"line\">    &lt;h2&gt;<span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"/path/to/other_page\"</span>&gt;</span>My Other Page<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span></span><br><span class=\"line\">    &lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"content\"</span>&gt;</span><br><span class=\"line\">        Teaser text...</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;/</span>div&gt;</span><br></pre></td></tr></table></figure>\n<p>现在我们想实现这样的功能：当用户点击标题链接时，跳转到相应的 div.content 上面，我们可能会写出这样的 jQuery 代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jQuery(<span class=\"built_in\">document</span>).ready(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">$</span>) </span>&#123;</span><br><span class=\"line\">   $(<span class=\"string\">\"div.post h2 a\"</span>).click(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> a = $(<span class=\"keyword\">this</span>),</span><br><span class=\"line\">          href = a.attr(<span class=\"string\">'href'</span>), <span class=\"comment\">// \b获取href,</span></span><br><span class=\"line\">          content  = a.parent().next();</span><br><span class=\"line\">      content.load(href + <span class=\"string\">\" #content\"</span>);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span>; <span class=\"comment\">// 取消链接跳转这种默认行为</span></span><br><span class=\"line\">   &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>目前，我们的页面一切正常。然后，我们又想要添加一个功能：当 div.post（或者它的子元素）被点击时，给当前被点击的 div.post 添加一个 “active” 类。所以，我们需要添加一个 click 事件：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> posts = $(<span class=\"string\">\"div.post\"</span>);</span><br><span class=\"line\">posts.click(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    posts.removeClass(<span class=\"string\">\"active\"</span>);  <span class=\"comment\">// \b移除所有div.post的active类</span></span><br><span class=\"line\">    $(<span class=\"keyword\">this</span>).addClass(<span class=\"string\">\"active\"</span>);  <span class=\"comment\">// 给当前的div.post添加active类</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>现在测试一下，当我们点击标题链接的时候，它会起作用吗？不会！它不能起作用的原因是我们在点击事件中 return false 了。而 return false 实际上意味着执行了 event.preventDefault() 和 event.stopPropagation()。所以点击事件不会冒泡到 div.post 上，从而我们新添加的事件将不起作用。 当我们将正常绑定的事件和 live 以及 delegate 绑定的事件混用时，它也会出现问题：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$(<span class=\"string\">\"a\"</span>).click(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// do something</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">$(<span class=\"string\">\"a\"</span>).live(<span class=\"string\">\"click\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 这里的代码将不起作用</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h3 id=\"我们真正想要实现什么？\"><a href=\"#我们真正想要实现什么？\" class=\"headerlink\" title=\"我们真正想要实现什么？\"></a>我们真正想要实现什么？</h3><h4 id=\"preventDefault\"><a href=\"#preventDefault\" class=\"headerlink\" title=\"preventDefault()\"></a>preventDefault()</h4><p>在大多数场景下，当我们使用 return false 的时候，我们真正想要的其实是 e.preventDefault()。使用 preventDefault 的前提是你允许在你的函数中访问事件对象（在后面的例子中以 e 表示事件对象）：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$(<span class=\"string\">\"a\"</span>).click(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// e代表我们的事件对象</span></span><br><span class=\"line\">    e.preventDefault();</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>这个方法就可以是实现取消默认行为，但是它不能阻止事件冒泡。但是，代码的功能越单一，它的可维护性就更强</p>\n<h4 id=\"stopPropagation\"><a href=\"#stopPropagation\" class=\"headerlink\" title=\"stopPropagation()\"></a>stopPropagation()</h4><p>有些时候我们只是想阻止事件冒泡，比如下面的栗子：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"post\"</span>&gt;</span></span><br><span class=\"line\">    Normal text and then a <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"/path\"</span>&gt;</span>link<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span> and then more text.</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>现在，比如我们有一个非常“奇特”的需求：我们想让用户点击 div 中除了链接之外的任何地方都干一件事（可能是重定向到其他页面），然后还想让用户点击链接的时候可以正常跳转（从可用性的角度来看，这是一个非常糟糕的 idea。因为如果用户本意想点击链接却点到了其他地方，接下来发生的事情可能会让用户很吃惊，影响用户体验）</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$(<span class=\"string\">\"div.post\"</span>).click(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">   <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">$(<span class=\"string\">\"div.post a\"</span>).click(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 在这里不要取消默认行为</span></span><br><span class=\"line\">    <span class=\"comment\">// 需要阻止事件冒泡</span></span><br><span class=\"line\">    e.stopPropagation();</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>在这个例子中，如果我们用 return false，那 div 的点击事件将永远不会触发，这样用户就不会被引导到正确的页面。</p>\n<h4 id=\"stopImmediatePropagation\"><a href=\"#stopImmediatePropagation\" class=\"headerlink\" title=\"stopImmediatePropagation()\"></a>stopImmediatePropagation()</h4><p>这个函数将阻止事件的进一步执行，即使是同一对象上绑定的不同事件。因为绑定到一个 dom 元素的所有事件都将按照它们被绑定的顺序执行。下面是一个栗子：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$(<span class=\"string\">\"div a\"</span>).click(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">   <span class=\"comment\">// Do something</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">$(<span class=\"string\">\"div a\"</span>).click(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">   <span class=\"comment\">// Do something else</span></span><br><span class=\"line\">   e.stopImmediatePropagation();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">$(<span class=\"string\">\"div a\"</span>).click(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">   <span class=\"comment\">// 这里将不会执行</span></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">$(<span class=\"string\">\"div\"</span>).click(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">   <span class=\"comment\">// 这里也不会执行</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>如果你认为这个例子看起来太假了，不得不说，是很假。然而，有时候这种情况确实会发生。当你构造更加复杂的代码时，代码结构会变得比较混乱，不同的组件和插件可能会给同一个 dom 元素添加事件。在这种情况下，正确的理解和使用 stopImmediatePropagation() 就显得尤为重要了。</p>\n<h4 id=\"return-false\"><a href=\"#return-false\" class=\"headerlink\" title=\"return false\"></a>return false</h4><p>只有当你同时需要 preventDefault() 和 stopPaopagation() 时，才需要使用 return false。与此同时，你的代码应该保证只有到回调函数的尾部才取消默认行为。我强烈反对您在为 jQuery 小白编写的实例中使用这个 return false。它会误导一些入门开发者，因为只有很清楚它的功能你才能正确的使用它。</p>\n<h2 id=\"头部，底部还是中间的某个地方？\"><a href=\"#头部，底部还是中间的某个地方？\" class=\"headerlink\" title=\"头部，底部还是中间的某个地方？\"></a>头部，底部还是中间的某个地方？</h2><p>之前，当你(滥)用 return false 时，它总是出现在函数的底部，或者至少在某个特定逻辑行的结尾处，因为它会组织后面的代码执行。但是我们有 e.preventDefault，所以我们有了更多选择。e.preventDefault 可以在函数执行过程中的任何时候调用。那么应该把它放在哪里呢？</p>\n<h3 id=\"在开发环境，它应该总是放在第一行\"><a href=\"#在开发环境，它应该总是放在第一行\" class=\"headerlink\" title=\"在开发环境，它应该总是放在第一行\"></a>在开发环境，它应该总是放在第一行</h3><p>对于一个表单，你想做的最后一件事往往是，你希望通过 ajax 的方式将表单提交到另一个网页，同时你尝试在回调函数中调试 JavaScript 产生的 bug</p>\n<h3 id=\"在生产环境，如果还有其他功能待开发，请将它放在回调函数的底部或者执行过程的末尾\"><a href=\"#在生产环境，如果还有其他功能待开发，请将它放在回调函数的底部或者执行过程的末尾\" class=\"headerlink\" title=\"在生产环境，如果还有其他功能待开发，请将它放在回调函数的底部或者执行过程的末尾\"></a>在生产环境，如果还有其他功能待开发，请将它放在回调函数的底部或者执行过程的末尾</h3><p>如果你是在一个开发完的页面上添加功能，那么你的链接点击事件或者表单提交事件需要对于不支持 JS 的浏览器的服务器端的反馈。这里的好处在于，与不支持 JS 的浏览器无关，而是你的代码在那些浏览器中会抛出错误。下面有一个示例：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> data = &#123;&#125;;</span><br><span class=\"line\">$(<span class=\"string\">\"a\"</span>).click(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    e.preventDefault(); <span class=\"comment\">// 取消默认行为</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// 抛出一个错误，因为my是undefined</span></span><br><span class=\"line\">    $(<span class=\"string\">\"body\"</span>).append(data.my.link);</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// 链接将不起作用</span></span><br><span class=\"line\">    <span class=\"comment\">// JS的执行将终端，用户将不知所措</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>现在，让我们看一下同样的问题出现在 preventDefault 放在末尾时候的表现：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> data = &#123;&#125;;</span><br><span class=\"line\">$(<span class=\"string\">\"a\"</span>).click(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// \b抛出错误，因为my是undefined</span></span><br><span class=\"line\">    $(<span class=\"string\">\"body\"</span>).append(data.my.link);</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// 这里将不会执行，此时你的网页将使用“href”</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    e.preventDefault(); <span class=\"comment\">// 取消默认行为</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>这个例子同样适用于表单提交事件，可以让你有适当的回退选择。所以，千万不要指望你的代码永远都会正确执行。计划好回退方案比盼望着不会报错要好得多！</p>\n<h3 id=\"在生产环境中，如果你的功能只与-JS-有关，请放在第一行\"><a href=\"#在生产环境中，如果你的功能只与-JS-有关，请放在第一行\" class=\"headerlink\" title=\"在生产环境中，如果你的功能只与 JS 有关，请放在第一行\"></a>在生产环境中，如果你的功能只与 JS 有关，请放在第一行</h3><p>它不一定是函数中的第一行，但是它应该在你的程序逻辑中的最开始位置。原因是这样的：如果功能的这一部分一开始是与 JS 相关的，那么回退就不是那么必要了。在这种情况下，回退只是会造成一个随机的“#”出现在 URL 中或者页面跳转的区别。很明显，我们需要做的事提供尽可能多的错误处理方案，从而确保用户不会觉得它们的努力是白费的。</p>\n<h2 id=\"结论\"><a href=\"#结论\" class=\"headerlink\" title=\"结论\"></a>结论</h2><p>我希望这篇文章在你对于取消事件进行选择时提供了足够多的信息。记住只有在你真正需要 return false 时采去使用它，同时确保在你的回调函数的正确位置取消了默认行为。程序员的目标就是让你的代码尽可能的灵活，所以不要再用 return false 了！</p>\n","raw":null,"categories":[{"name":"stackoverflow","path":"api/categories/stackoverflow.json"}],"tags":[{"name":"stackoverflow","path":"api/tags/stackoverflow.json"},{"name":"jQuery","path":"api/tags/jQuery.json"}]},{"title":"一些实用的JS和jQuery方法","slug":"一些实用的JS和jQuery方法","date":"2017-03-15T07:56:27.000Z","updated":"2019-02-07T13:01:36.415Z","comments":true,"path":"api/articles/一些实用的JS和jQuery方法.json","excerpt":null,"keywords":"merrier 博客 前端 北邮人","cover":null,"content":"<p>这里总结了一些常用的 JS/jQuery 方法，都是一些在项目中经常遇到的功能需求，如果你有更多的建议，欢迎留言</p>\n<blockquote>\n<p>更新于 2018-02-11：在我的github（<a href=\"https://github.com/merrier/common-js\" target=\"_blank\" rel=\"noopener\">common-js</a>）上对一些常用的方法进行了总结，都是一些短小精悍但是颇为实用的封装函数，欢迎 star 或 fork:)</p>\n</blockquote>\n<h2 id=\"1、简单的图片预览\"><a href=\"#1、简单的图片预览\" class=\"headerlink\" title=\"1、简单的图片预览\"></a>1、简单的图片预览</h2><p>这个方法就是普通的上传图片并预览功能，不包含进度条以及大小和格式的判断</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//------------------获取图片url地址---------------</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getObjectURL</span>(<span class=\"params\">file</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> url = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.createObjectURL!=<span class=\"literal\">undefined</span>) &#123; <span class=\"comment\">// basic</span></span><br><span class=\"line\">    url = <span class=\"built_in\">window</span>.createObjectURL(file) ;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.URL!=<span class=\"literal\">undefined</span>) &#123; <span class=\"comment\">// mozilla(firefox)</span></span><br><span class=\"line\">    url = <span class=\"built_in\">window</span>.URL.createObjectURL(file) ;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.webkitURL!=<span class=\"literal\">undefined</span>) &#123; <span class=\"comment\">// webkit or chrome</span></span><br><span class=\"line\">    url = <span class=\"built_in\">window</span>.webkitURL.createObjectURL(file) ;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> url ;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//---------------上传图片按钮点击------------</span></span><br><span class=\"line\">$(<span class=\"string\">\".btn_upload_file\"</span>).change(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> picurl = getObjectURL(<span class=\"keyword\">this</span>.files[<span class=\"number\">0</span>]);</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(picurl)&#123;</span><br><span class=\"line\">    $(<span class=\"string\">\".div_show_pic\"</span>).show().attr(<span class=\"string\">\"src\"</span>,picurl);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"2、实现-sleep-函数\"><a href=\"#2、实现-sleep-函数\" class=\"headerlink\" title=\"2、实现 sleep 函数\"></a>2、实现 sleep 函数</h2><p>很多语言都有 sleep 函数，显然 js 没有，所以需要其他的方法“模拟”实现 sleep 函数</p>\n<h3 id=\"方法一：通过比较当前时间\"><a href=\"#方法一：通过比较当前时间\" class=\"headerlink\" title=\"方法一：通过比较当前时间\"></a>方法一：通过比较当前时间</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sleep</span>(<span class=\"params\">numberMillis</span>) </span>&#123; </span><br><span class=\"line\">  <span class=\"keyword\">var</span> now = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(); </span><br><span class=\"line\">  <span class=\"keyword\">var</span> exitTime = now.getTime() + numberMillis; </span><br><span class=\"line\">  <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123; </span><br><span class=\"line\">    now = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(); </span><br><span class=\"line\">    <span class=\"keyword\">if</span> (now.getTime() &gt; exitTime) </span><br><span class=\"line\">      <span class=\"keyword\">return</span>; </span><br><span class=\"line\">  &#125; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"方法二：jQuery-中的-delay-方法\"><a href=\"#方法二：jQuery-中的-delay-方法\" class=\"headerlink\" title=\"方法二：jQuery 中的 $.delay() 方法\"></a>方法二：jQuery 中的 $.delay() 方法</h3><p>下面这个例子：在 slideUp() 和 .fadeIn() 之间延时 800 毫秒</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$(<span class=\"string\">'#foo'</span>).slideUp(<span class=\"number\">300</span>).delay(<span class=\"number\">800</span>).fadeIn(<span class=\"number\">400</span>);</span><br></pre></td></tr></table></figure>\n<h3 id=\"方法三：setTimeout\"><a href=\"#方法三：setTimeout\" class=\"headerlink\" title=\"方法三：setTimeout\"></a>方法三：setTimeout</h3><p>假设有三个步骤，步骤之间需要暂停一段时间；可以采用如下的方法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">firstStep</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//do something</span></span><br><span class=\"line\">  setTimeout(<span class=\"string\">\"secondStep()\"</span>, <span class=\"number\">1000</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">secondStep</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//do something</span></span><br><span class=\"line\">  setTimeout(<span class=\"string\">\"thirdStep()\"</span>, <span class=\"number\">1000</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">thirdStep</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//do something</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"方法四：ES6-的-promise\"><a href=\"#方法四：ES6-的-promise\" class=\"headerlink\" title=\"方法四：ES6 的 promise\"></a>方法四：ES6 的 promise</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'Hello'</span>)</span><br><span class=\"line\">  <span class=\"keyword\">await</span> sleep(<span class=\"number\">1000</span>)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'world!'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sleep</span>(<span class=\"params\">ms</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> setTimeout(resolve, ms))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">test();</span><br></pre></td></tr></table></figure>\n<h2 id=\"3、复制内容后面附加额外内容\"><a href=\"#3、复制内容后面附加额外内容\" class=\"headerlink\" title=\"3、复制内容后面附加额外内容\"></a>3、复制内容后面附加额外内容</h2><p>复制网页上面内容时，自动在剪切板内容后面加上网站信息，这样也利于 SEO 优化：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">document</span>.body.oncopy = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;  </span><br><span class=\"line\">  setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>)</span>&#123;   </span><br><span class=\"line\">    <span class=\"keyword\">var</span> text = clipboardData.getData(<span class=\"string\">\"text\"</span>);  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> (text) &#123;</span><br><span class=\"line\">      text = text + <span class=\"string\">\"\\\\r\\\\n本篇文章来源于 www.地址.COM 原文链接：\"</span>+location.href;   </span><br><span class=\"line\">      clipboardData.setData(<span class=\"string\">\"text\"</span>, text); </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;, <span class=\"number\">100</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"4、很简单的省略字数\"><a href=\"#4、很简单的省略字数\" class=\"headerlink\" title=\"4、很简单的省略字数\"></a>4、很简单的省略字数</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$(<span class=\"string\">\".omit_word_class\"</span>).each(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> ntext = $(<span class=\"keyword\">this</span>).text();</span><br><span class=\"line\">  <span class=\"keyword\">var</span> nlen = $(<span class=\"keyword\">this</span>).text().length;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(nlen&gt; <span class=\"number\">7</span>)&#123;</span><br><span class=\"line\">    $(<span class=\"keyword\">this</span>).text(ntext.substring(<span class=\"number\">0</span>,<span class=\"number\">7</span>) + <span class=\"string\">\"...\"</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"5、JS-的动画帧\"><a href=\"#5、JS-的动画帧\" class=\"headerlink\" title=\"5、JS 的动画帧\"></a>5、JS 的动画帧</h2><p>关于 requestAnimationFrame，我对它的理解也很浅层，推荐这篇<a href=\"http://www.zhangxinxu.com/wordpress/2013/09/css3-animation-requestanimationframe-tween-%E5%8A%A8%E7%94%BB%E7%AE%97%E6%B3%95/\" target=\"_blank\" rel=\"noopener\">张鑫旭对于requestAnimationFrame的讲解</a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.requestAnimFrame = (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span>  <span class=\"built_in\">window</span>.requestAnimationFrame       ||</span><br><span class=\"line\">          <span class=\"built_in\">window</span>.webkitRequestAnimationFrame ||</span><br><span class=\"line\">          <span class=\"built_in\">window</span>.mozRequestAnimationFrame    ||</span><br><span class=\"line\">          <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> callback </span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">window</span>.setTimeout(callback, <span class=\"number\">1000</span> / <span class=\"number\">60</span>);</span><br><span class=\"line\">          &#125;;</span><br><span class=\"line\">&#125;)();</span><br></pre></td></tr></table></figure>\n<h2 id=\"6、JS-判断字符串长度\"><a href=\"#6、JS-判断字符串长度\" class=\"headerlink\" title=\"6、JS 判断字符串长度\"></a>6、JS 判断字符串长度</h2><p>方法一，给 String 的 prototype 添加方法</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">String</span>.prototype.gblen = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;    </span><br><span class=\"line\">  <span class=\"keyword\">var</span> len = <span class=\"number\">0</span>;    </span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>; i&lt;<span class=\"keyword\">this</span>.length; i++) &#123;    </span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.charCodeAt(i)&gt;<span class=\"number\">127</span> || <span class=\"keyword\">this</span>.charCodeAt(i)==<span class=\"number\">94</span>) &#123;    </span><br><span class=\"line\">      len += <span class=\"number\">2</span>;    </span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;    </span><br><span class=\"line\">      len ++;    </span><br><span class=\"line\">    &#125;    </span><br><span class=\"line\">  &#125;    </span><br><span class=\"line\">  <span class=\"keyword\">return</span> len;    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"方法二，利用-ASCII-码\"><a href=\"#方法二，利用-ASCII-码\" class=\"headerlink\" title=\"方法二，利用 ASCII 码\"></a>方法二，利用 ASCII 码</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">strlen</span>(<span class=\"params\">str</span>)</span>&#123;  </span><br><span class=\"line\">  <span class=\"keyword\">var</span> len = <span class=\"number\">0</span>;  </span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">0</span>; i&lt;str.length; i++) &#123;   </span><br><span class=\"line\">    <span class=\"keyword\">var</span> c = str.charCodeAt(i);   </span><br><span class=\"line\">    <span class=\"comment\">//单字节加1   </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((c &gt;= <span class=\"number\">0x0001</span> &amp;&amp; c &lt;= <span class=\"number\">0x007e</span>) || (<span class=\"number\">0xff60</span>&lt;=c &amp;&amp; c&lt;=<span class=\"number\">0xff9f</span>)) &#123;   </span><br><span class=\"line\">      len++;   </span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> &#123;   </span><br><span class=\"line\">      len+=<span class=\"number\">2</span>;   </span><br><span class=\"line\">    &#125;   </span><br><span class=\"line\">  &#125;   </span><br><span class=\"line\">  <span class=\"keyword\">return</span> len;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"方法三：把双字节的替换成两个单字节的然后再获得长度\"><a href=\"#方法三：把双字节的替换成两个单字节的然后再获得长度\" class=\"headerlink\" title=\"方法三：把双字节的替换成两个单字节的然后再获得长度\"></a>方法三：把双字节的替换成两个单字节的然后再获得长度</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getBLen = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">str</span>) </span>&#123;  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (str == <span class=\"literal\">null</span>) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> str != <span class=\"string\">\"string\"</span>)&#123;  </span><br><span class=\"line\">    str += <span class=\"string\">\"\"</span>;  </span><br><span class=\"line\">  &#125;  </span><br><span class=\"line\">  <span class=\"keyword\">return</span> str.replace(<span class=\"regexp\">/[^\\\\x00-\\\\xff]/g</span>,<span class=\"string\">\"01\"</span>).length;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"7、jQuery-控制超出规定长度显示省略号\"><a href=\"#7、jQuery-控制超出规定长度显示省略号\" class=\"headerlink\" title=\"7、jQuery 控制超出规定长度显示省略号\"></a>7、jQuery 控制超出规定长度显示省略号</h2><p>给需要显示省略号的标签设置 class 为 displayPart，然后设置自定义属性 displayLength，该属性为可显示长度（不包含…），该方法会区分中英文，中文字符相当于两个字节</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$.fn.extend(&#123; </span><br><span class=\"line\">  displayPart:<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"keyword\">var</span> displayLength = <span class=\"number\">100</span>; </span><br><span class=\"line\">    displayLength = <span class=\"keyword\">this</span>.attr(<span class=\"string\">\"displayLength\"</span>) || displayLength; </span><br><span class=\"line\">    <span class=\"keyword\">var</span> text = <span class=\"keyword\">this</span>.text(); </span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!text) <span class=\"keyword\">return</span> <span class=\"string\">\"\"</span>; </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> result = <span class=\"string\">\"\"</span>; </span><br><span class=\"line\">    <span class=\"keyword\">var</span> count = <span class=\"number\">0</span>; </span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; displayLength; i++) &#123; </span><br><span class=\"line\">      <span class=\"keyword\">var</span> _char = text.charAt(i); </span><br><span class=\"line\">      <span class=\"keyword\">if</span> (count &gt;= displayLength) <span class=\"keyword\">break</span>; </span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"regexp\">/[^x00-xff]/</span>.test(_char)) count++; <span class=\"comment\">//双字节字符，//[u4e00-u9fa5]中文 </span></span><br><span class=\"line\">      result += _char; </span><br><span class=\"line\">      count++; </span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">    <span class=\"keyword\">if</span> (result.length &lt; text.length) &#123; </span><br><span class=\"line\">      result += <span class=\"string\">\"...\"</span>; </span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">    <span class=\"keyword\">this</span>.text(result); </span><br><span class=\"line\">  &#125; </span><br><span class=\"line\">&#125;); </span><br><span class=\"line\"></span><br><span class=\"line\">$(<span class=\"string\">\".displayPart\"</span>).each(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  $(<span class=\"keyword\">this</span>).displayPart();</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"8、去除字符串首尾的空白字符\"><a href=\"#8、去除字符串首尾的空白字符\" class=\"headerlink\" title=\"8、去除字符串首尾的空白字符\"></a>8、去除字符串首尾的空白字符</h2><p>如果引入了 jQuery，可以直接利用 $.trim() 方法，如果没有就需要用到下面的正则表达式</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">trim</span>(<span class=\"params\">ostr</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ostr.replace(<span class=\"regexp\">/^\\\\s+|\\\\s+$/g</span>,<span class=\"string\">\"\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"9、判断数组中是否包含某个元素\"><a href=\"#9、判断数组中是否包含某个元素\" class=\"headerlink\" title=\"9、判断数组中是否包含某个元素\"></a>9、判断数组中是否包含某个元素</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [ <span class=\"string\">\"xml\"</span>, <span class=\"string\">\"html\"</span>, <span class=\"string\">\"css\"</span>, <span class=\"string\">\"js\"</span> ];  </span><br><span class=\"line\">$.inArray(<span class=\"string\">\"js\"</span>, arr);  <span class=\"comment\">// 返回 3, 如果不包含在数组中, 则返回 -1;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"10、获取日期并格式化\"><a href=\"#10、获取日期并格式化\" class=\"headerlink\" title=\"10、获取日期并格式化\"></a>10、获取日期并格式化</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getDateStr</span>(<span class=\"params\">AddDayCount</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> dd = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\">  dd.setDate(dd.getDate()+AddDayCount);<span class=\"comment\">//获取AddDayCount天后的日期</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> y = dd.getFullYear();</span><br><span class=\"line\">  <span class=\"keyword\">var</span> m = dd.getMonth()+<span class=\"number\">1</span>;<span class=\"comment\">//获取当前月份的日期</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> d = dd.getDate();</span><br><span class=\"line\">  <span class=\"keyword\">return</span> y+<span class=\"string\">\"-\"</span>+m+<span class=\"string\">\"-\"</span>+d;</span><br><span class=\"line\">&#125;)(<span class=\"number\">-2</span>);</span><br></pre></td></tr></table></figure>\n<h2 id=\"11、根据屏幕宽度改变-html-的-font-size-大小\"><a href=\"#11、根据屏幕宽度改变-html-的-font-size-大小\" class=\"headerlink\" title=\"11、根据屏幕宽度改变 html 的 font-size 大小\"></a>11、根据屏幕宽度改变 html 的 font-size 大小</h2><p>结合 REM 可以很轻松的实现移动端的响应式大小效果</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">win</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setUnitA</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.documentElement.style.fontSize = <span class=\"built_in\">document</span>.documentElement.clientWidth / <span class=\"number\">16</span> + <span class=\"string\">\"px\"</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> h = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">\"resize\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    clearTimeout(h);</span><br><span class=\"line\">    h = setTimeout(setUnitA, <span class=\"number\">300</span>);</span><br><span class=\"line\">  &#125;, <span class=\"literal\">false</span>);</span><br><span class=\"line\">  setUnitA();</span><br><span class=\"line\">&#125;)(<span class=\"built_in\">window</span>);</span><br></pre></td></tr></table></figure>\n<h2 id=\"12、JS-jQuery-获取-url-参数\"><a href=\"#12、JS-jQuery-获取-url-参数\" class=\"headerlink\" title=\"12、JS/jQuery 获取 url 参数\"></a>12、JS/jQuery 获取 url 参数</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//---------------javaseript获取url中的参数----------------</span></span><br><span class=\"line\"><span class=\"comment\">//\\* 用法：</span></span><br><span class=\"line\"><span class=\"comment\">//\\* var args = getArgs( ); // 从 URL 解析出参数</span></span><br><span class=\"line\"><span class=\"comment\">//\\* var q = args.q || \"\"; // 如果定义了某参数，则使用其值，否则给它一个默认值</span></span><br><span class=\"line\"><span class=\"comment\">//\\* var n = args.n ? parseInt(args.n) : 10;</span></span><br><span class=\"line\"><span class=\"comment\">//*/</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> getArgs = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> args = <span class=\"keyword\">new</span> <span class=\"built_in\">Object</span>( ); <span class=\"comment\">//声明一个空对象</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> query = <span class=\"built_in\">window</span>.location.search.substring(<span class=\"number\">1</span>); <span class=\"comment\">// 取查询字符串，如从 http://www.snowpeak.org/testjs.htm?a1=v1&amp;a2=&amp;a3=v3#anchor 中截出 a1=v1&amp;a2=&amp;a3=v3。</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> pairs = query.split(<span class=\"string\">\"&amp;\"</span>); <span class=\"comment\">// 以 &amp; 符分开成数组</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; pairs.length; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> pos = pairs[i].indexOf(<span class=\"string\">'='</span>); <span class=\"comment\">// 查找 \"name=value\" 对</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (pos == <span class=\"number\">-1</span>) <span class=\"keyword\">continue</span>; <span class=\"comment\">// 若不成对，则跳出循环继续下一对</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> argname = pairs[i].substring(<span class=\"number\">0</span>,pos); <span class=\"comment\">// 取参数名</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> value = pairs[i].substring(pos+<span class=\"number\">1</span>); <span class=\"comment\">// 取参数值</span></span><br><span class=\"line\">        value = <span class=\"built_in\">decodeURIComponent</span>(value); <span class=\"comment\">// 若需要，则解码</span></span><br><span class=\"line\">        args[argname] = value; <span class=\"comment\">// 存成对象的一个属性</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> args; <span class=\"comment\">// 返回此对象</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h2 id=\"13、返回一个最小值与最大值中间的随机值\"><a href=\"#13、返回一个最小值与最大值中间的随机值\" class=\"headerlink\" title=\"13、返回一个最小值与最大值中间的随机值\"></a>13、返回一个最小值与最大值中间的随机值</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">random</span>(<span class=\"params\">min,max</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> min + (max - min) * <span class=\"built_in\">Math</span>.random();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"14、限制上传文件格式和大小\"><a href=\"#14、限制上传文件格式和大小\" class=\"headerlink\" title=\"14、限制上传文件格式和大小\"></a>14、限制上传文件格式和大小</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fileChange</span>(<span class=\"params\">target</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> name=target.value;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> fileType = name.substring(name.lastIndexOf(<span class=\"string\">\".\"</span>)+<span class=\"number\">1</span>).toLowerCase();     <span class=\"comment\">// 获取文件格式</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> fileArr=name.split(<span class=\"string\">\"\\\\\\\");</span></span><br><span class=\"line\"><span class=\"string\">    var fileName=fileArr[fileArr.length-1];     // 获取文件名称</span></span><br><span class=\"line\"><span class=\"string\">    if(fileType !=\"</span>jpg<span class=\"string\">\" &amp;&amp; fileType !=\"</span>png<span class=\"string\">\")&#123;</span></span><br><span class=\"line\"><span class=\"string\">        alert(\"</span>请选择jpg或者png格式图片文件上传！<span class=\"string\">\");</span></span><br><span class=\"line\"><span class=\"string\">        target.value=\"</span><span class=\"string\">\";</span></span><br><span class=\"line\"><span class=\"string\">        return false;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;else&#123;</span></span><br><span class=\"line\"><span class=\"string\">        var fileSize = target.files[0].size/1024;           // 获取文件大小，单位为kb</span></span><br><span class=\"line\"><span class=\"string\">        console.log(fileSize);</span></span><br><span class=\"line\"><span class=\"string\">        if (fileSize &gt; 40) &#123;</span></span><br><span class=\"line\"><span class=\"string\">            alert(\"</span>图片文件大小不得超过<span class=\"number\">40</span>kb!<span class=\"string\">\");</span></span><br><span class=\"line\"><span class=\"string\">            target.value=\"</span><span class=\"string\">\";</span></span><br><span class=\"line\"><span class=\"string\">            return false;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;else&#123;</span></span><br><span class=\"line\"><span class=\"string\">            var url=getObjectURL(target.files[0]);           // 获取图片url</span></span><br><span class=\"line\"><span class=\"string\">            console.log(url);</span></span><br><span class=\"line\"><span class=\"string\">            $(\"</span>.modal_brand .upload_img<span class=\"string\">\").attr(\"</span>src<span class=\"string\">\",url);      // 显示上传图片</span></span><br><span class=\"line\"><span class=\"string\">            console.log($(\"</span>.modal_brand .upload_img<span class=\"string\">\").attr(\"</span>src<span class=\"string\">\"));</span></span><br><span class=\"line\"><span class=\"string\">            $(\"</span>.modal_brand .img_name p<span class=\"string\">\").text(fileName);          // 显示上传图片文件名</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"15、一个-HTML-转义函数\"><a href=\"#15、一个-HTML-转义函数\" class=\"headerlink\" title=\"15、一个 HTML 转义函数\"></a>15、一个 HTML 转义函数</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">escapeHTML</span>(<span class=\"params\">text</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> replacements= &#123;<span class=\"string\">\"&lt;\"</span>: <span class=\"string\">\"&lt;\"</span>, <span class=\"string\">\"&gt;\"</span>: <span class=\"string\">\"&gt;\"</span>,<span class=\"string\">\"&amp;\"</span>: <span class=\"string\">\"&amp;\"</span>, <span class=\"string\">\"\\\\\"</span><span class=\"string\">\": \"</span><span class=\"string\">\"\"</span>&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> text.replace(<span class=\"regexp\">/[&lt;&gt;&amp;\"]/g</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">character</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> replacements[character];</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","raw":null,"categories":[{"name":"js","path":"api/categories/js.json"}],"tags":[{"name":"JS","path":"api/tags/JS.json"},{"name":"jQuery","path":"api/tags/jQuery.json"}]}]}