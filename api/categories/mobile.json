{"name":"mobile","postlist":[{"title":"Merrier说还可以这样玩儿？！","slug":"Merrier说还可以这样玩儿？！","date":"2017-09-23T06:32:34.000Z","updated":"2019-03-29T10:17:04.616Z","comments":true,"path":"api/articles/Merrier说还可以这样玩儿？！.json","excerpt":null,"keywords":"merrier 博客 前端 北邮人","cover":"/images/hexo_post_214.png","content":"<p>不知不觉，Merrier说 已经上线近半年了；前不久添加了 CNZZ 的统计代码，虽然 UV、PV 不是很多，但是发现老访客的比例还是比较高的，下面我介绍一个技巧——“<strong>把喜欢的网站添加到主屏幕，方便以后访问</strong>”，这样以后再想访问我的博客就会变得很简单了（当然，也可以用在其他喜欢的网站）</p>\n<h2 id=\"第一步，打开浏览器，访问Merrier说主页（http-merrier-wang）\"><a href=\"#第一步，打开浏览器，访问Merrier说主页（http-merrier-wang）\" class=\"headerlink\" title=\"第一步，打开浏览器，访问Merrier说主页（http://merrier.wang）\"></a>第一步，打开浏览器，访问Merrier说主页（<a href=\"http://merrier.wang\">http://merrier.wang</a>）</h2><p>我的手机是iOS的，目前发现<strong>只有safari</strong>才行</p>\n<h2 id=\"第二步，点击浏览器下方的“发送”按钮\"><a href=\"#第二步，点击浏览器下方的“发送”按钮\" class=\"headerlink\" title=\"第二步，点击浏览器下方的“发送”按钮\"></a>第二步，点击浏览器下方的“发送”按钮</h2><p>如下图红框处：</p>\n<div align=\"center\"><img src=\"/images/hexo_post_214.png\" alt=\"\" width=\"300\"></div>\n\n<h2 id=\"第三步，找到“添加到主屏幕”按钮\"><a href=\"#第三步，找到“添加到主屏幕”按钮\" class=\"headerlink\" title=\"第三步，找到“添加到主屏幕”按钮\"></a>第三步，找到“添加到主屏幕”按钮</h2><p>如下图红框处，在靠下方位置（不要在意那个“宇宙第一美男”。。）：</p>\n<div align=\"center\"><img src=\"/images/hexo_post_215.png\" alt=\"\" width=\"300\"></div>\n\n<h2 id=\"最后一步，点击“添加”按钮即可\"><a href=\"#最后一步，点击“添加”按钮即可\" class=\"headerlink\" title=\"最后一步，点击“添加”按钮即可\"></a>最后一步，点击“添加”按钮即可</h2><p>由于wordpress本身就做了这方面的工作，所以当我们在上一步点击“添加到主屏幕”时，就会看到下面已经配置好的内容：</p>\n<div align=\"center\"><img src=\"/images/hexo_post_216.png\" alt=\"\" width=\"300\"></div>\n\n<p>从上面的截图中可以看出，“添加到主屏幕”的结果是：一个图标将会添加到您的主屏幕，以便您快速访问此网站。</p>\n<h2 id=\"最终结果\"><a href=\"#最终结果\" class=\"headerlink\" title=\"最终结果\"></a>最终结果</h2><p>添加到主屏幕之后，我们就可以看到主屏幕上多了一个“很怪”的图标。。</p>\n<div align=\"center\"><img src=\"/images/hexo_post_120.png\" alt=\"\" width=\"300\"></div>\n\n<p>以后直接点击 Merrier说 图标就可以访问我的博客啦~~！！</p>\n<h2 id=\"关于安卓\"><a href=\"#关于安卓\" class=\"headerlink\" title=\"关于安卓\"></a>关于安卓</h2><p>iOS 可以按照上面的步骤添加图标至主屏幕，安卓的话因为身边没有安卓手机，所以暂时不太了解有没有类似功能。。（据说安卓的 UC 浏览器中有类似的按钮？）</p>\n","raw":null,"categories":[{"name":"mobile","path":"api/categories/mobile.json"}],"tags":[{"name":"技巧","path":"api/tags/技巧.json"},{"name":"Merrier说","path":"api/tags/Merrier说.json"}]},{"title":"移动端滚动事件大起底","slug":"移动端滚动事件大起底","date":"2017-08-20T13:43:33.000Z","updated":"2019-03-29T10:17:04.620Z","comments":true,"path":"api/articles/移动端滚动事件大起底.json","excerpt":null,"keywords":"merrier 博客 前端 北邮人","cover":null,"content":"<p>最近在做移动端的项目，其中有个需求就是滚动监听标签页，实现用户滚动到不同位置时点亮相应 tab 按钮；这其实是个很简单的需求，但是根据之前的项目经验，移动端的滚动事件会有各种坑，所以就花时间做了一些功课，对移动端滚动事件中的坑进行了总结，同时提供了一些解决方案。</p>\n<h2 id=\"移动端滚动事件介绍\"><a href=\"#移动端滚动事件介绍\" class=\"headerlink\" title=\"移动端滚动事件介绍\"></a>移动端滚动事件介绍</h2><p>我们这里要讲的是 onscroll 事件，具体参见<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/GlobalEventHandlers/onscroll\" target=\"_blank\" rel=\"noopener\">MDN文档</a></p>\n<h2 id=\"滚动事件应用\"><a href=\"#滚动事件应用\" class=\"headerlink\" title=\"滚动事件应用\"></a>滚动事件应用</h2><p>我做了几个简单的 demo，可以直接点击下面的链接查看（在手机上效果更佳~），关于移动端滚动事件的简单 demo 我上传到了我的 github，可以<a href=\"https://github.com/merrier/mobile-scroll-events\" target=\"_blank\" rel=\"noopener\">点击这里</a>查看源码：</p>\n<ul>\n<li><a href=\"https://merrier.github.io/mobile-scroll-events/drop-and-refresh.html\" target=\"_blank\" rel=\"noopener\">下拉刷新</a></li>\n<li><a href=\"https://merrier.github.io/mobile-scroll-events/ceiling.html\" target=\"_blank\" rel=\"noopener\">吸顶效果</a></li>\n<li><a href=\"https://merrier.github.io/mobile-scroll-events/lazy-load.html\" target=\"_blank\" rel=\"noopener\">图片懒加载</a></li>\n<li>无限加载</li>\n<li><a href=\"https://merrier.github.io/mobile-scroll-events/side-nav-bar.html\" target=\"_blank\" rel=\"noopener\">侧边浮动导航栏</a></li>\n</ul>\n<h2 id=\"滚动事件分类和兼容性\"><a href=\"#滚动事件分类和兼容性\" class=\"headerlink\" title=\"滚动事件分类和兼容性\"></a>滚动事件分类和兼容性</h2><p>按照实际滚动的 dom 类型分为全局滚动和局部滚动</p>\n<h3 id=\"全局滚动\"><a href=\"#全局滚动\" class=\"headerlink\" title=\"全局滚动\"></a>全局滚动</h3><p>滚动条在 body 节点或者更顶层，一般是这样调用：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.onscroll = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> bHeight = <span class=\"built_in\">document</span>.body.clientHeight,  <span class=\"comment\">// body对象高度，如果有滚动高度也包括</span></span><br><span class=\"line\">        wHeight = <span class=\"built_in\">window</span>.innerHeight,  <span class=\"comment\">// 浏览器窗口的视口</span></span><br><span class=\"line\">        sTop = <span class=\"built_in\">document</span>.body.scrollTop;  <span class=\"comment\">// body距离滚动顶部的距离</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> isScrollBottom = bHeight - (wHeight + sTop) === <span class=\"number\">0</span> ? <span class=\"literal\">true</span> : <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isScrollBottom) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 执行相关代码</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>也可以通过 addEventListener 的方式</p>\n<h3 id=\"局部滚动\"><a href=\"#局部滚动\" class=\"headerlink\" title=\"局部滚动\"></a>局部滚动</h3><p>滚动条在 body 下某一个 dom 节点，在移动端如果使用局部滚动，意思就是我们的滚动在一个固定宽高的 div 内触发，将该 div 设置成 overflow:scroll/auto; 来形成 div 内部的滚动，这时我们监听 div 的 onscroll 发现触发的时机；调用方式和全局滚动类似：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">（<span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'div1'</span>).onscroll = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;）</span><br></pre></td></tr></table></figure>\n<h3 id=\"兼容性\"><a href=\"#兼容性\" class=\"headerlink\" title=\"兼容性\"></a>兼容性</h3><p>整体来看，<strong>全局滚动的兼容性要不如局部滚动，安卓比 IOS 兼容性更好：</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\"></th>\n<th style=\"text-align:center\">body 滚动</th>\n<th style=\"text-align:center\">局部滚动</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">iOS</td>\n<td style=\"text-align:center\">不能实时触发</td>\n<td style=\"text-align:center\">不能实时触发</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">android</td>\n<td style=\"text-align:center\">实时触发</td>\n<td style=\"text-align:center\">实时触发</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">iOS WKWebview 内核</td>\n<td style=\"text-align:center\">实时触发</td>\n<td style=\"text-align:center\">实时触发</td>\n</tr>\n</tbody>\n</table>\n<p>为什么 IOS 下的滚动事件会有各种 bug 呢，通过查阅资料，得出如下结论： iOS 的 webview 内核设定了其在进行 momentum scrolling (弹性滚动， 设置 -webkit-overflow-scrolling:touch 可以达到弹性滚动效果，安卓无效)时，会停止所有的 <strong>事件响应</strong> 及 <strong>DOM操作引起的页面渲染，</strong>故 onscroll 不能实时响应，具体可以<a href=\"https://www.tjvantoll.com/2012/08/19/onscroll-event-issues-on-mobile-browsers/\" target=\"_blank\" rel=\"noopener\">点击这里</a>查看某位大牛写的实例 这里说明一下关于 iOS 的 wkwebview 内核是 iOS 从 iOS8 开始提供的新型 webview 内核，和之前的 uiwebview 相比，性能要好，具体大家可以自行查看关于 wkwebview 的相关概念</p>\n<h3 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"解决方案\"></a>解决方案</h3><p>既然 onscroll 事件在 iOS 和安卓上的表现并不统一，同时根据浏览器内核的不同会有潜在的 bug 出现，就出现了针对于移动端滚动事件的各种兼容方案，总结如下：</p>\n<ol>\n<li>使用 ontouchmove 去替代 onscroll，虽然能更频繁的触发事件，但是这边的项目需求是实时响应滚动事件的同时，还要对页面元素进行重定位的 DOM 操作，由上述原因可知，在滚动过程中，页面会停止一切关于 DOM 方面的操作，所以若使用 ontouchmove 去实现的话，在按住屏幕进行滑动的时候，屏幕会出现元素抖动的情况(事件触发与 DOM 操作间具有几十毫秒的时间差)，兼容失败</li>\n<li>使用 <a href=\"https://iiunknown.gitbooks.io/iscroll-5-api-cn/content/versions.html\" target=\"_blank\" rel=\"noopener\">iscroll</a> 的 probe 版本，该版本能实时探查到滚动的距离，但该钩子函数是实时去关注 requestAnimationFrame 下的状态，所以对浏览器的版本性能消耗很大，安卓机根本动不了，兼容失败</li>\n<li>使用 <a href=\"http://www.swiper.com.cn/\" target=\"_blank\" rel=\"noopener\">swiper</a> 插件，在启动 freeMode 模式时模拟原生的弹性滚动( swiper 模拟原生滚动的方案能兼容较多的安卓机型不出现bug，推荐), 因为 swiper 没有实时监听滚动位置的功能,故我监听滚动开始及结束后的事件，通过 setInterval 及一些计算去实现滚动条的监听，但因为 react 元素的变化量比较大，导致 swiper 在移动端时对父容器的计算速率达到了一个瓶颈，依旧出现很卡顿的现象，兼容失败</li>\n</ol>\n<p>通过以上的兼容性尝试，可以发现其实<strong>并没有一个完美的解决方案</strong>，所以如果真的需要达到某些移动端滚动效果的话，可以采取 fallback 方案：</p>\n<ul>\n<li>Android 用 scroll 方案，因为兼容性很可观；</li>\n<li>IOS 如果不需要兼容 8 以下版本的话，就也直接用 scroll 方案，因为 wkwebview 已经对滚动事件进行了优化，而如果需要兼容8以下版本的话，可以考虑 isroll 或 JRroll 这两种插件，<strong>同时需要真机测试查看效果是否达到要求（尤其是 QQ 浏览器和搜狗浏览器）</strong>。</li>\n</ul>\n<p>由于查询到的资料比较老旧，对于滚动事件的兼容性描述可能已经过时了，我就在最近（2017-8-24）用各种浏览器测试了一下iOS中的滚动事件的兼容性，总结如下：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\"></th>\n<th style=\"text-align:center\">是否可以弹性滚动</th>\n<th style=\"text-align:center\">是否需要设置 overflow:scrolling 才能弹性滚动</th>\n<th style=\"text-align:center\">设置 overflow:scrolling 之后，滚动期间是否监听事件</th>\n<th style=\"text-align:center\">未设置 overflow:scrolling，滚动期间是否监听事件</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">safari(v10.0)</td>\n<td style=\"text-align:center\">否</td>\n<td style=\"text-align:center\">-</td>\n<td style=\"text-align:center\">是</td>\n<td style=\"text-align:center\">是</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">chrome(v60.0)</td>\n<td style=\"text-align:center\">是</td>\n<td style=\"text-align:center\">否</td>\n<td style=\"text-align:center\">是</td>\n<td style=\"text-align:center\">是</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">firefox(v8.2)</td>\n<td style=\"text-align:center\">否</td>\n<td style=\"text-align:center\">-</td>\n<td style=\"text-align:center\">是</td>\n<td style=\"text-align:center\">是</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">weixin(v6.5.14)</td>\n<td style=\"text-align:center\">是</td>\n<td style=\"text-align:center\">否</td>\n<td style=\"text-align:center\">是</td>\n<td style=\"text-align:center\">是</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">QQ(v7.7.2)</td>\n<td style=\"text-align:center\">是</td>\n<td style=\"text-align:center\">否</td>\n<td style=\"text-align:center\">是</td>\n<td style=\"text-align:center\">是</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">搜狗(v5.8.1)</td>\n<td style=\"text-align:center\">是</td>\n<td style=\"text-align:center\">否</td>\n<td style=\"text-align:center\">否</td>\n<td style=\"text-align:center\">否</td>\n</tr>\n</tbody>\n</table>\n<p>从上面的表格可以看到，最新版的 iOS 浏览器其实并不需要 <code>overflow:scrolling</code> 就可以实现弹性滚动，同时除了搜狗浏览器之外，其他浏览器在滚动期间都会监听事件，由此可见截止到目前（2017-8-24），iOS 和浏览器对滚动事件的兼容性已经做了很多优化和改进了，之后有时间的话再在 android 手机上做一下测试……</p>\n<h2 id=\"滚动事件性能优化\"><a href=\"#滚动事件性能优化\" class=\"headerlink\" title=\"滚动事件性能优化\"></a>滚动事件性能优化</h2><p>除了兼容性问题以外，由于滚动事件和 resize 事件同属于<strong>会频繁触发的事件。</strong>如果事件中涉及到大量的位置计算、DOM 操作、元素重绘等工作且这些工作无法在下一个 scroll 事件触发前完成，就会造成浏览器掉帧。</p>\n<h3 id=\"防抖和节流\"><a href=\"#防抖和节流\" class=\"headerlink\" title=\"防抖和节流\"></a>防抖和节流</h3><p>scroll 事件本身会触发页面的重新渲染，同时 scroll 事件的 handler 又会被高频度的触发, 因此事件的 handler 内部不应该有复杂操作，例如 DOM 操作就不应该放在事件处理中。 针对此类高频度触发事件问题（例如页面 scroll ，屏幕 resize，监听用户输入等），下面介绍两种常用的解决方法，防抖和节流（underscore和lodash里面有封装好的这两种方法，感兴趣的话可以研究一下源码）。</p>\n<h4 id=\"防抖\"><a href=\"#防抖\" class=\"headerlink\" title=\"防抖\"></a>防抖</h4><p>防抖技术即是可以把多个顺序地调用合并成一次，也就是在一定时间内，规定事件被触发的次数。</p>\n<h4 id=\"节流\"><a href=\"#节流\" class=\"headerlink\" title=\"节流\"></a>节流</h4><p>防抖函数确实不错，但是也存在问题，譬如图片的懒加载，我希望在下滑过程中图片不断的被加载出来，而不是只有当我停止下滑时候，图片才被加载出来。又或者下滑时候的数据的 ajax 请求加载也是同理。 这个时候，我们希望即使页面在不断被滚动，但是滚动 handler 也可以以一定的频率被触发（譬如 250ms 触发一次），这类场景，就要用到另一种技巧，称为节流函数（throttling）。 节流函数，只允许一个函数在 X 毫秒内执行一次。 与防抖相比，节流函数最主要的不同在于它保证在 X 毫秒内至少执行一次我们希望触发的事件 handler。</p>\n<h3 id=\"使用-rAF（requestAnimationFrame）触发滚动事件\"><a href=\"#使用-rAF（requestAnimationFrame）触发滚动事件\" class=\"headerlink\" title=\"使用 rAF（requestAnimationFrame）触发滚动事件\"></a>使用 rAF（requestAnimationFrame）触发滚动事件</h3><p>上面介绍的抖动与节流实现的方式都是借助了定时器 setTimeout ，但是如果页面只需要兼容高版本浏览器或应用在移动端，又或者页面需要追求高精度的效果，那么可以使用浏览器的原生方法 rAF（requestAnimationFrame）。 window.requestAnimationFrame() 这个方法是用来在页面重绘之前，通知浏览器调用一个指定的函数。这个方法接受一个函数为参，该函数会在重绘前调用。 rAF 常用于 web 动画的制作，用于准确控制页面的帧刷新渲染，让动画效果更加流畅，当然它的作用不仅仅局限于动画制作，我们可以利用它的特性将它视为一个定时器。（当然它不是定时器） 通常来说，rAF 被调用的频率是每秒 60 次，也就是 1000 / 60 ，触发频率大概是 16.7ms 。（当执行复杂操作时，当它发现无法维持 60fps 的频率时，它会把频率降低到 30fps 来保持帧数的稳定。）</p>\n<h3 id=\"总结一下\"><a href=\"#总结一下\" class=\"headerlink\" title=\"总结一下\"></a>总结一下</h3><ul>\n<li>防抖动：防抖技术即是可以把多个顺序地调用合并成一次，也就是在一定时间内，规定事件被触发的次数。</li>\n<li>节流函数：只允许一个函数在 X 毫秒内执行一次，只有当上一次函数执行后过了你规定的时间间隔，才能进行下一次该函数的调用。</li>\n<li>rAF：16.7ms 触发一次 handler，降低了可控性，但是提升了性能和精确度。</li>\n</ul>\n<p>从本质上而言，我们应该尽量去精简 scroll 事件的 handler ，将一些变量的初始化、不依赖于滚动位置变化的计算等都应当在 scroll 事件外提前就绪。建议：<strong>避免在 scroll 事件中修改样式属性 / 将样式操作从 scroll 事件中剥离</strong></p>\n<h2 id=\"参考文章\"><a href=\"#参考文章\" class=\"headerlink\" title=\"参考文章\"></a>参考文章</h2><ul>\n<li><a href=\"http://www.ayqy.net/blog/%E5%90%B8%E9%A1%B6%E6%95%88%E6%9E%9C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/\" target=\"_blank\" rel=\"noopener\">吸顶效果解决方案</a></li>\n<li><a href=\"https://www.tjvantoll.com/2012/08/19/onscroll-event-issues-on-mobile-browsers/\" target=\"_blank\" rel=\"noopener\">onscroll Event Issues on Mobile Browsers</a></li>\n<li><a href=\"https://segmentfault.com/q/1010000004453730\" target=\"_blank\" rel=\"noopener\">前端: 移动端onscroll事件在部分浏览器内不能实时触发</a></li>\n<li><a href=\"http://www.alloyteam.com/2017/04/secrets-of-mobile-web-scroll-bars-and-drop-refresh/\" target=\"_blank\" rel=\"noopener\">移动web之滚动篇</a>* <a href=\"http://web.jobbole.com/86158/\" target=\"_blank\" rel=\"noopener\">高性能滚动 scroll 及页面渲染优化</a></li>\n</ul>\n","raw":null,"categories":[{"name":"mobile","path":"api/categories/mobile.json"}],"tags":[{"name":"移动端","path":"api/tags/移动端.json"}]},{"title":"那些惊艳的移动端H5案例","slug":"那些惊艳的移动端H5案例","date":"2018-02-11T08:25:53.000Z","updated":"2019-03-29T10:17:04.624Z","comments":true,"path":"api/articles/那些惊艳的移动端H5案例.json","excerpt":null,"keywords":"merrier 博客 前端 北邮人","cover":"/images/hexo_post_235.jpeg","content":"<p>不管是公司用于宣传还是对某个产品进行营销，移动端 H5 的应用范围越来越广，其取得的效果也有目共睹，而这篇文章就带大家领略一下那些十分惊艳的移动端H5案例，希望大家抱着猎奇的心态观看，毕竟可远观而不可亵玩呐-。-（以下活动有可能是限时的，所以当你再次访问时有可能已经关站了，排名不分先后）</p>\n<h2 id=\"案例\"><a href=\"#案例\" class=\"headerlink\" title=\"案例\"></a>案例</h2><h3 id=\"adidas-胜势全开\"><a href=\"#adidas-胜势全开\" class=\"headerlink\" title=\"adidas-胜势全开\"></a><a href=\"http://show.im20.com.cn/bbcny/\" target=\"_blank\" rel=\"noopener\">adidas-胜势全开</a></h3><p>\badidas 为自己的新战靴做的宣传，不过看开头动画的时候有点吓到我了- -，这为了宣传新鞋也真是下了一番功夫啊。。</p>\n<h3 id=\"凡科720°全景×活动促销\"><a href=\"#凡科720°全景×活动促销\" class=\"headerlink\" title=\"凡科720°全景×活动促销\"></a><a href=\"https://s.wcd.im/v/2uZ71/\" target=\"_blank\" rel=\"noopener\">凡科720°全景×活动促销</a></h3><p>凡科互动是凡科旗下的一个子品牌，主要做的就是这种活动促销 H5，其中大多数为游戏的形式，而这个 720° 全景营销案例很经典，之前我也曾经尝试过实现一个类似的，结果可想而知。。因为 720° 需要用到一些数学知识，同时为了让其滑动的更顺滑，引入了很多插件，所以是一个比较难实现的案例。</p>\n<h3 id=\"Merrier和王者荣耀的故事\"><a href=\"#Merrier和王者荣耀的故事\" class=\"headerlink\" title=\"Merrier和王者荣耀的故事\"></a><a href=\"https://game.weixin.qq.com/cgi-bin/act?noticeid=90113615&amp;actid=7519&amp;k=m4GgtZfFORJ_wyqLywTnnw&amp;q=0&amp;jsapi_ticket=1&amp;openid=owanlsmlZT4pSDOwMrD8P9ObuEEU&amp;partition=4052#wechat_redirect\" target=\"_blank\" rel=\"noopener\">Merrier和王者荣耀的故事</a></h3><p>不知道你们能不能打开这个链接，应该是只能在微信中打开的- -，这是王者荣耀在两周年的时候出的一个总结性质的 H5，色彩搭配很舒服，同时各种数据的统计证明这个文案是用了很大心思的。</p>\n<h3 id=\"有志者，吃就橙\"><a href=\"#有志者，吃就橙\" class=\"headerlink\" title=\"有志者，吃就橙\"></a><a href=\"http://h5.flyfinger.com/2017/dlanping/foodleS/index.html\" target=\"_blank\" rel=\"noopener\">有志者，吃就橙</a></h3><p>大众点评和摩拜单车联合搞的一次“炫光吃货车”活动，虽然其实就是一个不能暂停也没有很人性化的静音按钮的视频，但是不得不说，文案还是有一丢丢创意的，而且配音也很有意思。。</p>\n<h3 id=\"车轮招聘节\"><a href=\"#车轮招聘节\" class=\"headerlink\" title=\"车轮招聘节\"></a><a href=\"http://h5.eclicks.cn/2016/hr/index.html\" target=\"_blank\" rel=\"noopener\">车轮招聘节</a></h3><p><a href=\"http://eclicks.cn/\" target=\"_blank\" rel=\"noopener\">车轮——让有车生活更美好</a>制作的招聘宣传 H5，虽然动画比较简单，而且元素也比较单一，但是整体效果还是不错的，而且有一个很牛逼的微信分享标题：《我们在召唤你，艾泽拉斯最强的勇士们！》</p>\n<h3 id=\"开打法魔用能只章文篇这\"><a href=\"#开打法魔用能只章文篇这\" class=\"headerlink\" title=\"开打法魔用能只章文篇这\"></a><a href=\"http://news.163.com/special/fdh5_harrypotter20_18/\" target=\"_blank\" rel=\"noopener\">开打法魔用能只章文篇这</a></h3><p>（这个标题用了我 30 秒的时间）不得不承认这是我见过的最炫酷的 H5 宣传案例了，当那熟悉的旋律响起，我们仿佛就置身于霍格沃茨魔法学院，通过一些手势产生互动，最后还能学到魔法，不得不说真的很赞，不过缺点就是：这个是宣传什么的来着？</p>\n<h3 id=\"艾泽拉斯全景之旅\"><a href=\"#艾泽拉斯全景之旅\" class=\"headerlink\" title=\"艾泽拉斯全景之旅\"></a><a href=\"http://zhouxin.legendh5.com/h5/537c983e-b0a6-8a91-435b-abb04ad6c704.html\" target=\"_blank\" rel=\"noopener\">艾泽拉斯全景之旅</a></h3><p>80 年代的魔兽世界，大灾变之前的艾泽拉斯，wower 老玩家的回忆。不知不觉，魔兽世界已经陪伴我们超过十年了，虽然我自己玩魔兽的时间很短很短，不过对魔兽世界的文化本身还是比较感兴趣的，而这个 720° 全景可以说做的很用心，也很真实，同时还能够看到一些玩家在暴风城等地方留下的感慨，岁月流转，曾经一起下副本的朋友们你们过得还好吗？</p>\n<h3 id=\"朕收到一条来自你妈的微信\"><a href=\"#朕收到一条来自你妈的微信\" class=\"headerlink\" title=\"朕收到一条来自你妈的微信\"></a><a href=\"http://9be705463ff7.vt.iamh5.cn/v3/idea/7gEJ3FF5\" target=\"_blank\" rel=\"noopener\">朕收到一条来自你妈的微信</a></h3><p>这个标题着实吓到我了，不过点开才发现，这和我妈有什么关系？！其实就是故宫食品的宣传 H5，在这里赞一下文案设计，风趣而不失稳重（看饿了）：</p>\n<blockquote>\n<p>圣旨到<br>奉天承运，皇帝诏曰<br>朕最近心情不佳<br>打农药微信总弹窗<br>段位一直掉掉掉掉<br>烦死朕了<br>朕实在控记不住记几啊<br>点开一看<br>朕收到了你妈的微信<br>让你中秋回家吃月饼 SO<br>朕就给你批个长假<br>回家过节<br>反正带不回对象<br>那就带朕的心意<br>哈哈哈哈，没想到吧<br>朕给自家御膳房走波广告<br>（…各种弹幕）<br>朕的御厨，平时很闲<br>除了月饼，还做了一堆<br>（…各种吃的）<br>现在有些妖艳的月饼<br>咬一口防腐半年<br>一定是哪个刁民<br>想谋害朕<br>好继承朕的江山<br>稳住我们能赢！<br>朕的御膳房，刀枪不入，百毒不侵<br>国味汝肴典藏月饼<br>这就是朕的心意<br>故  宫  的  月  饼<br>眼花了吧 哈哈哈哈哈<br>朕就是这样迷人的汉子<br>（好不要脸）</p>\n</blockquote>\n<h3 id=\"领英丨名企梦工厂-今日头条\"><a href=\"#领英丨名企梦工厂-今日头条\" class=\"headerlink\" title=\"领英丨名企梦工厂-今日头条\"></a><a href=\"https://h5.veervr.tv/player/?vid=%E9%A2%86%E8%8B%B1%E4%B8%A8%E5%90%8D%E4%BC%81%E6%A2%A6%E5%B7%A5%E5%8E%82-%E4%BB%8A%E6%97%A5%E5%A4%B4%E6%9D%A1-66114\" target=\"_blank\" rel=\"noopener\">领英丨名企梦工厂-今日头条</a></h3><p>领英在校招季携手 18 家顶级名企，用 VR 全景带你全方位无死角地触碰心仪公司，可以说结合 VR 进行企业的介绍效果很赞，再加上旁白的介绍更加饱满充实，不过就是流量消耗巨大。。如果对 VR 感兴趣的话，欢迎去 <a href=\"https://veervr.tv/\" target=\"_blank\" rel=\"noopener\">VeeR-全球VR内容分享社区</a>观看更多 VR 视频（首先，你得有一副好的 VR 眼镜）</p>\n<h3 id=\"2017两会\"><a href=\"#2017两会\" class=\"headerlink\" title=\"2017两会\"></a><a href=\"http://www.html5case.com.cn/case/people-cn/likeqiang-timeline/index2.html\" target=\"_blank\" rel=\"noopener\">2017两会</a></h3><p>人民日报在两会期间做的微信宣传 H5，很有创意，借用微信群聊和朋友圈的方式对国家取得的成果进行了展示，同时进行了一些宣传和号召。</p>\n<h3 id=\"王思聪邀请你加入群聊\"><a href=\"#王思聪邀请你加入群聊\" class=\"headerlink\" title=\"王思聪邀请你加入群聊\"></a><a href=\"http://static.udache.com/gulfstream/webapp/modules/tmall2didi/index.html\" target=\"_blank\" rel=\"noopener\">王思聪邀请你加入群聊</a></h3><p>现在的标题党越来越多了。。其实和上面那个两会的 H5 类似，只不过粗糙一些，而且内容也比较少，就是滴滴的一个活动的宣传，很明显的不太用心啊。</p>\n<h3 id=\"河北衡水中学720°全景图\"><a href=\"#河北衡水中学720°全景图\" class=\"headerlink\" title=\"河北衡水中学720°全景图\"></a><a href=\"http://720yun.com/t/7b9z011r08z?code=03101967458b0569d107870c89280a4H\" target=\"_blank\" rel=\"noopener\">河北衡水中学720°全景图</a></h3><p>衡中虽然占地面积比较小，但是每年产出的清北人数可以说在全国都是名列前茅的，而这个 720° 全景图相比之前魔兽和凡科的就差太多了，好希望有人能做一个比较细致的 720° 全景图啊- -</p>\n<h3 id=\"比尔盖茨邀请你加入群聊\"><a href=\"#比尔盖茨邀请你加入群聊\" class=\"headerlink\" title=\"比尔盖茨邀请你加入群聊\"></a><a href=\"http://m.creatby.com/v2/manage/book/rkcmfz/?weixin_auth_key=20180215100913870054844\" target=\"_blank\" rel=\"noopener\">比尔盖茨邀请你加入群聊</a></h3><p>需要在微信中打开，和上面的“王思聪邀请你加入群聊”类似，都是模仿微信进行宣传，同时加入了一些用户互动，最后重定向到了公众号中的一篇文章，其实这种形式是一种很好的宣传，值得借鉴</p>\n<h3 id=\"以你之名，守护汉字\"><a href=\"#以你之名，守护汉字\" class=\"headerlink\" title=\"以你之名，守护汉字\"></a><a href=\"http://shared.youdao.com/market/xmdh/163.html?d=1518660346820\" target=\"_blank\" rel=\"noopener\">以你之名，守护汉字</a></h3><p>网易有道做的“守护汉字”主题活动，根据你的姓名为你分配一个需要守护的古汉字，让我不禁想起了《国家宝藏》，不过不得不说，动画特效和 BGM 都很赞，在“提笔忘字”的今天，守护汉字显得尤为重要</p>\n<h3 id=\"快看！李彦宏父女跑进你的手机啦！\"><a href=\"#快看！李彦宏父女跑进你的手机啦！\" class=\"headerlink\" title=\"快看！李彦宏父女跑进你的手机啦！\"></a><a href=\"https://eopa.baidu.com/page/RV-gFZw4Ct7\" target=\"_blank\" rel=\"noopener\">快看！李彦宏父女跑进你的手机啦！</a></h3><p>虽然只是一个视频，技术上难度很低，不过这个视频做的很赞，百度通过这种形式宣传自己的“手机百度”，虽然对百度并无好感，不过如此用心的视频还是要赞一个</p>\n<h3 id=\"2017，谁是头条？\"><a href=\"#2017，谁是头条？\" class=\"headerlink\" title=\"2017，谁是头条？\"></a><a href=\"http://p.static.jimingkeji.com.cn/infini-first171208/index.html\" target=\"_blank\" rel=\"noopener\">2017，谁是头条？</a></h3><p>头条对于 2017 年度新闻的总结，水墨画与太极的结合很是中国风，文案处处体现着“中国功夫”的元素。</p>\n<h3 id=\"唐朝名媛高阶生活指南\"><a href=\"#唐朝名媛高阶生活指南\" class=\"headerlink\" title=\"唐朝名媛高阶生活指南\"></a><a href=\"http://wx.amo9.com/h5/2018/nov/cmcc10086/8/index.html?proj=cmcc10086&amp;\" target=\"_blank\" rel=\"noopener\">唐朝名媛高阶生活指南</a></h3><p>你不看到末尾不会想到，这是中国移动的广告。。。</p>\n<h3 id=\"二零一七年娱乐圈画传\"><a href=\"#二零一七年娱乐圈画传\" class=\"headerlink\" title=\"二零一七年娱乐圈画传\"></a><a href=\"http://ent.163.com/special/entphotos2017/?spssid=5892622e2f96d034a7931d06dd4b4dd0&amp;spsw=12&amp;spss=other&amp;from=groupmessage&amp;isappinstalled=0\" target=\"_blank\" rel=\"noopener\">二零一七年娱乐圈画传</a></h3><p>去年的一个网易娱乐年度新闻盘点的 H5 页面非常的新颖，采用画中画的形式依次串联十多个手绘娱乐图片，加上洗脑的“好运来”音乐，让人有很大的分享的欲望。这里有一篇解密的文章：<a href=\"https://juejin.im/post/5bfbcb1e5188252e8966a298\" target=\"_blank\" rel=\"noopener\">《Canvas 实现画中画动画效果–网易娱乐年度盘点H5动画解密》</a></p>\n<h3 id=\"娱乐圈画传2018：江湖多离别-十年如一梦\"><a href=\"#娱乐圈画传2018：江湖多离别-十年如一梦\" class=\"headerlink\" title=\"娱乐圈画传2018：江湖多离别 十年如一梦\"></a><a href=\"http://h5.data.163.com/163/html/ent/entpainting2018/index.html?spssid=5892622e2f96d034a7931d06dd4b4dd0&amp;spsw=3&amp;spss=native\" target=\"_blank\" rel=\"noopener\">娱乐圈画传2018：江湖多离别 十年如一梦</a></h3><p>从 2008 到 2018，时间是世事更迭最好的导演。网易娱乐将娱乐圈画传做成了一个 IP，希望一直做下去吧。</p>\n<h3 id=\"她挣扎48小时后死去，无人知晓\"><a href=\"#她挣扎48小时后死去，无人知晓\" class=\"headerlink\" title=\"她挣扎48小时后死去，无人知晓\"></a><a href=\"https://c.m.163.com/nc/qa/activity/dada_protection/index.html?spssid=5892622e2f96d034a7931d06dd4b4dd0&amp;spsw=1&amp;spss=163\" target=\"_blank\" rel=\"noopener\">她挣扎48小时后死去，无人知晓</a></h3><p>副标题：《你也是这个故事的主角》，首先不要被这个标题所吓到，其实这是网易出品的一个号召大家关注环境保护的一个 H5，不得不说，网易在这个方面做的真的很出色。</p>\n<h3 id=\"制造【我】的草莓音乐节\"><a href=\"#制造【我】的草莓音乐节\" class=\"headerlink\" title=\"制造【我】的草莓音乐节\"></a><a href=\"http://wap.zhengzai.tv/pages/strawberry2018/index.html\" target=\"_blank\" rel=\"noopener\">制造【我】的草莓音乐节</a></h3><p>可以在线生成草莓音乐节主题海报，你可以定制自己的外形，并添加一些简单的文案。</p>\n<h3 id=\"重回1978，带你潇洒走一回！\"><a href=\"#重回1978，带你潇洒走一回！\" class=\"headerlink\" title=\"重回1978，带你潇洒走一回！\"></a><a href=\"http://omgmkt.qq.com/tencent_news/201811/reform/40year.8b3ec.html\" target=\"_blank\" rel=\"noopener\">重回1978，带你潇洒走一回！</a></h3><p>腾讯新闻出品的，结合重力感应带你回顾改革开放四十年来我们的变化，筒子楼、迪斯科、马里奥，这些具有十分明显的时代痕迹的符号代表了那一辈人的童年，就像标题一样，带你潇洒走一回！</p>\n<h3 id=\"当TiMi一声响起的时候\"><a href=\"#当TiMi一声响起的时候\" class=\"headerlink\" title=\"当TiMi一声响起的时候\"></a><a href=\"https://timi.qq.com/act/a20181212timi/index.html\" target=\"_blank\" rel=\"noopener\">当TiMi一声响起的时候</a></h3><p>天美工作室出品，这是属于我们十年的回忆，不止是王者荣耀</p>\n<h3 id=\"我在幸福长街40号等你\"><a href=\"#我在幸福长街40号等你\" class=\"headerlink\" title=\"我在幸福长街40号等你\"></a><a href=\"https://c.h5in.net/people/\" target=\"_blank\" rel=\"noopener\">我在幸福长街40号等你</a></h3><p>人民日报携手快手出品，这是一张“长动图”，见证了 1979-2019 这 40 年的沧桑巨变。</p>\n<h3 id=\"带你全方位欣赏美丽的重庆邮电大学\"><a href=\"#带你全方位欣赏美丽的重庆邮电大学\" class=\"headerlink\" title=\"带你全方位欣赏美丽的重庆邮电大学\"></a><a href=\"https://720yun.com/t/70c26xsgq1f\" target=\"_blank\" rel=\"noopener\">带你全方位欣赏美丽的重庆邮电大学</a></h3><p>重邮全景</p>\n<h2 id=\"一些专门做H5媒体内容的平台：\"><a href=\"#一些专门做H5媒体内容的平台：\" class=\"headerlink\" title=\"一些专门做H5媒体内容的平台：\"></a>一些专门做H5媒体内容的平台：</h2><h3 id=\"木疙瘩\"><a href=\"#木疙瘩\" class=\"headerlink\" title=\"木疙瘩\"></a><a href=\"http://www.mugeda.com\" target=\"_blank\" rel=\"noopener\">木疙瘩</a></h3><p>H5 交互融媒体内容制作与管理平台。首先吐槽一下这个名字，可能是因为只买到了这个稍微能凑出汉字的域名吧，毕竟现在的域名是真贵啊- -，其特色有：</p>\n<ul>\n<li>免费无广告</li>\n<li>零代码交互</li>\n<li>自动适配屏幕</li>\n<li>可导出源文件</li>\n</ul>\n<p>然而，人民日报的一篇题为《燃爆！人民日报首部闪卡H5动画“史上最牛团队这样创业！”》的 H5 文案却被删除了：</p>\n<div align=\"center\"><img src=\"/images/hexo_post_235.jpeg\" width=\"300\" alt=\"\"></div>\n\n<h3 id=\"凡科互动\"><a href=\"#凡科互动\" class=\"headerlink\" title=\"凡科互动\"></a><a href=\"http://hd.faisco.com/\" target=\"_blank\" rel=\"noopener\">凡科互动</a></h3><p>H5 游戏营销领导者。H5游戏因为其跨平台、传播快等特性，近年来受到了广泛关注，而凡科互动就是专注于 H5 游戏的一个平台，我自己也试玩了一下它的几款游戏，包括大转盘、摇一摇、砸金蛋等等，画面音效都很不错，不过应该不是免费的，所以还是要预估一下成本和收益再做决定吧。</p>\n<h3 id=\"720yun\"><a href=\"#720yun\" class=\"headerlink\" title=\"720yun\"></a><a href=\"http://720yun.com/\" target=\"_blank\" rel=\"noopener\">720yun</a></h3><p>从名字可以看出，这是一家做 720 度全景和 VR 视频的平台，首先这个网站的风格我很喜欢，非常紧致有力，不过名气不是很大，也不知道效果如何和收费情况。</p>\n<h3 id=\"MAKA\"><a href=\"#MAKA\" class=\"headerlink\" title=\"MAKA\"></a><a href=\"http://maka.im/\" target=\"_blank\" rel=\"noopener\">MAKA</a></h3><blockquote>\n<p>MAKA 是一款简单、强大的 H5 数字化营销创作工具 其在线编辑器可帮助企业创作出专业级 H5 酷炫动态效果</p>\n</blockquote>\n<p>这是其官网的介绍，MAKA 在业界算是很有名气的了，经常会看到一些企业用 MAKA 做 H5 宣传，所以其本身的效果是已经经过广泛验证的了，最关键的是免费制作（当然，有一些也需要收费），如果有感兴趣的童鞋可以下载一下 MAKA 的 APP 尝试一下，操作简单但是功能强大。</p>\n<h3 id=\"易企秀\"><a href=\"#易企秀\" class=\"headerlink\" title=\"易企秀\"></a><a href=\"http://www.eqxiu.com/\" target=\"_blank\" rel=\"noopener\">易企秀</a></h3><blockquote>\n<p>企业移动营销综合服务平台 极简制作流程 奢华呈现形式 精准投放保证传播效果 数据随时跟踪反馈 从营销到再营销 从传播到二次传播 易企秀提供一键解决方案</p>\n</blockquote>\n<p>易企秀和 MAKA 类似，也是我最开始接触到的 H5 营销平台，虽然其介绍感觉比 MAKA 要强大许多，不过从我自身的体验来讲，易企秀比较适合中小型企业以及那些不太追求外表，同时在线时间比较短的营销活动，比如年会邀请函、新品介绍等等。总之吧，和 MAKA 相比各有千秋。</p>\n<h2 id=\"它山之石\"><a href=\"#它山之石\" class=\"headerlink\" title=\"它山之石\"></a>它山之石</h2><p>还有一些志同道合的童鞋也对与H5的玩法案例进行了总结：</p>\n<h3 id=\"H5玩法知多少\"><a href=\"#H5玩法知多少\" class=\"headerlink\" title=\"H5玩法知多少\"></a><a href=\"https://www.jianshu.com/p/34987148c9d9\" target=\"_blank\" rel=\"noopener\">H5玩法知多少</a></h3><p>来自简书，作者不仅介绍了许许多多经典的 H5 案例，作者还将 H5 玩法归纳为<strong>基于传感器、基于触摸屏操作、基于画面呈现、基于内容</strong>这四类，内容很充实。</p>\n","raw":null,"categories":[{"name":"mobile","path":"api/categories/mobile.json"}],"tags":[{"name":"移动端","path":"api/tags/移动端.json"}]},{"title":"iOS中采用AMP规范时的scroll和position:fixed带来的bug","slug":"iOS中采用AMP规范时的scroll和position:fixed带来的bug","date":"2017-08-26T12:23:20.000Z","updated":"2019-03-29T10:17:04.616Z","comments":true,"path":"api/articles/iOS中采用AMP规范时的scroll和position:fixed带来的bug.json","excerpt":null,"keywords":"merrier 博客 前端 北邮人","cover":null,"content":"<p>本文翻译自一位前辈的两篇文章，原文链接：</p>\n<ul>\n<li><a href=\"https://medium.com/@dvoytenko/amp-ios-scrolling-and-position-fixed-b854a5a0d451\" target=\"_blank\" rel=\"noopener\">AMP, iOS, Scrolling and Position Fixed</a></li>\n<li><a href=\"https://hackernoon.com/amp-ios-scrolling-and-position-fixed-redo-the-wrapper-approach-8874f0ee7876\" target=\"_blank\" rel=\"noopener\">AMP, iOS, Scrolling and Position Fixed Redo — the wrapper approach</a></li>\n</ul>\n<p>首先，你需要先了解一下 AMP，<a href=\"https://imququ.com/post/amp-project.html\" target=\"_blank\" rel=\"noopener\">点击这里</a></p>\n<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>我们对于 AMP 的目标是确保 document 文档在不同环境中都是可嵌入的，无论是单独查看还是在 webview 中或者在 iframe 中——总体而言，它在不同环境中的功能和行为表现都应该尽可能相同。我们将从一个简单的栗子开始，在这个栗子中，一个 AMP 文档通过 iframe 被嵌入了一个 web app。这听起来很正常，但是很实在的说，iframes 在最近已经很少有人用了。闲话少说，html 结构是这样的：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>I’m a Web App and I show AMP documents<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"undefined\">    iframe &#123;</span></span><br><span class=\"line\"><span class=\"undefined\">      position: absolute;</span></span><br><span class=\"line\"><span class=\"undefined\">      top: 0;</span></span><br><span class=\"line\"><span class=\"undefined\">      left: 0;</span></span><br><span class=\"line\"><span class=\"undefined\">      right: 0;</span></span><br><span class=\"line\"><span class=\"undefined\">      bottom: 0;</span></span><br><span class=\"line\"><span class=\"undefined\">    &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">  </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">iframe</span> … <span class=\"attr\">width</span>=<span class=\"string\">\"100%\"</span> <span class=\"attr\">height</span>=<span class=\"string\">\"100%\"</span></span></span><br><span class=\"line\"><span class=\"tag\">   <span class=\"attr\">scrolling</span>=<span class=\"string\">\"yes\"</span></span></span><br><span class=\"line\"><span class=\"tag\">   <span class=\"attr\">src</span>=<span class=\"string\">\"https://cdn.ampproject.org/c/pub1.com/doc1\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">iframe</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>上面这段代码通常来说在移动设备上表现良好。然后我们有了一个新的想法，我们尝试将 iframe 调整到整个 document 的高度，同时使用 static 定位，从而将滚动委托给上一层的 window。然而，出于一些原因，我们放弃了这种方法：</p>\n<ul>\n<li>当视口高度等于文档高度时，在嵌入的AMP文档中设置<code>“position: fixed”</code>是不会起作用的</li>\n<li>计算文档高度容易出错，而且有延迟</li>\n</ul>\n<p>当然，我们最终没有很好的解决方案。主要是，设置了<code>“scrolling=yes”</code>的 iframe 会丢失一些移动设备的特性，比如滚动时隐藏地址栏。然而，我们仍然觉得这已经是一个很好的折衷方案了。除此之外，一些浏览器已经开始尝试将这些特性扩展到非 body 滚动的情况中。我们就这样美滋滋，直到我们遇到了 iOS。。</p>\n<h3 id=\"问题1：iOS-不支持-iframe-的-“scrollable-yes”\"><a href=\"#问题1：iOS-不支持-iframe-的-“scrollable-yes”\" class=\"headerlink\" title=\"问题1：iOS 不支持 iframe 的 “scrollable=yes”\"></a>问题1：iOS 不支持 iframe 的 <code>“scrollable=yes”</code></h3><p>Bug：<a href=\"https://bugs.webkit.org/show_bug.cgi?id=149264\" target=\"_blank\" rel=\"noopener\">https://bugs.webkit.org/show_bug.cgi?id=149264</a> 简单的说：<strong>ios中不能有可以滚动的iframe</strong>。然而，我们找到了解决这个 bug 的方法。参考这里<a href=\"https://github.com/ampproject/amphtml/blob/de7a14d/src/service/viewport-impl.js#L754\" target=\"_blank\" rel=\"noopener\">ViewportBindingNaturalIosEmbed_</a>。简短而言，我们让 document 中真正的<code>&lt;body&gt;</code>元素滚动。这样的话，即使 iframe 自身不滚动，它里面的内容也会滚动。 我们按照上面方案修改后的 AMP 文档如下：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">AMP</span></span></span><br><span class=\"line\"><span class=\"tag\">  <span class=\"attr\">style</span>=<span class=\"string\">\"overflow-y: auto; -webkit-overflow-scrolling: touch;\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">style</span>=<span class=\"string\">\"</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      overflow-y: auto;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      -webkit-overflow-scrolling: touch;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      position: absolute;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      top: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      left: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      right: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      bottom: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">    \"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>我们以为自己很牛逼，然而。。</p>\n<h3 id=\"问题2：现在-scrollTop，scrollLeft，scrollHeight，scrollWidth-不管用了\"><a href=\"#问题2：现在-scrollTop，scrollLeft，scrollHeight，scrollWidth-不管用了\" class=\"headerlink\" title=\"问题2：现在 scrollTop，scrollLeft，scrollHeight，scrollWidth 不管用了\"></a>问题2：现在 scrollTop，scrollLeft，scrollHeight，scrollWidth 不管用了</h3><p>Bug：<a href=\"https://bugs.webkit.org/show_bug.cgi?id=106133\" target=\"_blank\" rel=\"noopener\">https://bugs.webkit.org/show_bug.cgi?id=106133</a> 这是 webkit 中长期存在的一个 bug。scrollTop 和其他类似属性被分配给了 <code>“document.body”</code>，但是却委托给了<code>“document.documentElement”</code>。最终，当 “scrollingElement” 是文档里的大部分元素的时候，这个问题会被解决。同时，令人惊喜的是，这个 bug 不会对我们在问题1中提出的解决方案造成冲突。然而，<code>“scrollTop”</code> 将会一直是 0，从而导致其他连带属性也会受到影响，比如 <code>“window.pageYOffset”</code> 解决方案是添加一个滚动的元素到文档顶部。它的 <code>“getBoundingClientRect().top”</code> 就可以用来重新计算文档的滚动位置。 具体如下所示：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">AMP</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">style</span>=<span class=\"string\">\"overflow-y: auto; -webkit-overflow-scrolling: touch;\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">style</span>=<span class=\"string\">\"</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      overflow-y: auto;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      -webkit-overflow-scrolling: touch;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      position: absolute;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      top: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      left: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      right: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      bottom: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">    \"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"scroll-pos\"</span></span></span><br><span class=\"line\"><span class=\"tag\">      <span class=\"attr\">style</span>=<span class=\"string\">\"</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        position: absolute;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        top: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        left: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        width: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        height: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        visibility: hidden;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      \"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>我们的 JS 代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getScrollTop</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 要对scrollPos.top取负值的原因是滚动位置在计算时，</span></span><br><span class=\"line\">  <span class=\"comment\">// 我们的scrollPos元素会向上滚动，在视口范围外,</span></span><br><span class=\"line\">  <span class=\"comment\">// 此时它的top值是负的</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> -scrollPos.getBoundingClientRect().top;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>从上面的代码可以看出，这个解决方案显得很蠢，但是它确实奏效了。类似的方法可用于“scrollLeft”，“scrollHeight” 以及剩余属性。 然而，我们又有了新的发现。。</p>\n<h3 id=\"问题3：“postion-fixed”-的元素在-“overflow-auto”-容器中会有很多-bug\"><a href=\"#问题3：“postion-fixed”-的元素在-“overflow-auto”-容器中会有很多-bug\" class=\"headerlink\" title=\"问题3：“postion: fixed” 的元素在 “overflow: auto” 容器中会有很多 bug\"></a>问题3：“postion: fixed” 的元素在 “overflow: auto” 容器中会有很多 bug</h3><p>Bug：<a href=\"https://bugs.webkit.org/show_bug.cgi?id=154399\" target=\"_blank\" rel=\"noopener\">https://bugs.webkit.org/show_bug.cgi?id=154399</a> 如果一个 “position: fixed” 元素在一个 “overflow: auto” 的容器中，它的表现会让你很失望：滚动的时候，“position: fixed” 元素会跳远和闪现。它看起来像是稍微滚动一点然而又跳回到正确的位置。这个效果很差，可以通过这个<a href=\"https://drive.google.com/file/d/0B_v8thsbiGyDMXZMZkRFZGFRbjA/view?usp=sharing\" target=\"_blank\" rel=\"noopener\">视频演示</a>看到这个 bug。 要哭了。我们通过各种 hack 解决了各种 bug，最后还是有一个 bug，我们如何解决这个？这里有一个很疯狂的 idea 貌似好使。我们可以添加一个虚拟元素到 “document.documentElement”（不是 “body”，所以它其实是 “body” 的兄弟元素）。我们把它叫做“<strong>固定层</strong>”。他将占据整个视口。我们将使用CSS来找到所有的可能是 “fixed” 的元素（希望不会有太多。。），如果在某些时候它们是确定 “fixed” 的，我们就通过正确的 “z-index” 属性将它们移动到“固定层” 你可能看晕了，直接上代码：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">AMP</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">style</span>=<span class=\"string\">\"overflow-y: auto; -webkit-overflow-scrolling: touch;\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-id\">#fixed-element</span> &#123;</span></span><br><span class=\"line\"><span class=\"undefined\">      position: fixed;</span></span><br><span class=\"line\"><span class=\"undefined\">      right: 20px;</span></span><br><span class=\"line\"><span class=\"undefined\">      top: 20px;</span></span><br><span class=\"line\"><span class=\"undefined\">    &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">  </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">style</span>=<span class=\"string\">\"</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      overflow-y: auto;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      -webkit-overflow-scrolling: touch;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      position: absolute;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      top: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      left: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      right: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      bottom: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">    \"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"fixed-element\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"fixed-layer\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">style</span>=<span class=\"string\">\"</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      position: absolute;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      top: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      left: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      width: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      height: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      pointer-events: none;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">    \"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>当我们找到一个确实 “fixed” 的元素的时候，我们将它移动到“固定层”，像这样：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"fixed-layer\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">style</span>=<span class=\"string\">\"</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      position: absolute;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      top: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      left: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      right: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      bottom: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      pointer-events: none;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">    \"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"fixed-element\"</span></span></span><br><span class=\"line\"><span class=\"tag\">      <span class=\"attr\">style</span>=<span class=\"string\">\"pointer-events: initial; z-index: 11;\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>因此，我们可以根据某元素是否 “fixed” 来将它在 “\bbody” 中的原始位置和“固定层”之间移动。 这个方法就无懈可击了吗？很明显没有：</p>\n<ul>\n<li>\b这代码看都看不懂！</li>\n<li>计算 “z-index” 会相当痛苦</li>\n<li>我们将失去一些 CSS 祖先选择器</li>\n</ul>\n<p>但是它确实是有效的，可以看一下<a href=\"http://github.com/ampproject/amphtml/pull/2128\" target=\"_blank\" rel=\"noopener\">这条PR</a>。还有别的 idea 吗？ 准确来说是有的，下面是作者第二篇文章的译文：</p>\n<h2 id=\"回顾一下\"><a href=\"#回顾一下\" class=\"headerlink\" title=\"回顾一下\"></a>回顾一下</h2><p>简单回顾一下，AMP 文档经常在一个滚动的 iframe 中进行展示。它的 html 结构看起来像这样：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>I'm a Web App and I show AMP documents<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"undefined\">      iframe &#123;</span></span><br><span class=\"line\"><span class=\"undefined\">        position: absolute;</span></span><br><span class=\"line\"><span class=\"undefined\">        top: 0;</span></span><br><span class=\"line\"><span class=\"undefined\">        left: 0;</span></span><br><span class=\"line\"><span class=\"undefined\">        right: 0;</span></span><br><span class=\"line\"><span class=\"undefined\">        bottom: 0;</span></span><br><span class=\"line\"><span class=\"undefined\">      &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">iframe</span> … <span class=\"attr\">width</span>=<span class=\"string\">\"100%\"</span> <span class=\"attr\">height</span>=<span class=\"string\">\"100%\"</span></span></span><br><span class=\"line\"><span class=\"tag\">      <span class=\"attr\">scrolling</span>=<span class=\"string\">\"yes\"</span></span></span><br><span class=\"line\"><span class=\"tag\">      <span class=\"attr\">src</span>=<span class=\"string\">\"https://cdn.ampproject.org/c/pub1.com/doc1\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">iframe</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>在大部分浏览器中，上面这段代码表现很正常。但是在 ios 中会有很多异常表现，我们尝试了很多方法，包括通过内容调整 iframe 大小和滚动主文档。但是他们都有一些性能问题，具体可以参见上面的问题描述。 根本而言，ios 的 safari 浏览器不支持滚动的 iframe。换句话说，<code>“scrolling=yes”</code> 这个属性被直接忽略了。<a href=\"http://jsbin.com/gugika/edit?html,css,output\" target=\"_blank\" rel=\"noopener\">看这个例子</a>。这个 bug 由来已久，可以<a href=\"https://bugs.webkit.org/show_bug.cgi?id=149264\" target=\"_blank\" rel=\"noopener\">在这里</a>发现。 我们在<a href=\"https://github.com/ampproject/amphtml/blob/de7a14d/src/service/viewport-impl.js#L754\" target=\"_blank\" rel=\"noopener\">之前提到的一篇文章</a>中发现了一个很原始的方案。简而言之，我们让真正的 “body” 元素滚动。于是，即使 iframe 它自身不滚动，iframe 中的内容也会滚动，AMP 文档如下：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">AMP</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">style</span>=<span class=\"string\">\"overflow-y: auto; -webkit-overflow-scrolling: touch;\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">body</span></span></span><br><span class=\"line\"><span class=\"tag\">      <span class=\"attr\">style</span>=<span class=\"string\">\"</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        overflow-y: auto;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        -webkit-overflow-scrolling: touch;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        position: absolute;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        top: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        left: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        right: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        bottom: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      \"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">!\\-\\-</span> <span class=\"attr\">document</span> <span class=\"attr\">content</span> <span class=\"attr\">--</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>现在我们 iframe 可以滚动了！这个 AMP 中的解决方案我们用了一年。然而，随着时间的流逝，我们发现了一系列的问题，这些问题在上一篇文章中已经详细介绍过了，这里再简单罗列一下： 给“ body” 添加 “position: absolute” 属性是作者不想看到的，会影响原始布局。另外一个副作用是我们不没办法在 “body” 元素上设置 margin body 的 scrollTop，scrollLeft，scrollHeight 和 scrollWidth 将不起作用。这个 bug 通过上面介绍的注入虚拟 dom 元素可以解决。 “position: fixed” 在 “-webkit-overflow-scrolling: touch” 容器中会有各种 bug 抵消 header 和 footer 需要给 body 设置边框，这个代价很昂贵，因为它缩小了滚动区域，同时可能会打破现有布局。而隐藏头部又会造成 UI 视觉的隔断和滚动的间断 那我们如何解决这个问题呢，我们的主角就要登场了。。</p>\n<h3 id=\"新的解决方案——wrapper-元素\"><a href=\"#新的解决方案——wrapper-元素\" class=\"headerlink\" title=\"新的解决方案——wrapper 元素\"></a>新的解决方案——wrapper 元素</h3><p>这个方案已开源，可以<a href=\"https://github.com/ampproject/amphtml/blob/2d73ac0d9c451dee4c89ac1fa73329b69edca5a4/src/service/viewport-impl.js#L1404\" target=\"_blank\" rel=\"noopener\">点击这里</a>查看源代码</p>\n<h3 id=\"DOM-结构\"><a href=\"#DOM-结构\" class=\"headerlink\" title=\"DOM 结构\"></a>DOM 结构</h3><p>通俗来讲，wrapper 元素和滚动的 “body” 元素是类似的。iframe 在 ios 的 safari 浏览器中依然无法滚动，所以我们需要让 iframe 中的内容滚动。因为让<code>&lt;body&gt;</code>滚动会有一系列问题，所以我们可以创建一个滚动的 wrapper，然后将它放在<code>&lt;html&gt;</code>和<code>&lt;body&gt;</code>中间。换句话说，我们将<code>&lt;body&gt;</code>元素包装在一个可滚动的容器中。 现在的 dom 结构类似这样：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">AMP</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">style</span>=<span class=\"string\">\"overflow-y: auto; -webkit-overflow-scrolling: touch;\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">i-amp-html-wrapper</span></span></span><br><span class=\"line\"><span class=\"tag\">      <span class=\"attr\">style</span>=<span class=\"string\">\"</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        display: block;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        overflow-y: auto;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        -webkit-overflow-scrolling: touch;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        position: absolute;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        top: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        left: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        right: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        bottom: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      \"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">body</span> <span class=\"attr\">style</span>=<span class=\"string\">\"position: relative;\"</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">!\\-\\-</span> <span class=\"attr\">document</span> <span class=\"attr\">content</span> <span class=\"attr\">--</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">i-amp-html-wrapper</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>毫无疑问，这看起来很怪，但是它确实解决了原来的问题——它让 iframe 在 ios 的 safari 浏览器中可以滚动。此外，它也解决了上面描述的许多问题：</p>\n<ul>\n<li>对于<code>&lt;body&gt;</code>元素没有任何强制要求：它仍然拥有原来的“position”属性，同时也可以拥有默认的“overflow: visible”属性。AMP 允许 dom 中的大多数 css 样式，这样可以减少对代码原作者样式的干扰</li>\n<li>可滚动的 wrapper 元素可以用来获取 scrollTop，scrollLeft，scrollHeight 和 scrollWidth 属性，于是之前介绍过的虚拟元素将不再需要</li>\n<li>不再需要给<code>&lt;body&gt;</code>设置边界来抵消 header 和 footer 了——只需要给 wrapper 元素添加 padding 就足够了</li>\n</ul>\n<p>然而，“position: fixed” 的问题仍然存在，我们稍后再谈。</p>\n<h3 id=\"两个-lt-html-gt-元素\"><a href=\"#两个-lt-html-gt-元素\" class=\"headerlink\" title=\"两个&lt;html&gt;元素\"></a>两个<code>&lt;html&gt;</code>元素</h3><p>我们采用了 wrapper 方案，然后很快就碰到了一个小问题。很多人喜欢 html&gt;body 选择器，而我们在 <code>&lt;html&gt;</code> 和 <code>&lt;body&gt;</code> 中间插入了 i-amp-html-wrapper 元素。为了解决这个问题，我们将 i-amp-html-wrapper 作为另外一个 <code>&lt;html&gt;</code> 元素，最终的 dom 结构长这样：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">AMP</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">style</span>=<span class=\"string\">\"overflow-y: auto; -webkit-overflow-scrolling: touch;\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">id</span>=<span class=\"string\">\"i-amp-html-wrapper\"</span></span></span><br><span class=\"line\"><span class=\"tag\">      <span class=\"attr\">style</span>=<span class=\"string\">\"</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        display: block;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        overflow-y: auto;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        -webkit-overflow-scrolling: touch;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        position: absolute;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        top: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        left: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        right: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        bottom: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      \"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">body</span> <span class=\"attr\">style</span>=<span class=\"string\">\"position: relative;\"</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">!\\-\\-</span> <span class=\"attr\">document</span> <span class=\"attr\">content</span> <span class=\"attr\">--</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>加倍奇怪，加倍好玩。总而言之现在 html&gt;body 选择器将正常起作用</p>\n<h3 id=\"实践\"><a href=\"#实践\" class=\"headerlink\" title=\"实践\"></a>实践</h3><p>AMP runtime 会在启动时尽可能早的创建 wrapper 元素。而现有的 <code>&lt;body&gt;</code> 元素会作为子元素放到新建 wrapper 里面</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Create wrapper.</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> wrapper = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'html'</span>);</span><br><span class=\"line\">wrapper.id = <span class=\"string\">'i-amp-html-wrapper'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Setup classes and styles.</span></span><br><span class=\"line\">wrapper.className = <span class=\"built_in\">document</span>.documentElement.className;</span><br><span class=\"line\"><span class=\"built_in\">document</span>.documentElement.className = <span class=\"string\">''</span>;</span><br><span class=\"line\"><span class=\"built_in\">document</span>.documentElement.style = <span class=\"string\">'...'</span>;</span><br><span class=\"line\">wrapper.style = <span class=\"string\">'...'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Attach wrapper straight inside the document root.</span></span><br><span class=\"line\"><span class=\"built_in\">document</span>.documentElement.appendChild(wrapper);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Reparent the body.</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> body = <span class=\"built_in\">document</span>.body;</span><br><span class=\"line\">wrapper.appendChild(body);</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(<span class=\"built_in\">document</span>, <span class=\"string\">'body'</span>, &#123;</span><br><span class=\"line\">  get: <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> body,</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>这段代码很简单，不过有一个细节——将 body 移到 wrapper 里面会将 document.body 重置为 null，因此我们需要将 document.body 重写回初始的 <code>&lt;body&gt;</code> 元素，可以通过 Object.defineProperty 来实现</p>\n<h4 id=\"position-fixed问题\"><a href=\"#position-fixed问题\" class=\"headerlink\" title=\"position: fixed问题\"></a>position: fixed问题</h4><p>尽管 wrapper 方案能够解决大部分问题，但是 position: fixed 的问题仍然存在 这个问题在上面那篇文章已经详细介绍过了，有关 ios 的 safari 浏览器 bug 可以<a href=\"https://bugs.webkit.org/show_bug.cgi?id=154399\" target=\"_blank\" rel=\"noopener\">点击这里</a>查看 简而言之，一个 position: fixed 元素在一个 -webkit-overflow-scrolling: touch 容器中滚动时会出现跳跃和闪现的问题。它看起来像是稍微滚动一点然而又跳回到正确的位置。可以通过这个<a href=\"https://drive.google.com/file/d/0B_v8thsbiGyDMXZMZkRFZGFRbjA/view?usp=sharing\" target=\"_blank\" rel=\"noopener\">视频演示</a>看到这个 bug。 在我们之前的解决方案中，我们将有 position: fixed 属性的元素放到了 <code>&lt;body&gt;</code> 外面，同时放到了一个虚拟“固定层”元素内部，这个“固定层”元素放在了 -webkit-overflow-scrolling: touch 容器外面 最终的 dom 结构：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">AMP</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">style</span>=<span class=\"string\">\"overflow-y: auto; -webkit-overflow-scrolling: touch;\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">id</span>=<span class=\"string\">\"i-amp-html-wrapper\"</span></span></span><br><span class=\"line\"><span class=\"tag\">      <span class=\"attr\">style</span>=<span class=\"string\">\"</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        display: block;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        overflow-y: auto;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        -webkit-overflow-scrolling: touch;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        position: absolute;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        top: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        left: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        right: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        bottom: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      \"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">body</span> <span class=\"attr\">style</span>=<span class=\"string\">\"position: relative;\"</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">!\\-\\-</span> <span class=\"attr\">document</span> <span class=\"attr\">content</span> <span class=\"attr\">--</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">body</span> <span class=\"attr\">id</span>=<span class=\"string\">\"i-amp-fixed-layer\"</span></span></span><br><span class=\"line\"><span class=\"tag\">      <span class=\"attr\">style</span>=<span class=\"string\">\"</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        position: absolute;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        top: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        left: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        right: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        bottom: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        pointer-events: none;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">      \"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">!\\-\\-</span> <span class=\"attr\">fixed</span> <span class=\"attr\">elements</span> <span class=\"attr\">reparented</span> <span class=\"attr\">here</span> <span class=\"attr\">--</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>于是，<strong>我们最终获得了两个<code>&lt;html&gt;</code>元素和两个<code>&lt;body&gt;</code>元素</strong>。看起来很疯狂，但是它确实解决了两个问题： iframe 不滚动和 position:fixed 元素闪现问题 很明显，我们将取得更好的效果如果存在已久的 ios safari 问题被修复。。</p>\n","raw":null,"categories":[{"name":"mobile","path":"api/categories/mobile.json"}],"tags":[{"name":"前端","path":"api/tags/前端.json"},{"name":"AMP","path":"api/tags/AMP.json"},{"name":"fixed","path":"api/tags/fixed.json"},{"name":"ios","path":"api/tags/ios.json"}]}]}