{"title":"与MySQL的零距离接触","slug":"与MySQL的零距离接触","date":"2017-05-09T02:02:40.000Z","updated":"2019-05-05T03:15:41.357Z","comments":true,"path":"api/articles/与MySQL的零距离接触.json","excerpt":null,"covers":["/images/hexo_post_207.png","/images/hexo_post_208.png","/images/hexo_post_209.png","/images/hexo_post_210.png","/images/hexo_post_211.png"],"content":"<h2 id=\"MySQL-基础\"><a href=\"#MySQL-基础\" class=\"headerlink\" title=\"MySQL 基础\"></a>MySQL 基础</h2><p>由瑞典 MySQL AB 公司开发，目前属于 Oracle 公司，MySQL 是一个开源的<strong>关系型</strong>数据库管理系统，分为社区版和企业版</p>\n<h2 id=\"MySQL-一些常用参数\"><a href=\"#MySQL-一些常用参数\" class=\"headerlink\" title=\"MySQL 一些常用参数\"></a>MySQL 一些常用参数</h2><table>\n<thead>\n<tr>\n<th>参数</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>-D，–database=name</td>\n<td>打开指定数据库</td>\n</tr>\n<tr>\n<td>–delimiter=name</td>\n<td>指定分隔符</td>\n</tr>\n<tr>\n<td>-h，–host=name</td>\n<td>服务器名称</td>\n</tr>\n<tr>\n<td>-p，–password[=name]</td>\n<td>密码</td>\n</tr>\n<tr>\n<td>-P，–port=#</td>\n<td>端口号</td>\n</tr>\n<tr>\n<td>–prompt=name</td>\n<td>设置提示符</td>\n</tr>\n<tr>\n<td>-u，–user=name</td>\n<td>用户名</td>\n</tr>\n<tr>\n<td>-V，–version</td>\n<td>输出版本信息并且退出</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"MySQL退出\"><a href=\"#MySQL退出\" class=\"headerlink\" title=\"MySQL退出\"></a>MySQL退出</h3><ul>\n<li>mysql &gt; exit;</li>\n<li>mysql &gt; quit;</li>\n<li>mysql &gt; \\q;</li>\n</ul>\n<h3 id=\"修改-MySQL-提示符\"><a href=\"#修改-MySQL-提示符\" class=\"headerlink\" title=\"修改 MySQL 提示符\"></a>修改 MySQL 提示符</h3><p>连接客户端时通过参数指定提示符：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shell&gt;mysql -uroot -proot --prompt</span><br></pre></td></tr></table></figure>\n<p>连接上客户端后，通过 prompt 命令修改提示符：mysql&gt;prompt，MySQL 提示符修改时可以用到的一些参数：</p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>\\D</td>\n<td>完整的日期</td>\n</tr>\n<tr>\n<td>\\d</td>\n<td>当前数据库</td>\n</tr>\n<tr>\n<td>\\h</td>\n<td>服务器名称</td>\n</tr>\n<tr>\n<td>\\u</td>\n<td>当前用户</td>\n</tr>\n</tbody>\n</table>\n<div align=\"center\"><img src=\"/images/hexo_post_207.png\" alt=\"\" width=\"500\"></div>\n\n<h3 id=\"修改数据表的默认存储引擎\"><a href=\"#修改数据表的默认存储引擎\" class=\"headerlink\" title=\"修改数据表的默认存储引擎\"></a>修改数据表的默认存储引擎</h3><p>找到 MySQL 配置文件：default-storage-engine=INNODB，修改完之后需要重启 MySQL</p>\n<h2 id=\"MySQL-语句的规范\"><a href=\"#MySQL-语句的规范\" class=\"headerlink\" title=\"MySQL 语句的规范\"></a>MySQL 语句的规范</h2><ul>\n<li>关键字与函数名称全部大写</li>\n<li>数据库名称、表名称、字段名称全部小写</li>\n<li>SQL 语句必须以分号结尾</li>\n</ul>\n<h2 id=\"数据类型\"><a href=\"#数据类型\" class=\"headerlink\" title=\"数据类型\"></a>数据类型</h2><ol>\n<li>字符型</li>\n<li>整型</li>\n<li>浮点型</li>\n<li>日期时间型</li>\n</ol>\n<h2 id=\"MySQL-常用命令\"><a href=\"#MySQL-常用命令\" class=\"headerlink\" title=\"MySQL 常用命令\"></a>MySQL 常用命令</h2><ul>\n<li>显示当前服务器版本：SELECT VERSION();</li>\n<li>显示当前日期时间：SELECT NOW();</li>\n<li>显示当前用户：SELECT USER();</li>\n</ul>\n<h3 id=\"创建数据库\"><a href=\"#创建数据库\" class=\"headerlink\" title=\"创建数据库\"></a>创建数据库</h3><ul>\n<li>|：表示可以互换的两项</li>\n<li>[]：表示可选项</li>\n<li>{}：表示必选项</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE &#123;DATABASE | SCHEMA&#125; \\[IF NOT EXISTS\\] db\\_name \\[DEFAULT\\] CHARACTER SET \\[=\\] charset\\_name</span><br></pre></td></tr></table></figure>\n<p>DATABASE | SCHEMA：这两个完全相同，任选其一即可<br>IF NOT EXISTS：可选项，如果存在就不创建，不存在才会创建<br>CHARACTER：设置编码格式，例如 utf-8，gbk</p>\n<h3 id=\"查看当前服务器下的数据表列表\"><a href=\"#查看当前服务器下的数据表列表\" class=\"headerlink\" title=\"查看当前服务器下的数据表列表\"></a>查看当前服务器下的数据表列表</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SHOW &#123;DATABASES | SCHEMAS&#125; \\[LIKE <span class=\"string\">'pattern'</span> | WHERE expr\\]</span><br></pre></td></tr></table></figure>\n<h3 id=\"修改数据库\"><a href=\"#修改数据库\" class=\"headerlink\" title=\"修改数据库\"></a>修改数据库</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER &#123;DATABASE | SCHEMA&#125; \\[db\\_name\\] \\[DEFAULT\\] CHARACTER SET \\[=\\] charset\\_name</span><br></pre></td></tr></table></figure>\n<p>通过以上语句可以修改某个数据库的编码格式</p>\n<h3 id=\"删除数据库\"><a href=\"#删除数据库\" class=\"headerlink\" title=\"删除数据库\"></a>删除数据库</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DROP &#123;DATABASE | SCHEMA&#125; \\[IF EXISTS\\] db_name</span><br></pre></td></tr></table></figure>\n<h3 id=\"打开数据库\"><a href=\"#打开数据库\" class=\"headerlink\" title=\"打开数据库\"></a>打开数据库</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">USE db_name</span><br></pre></td></tr></table></figure>\n<h3 id=\"创建数据表\"><a href=\"#创建数据表\" class=\"headerlink\" title=\"创建数据表\"></a>创建数据表</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE \\[IF NOT EXISTS\\] table\\_name( column\\_name data_type, .... )</span><br></pre></td></tr></table></figure>\n<h3 id=\"查看数据表列表\"><a href=\"#查看数据表列表\" class=\"headerlink\" title=\"查看数据表列表\"></a>查看数据表列表</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SHOW TABLES \\[FROM db_name\\] \\[LIKE <span class=\"string\">'pattern'</span> | WHERE expr\\]</span><br></pre></td></tr></table></figure>\n<p>FROM db_name：不仅可以查看当前数据库中的数据表，还可以查看其他数据库中的数据表</p>\n<h3 id=\"查看数据表结构\"><a href=\"#查看数据表结构\" class=\"headerlink\" title=\"查看数据表结构\"></a>查看数据表结构</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SHOW COLUMNS FROM tbl_name</span><br></pre></td></tr></table></figure>\n<p>tbl_name：数据表的名称</p>\n<h3 id=\"插入记录\"><a href=\"#插入记录\" class=\"headerlink\" title=\"插入记录\"></a>插入记录</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INSERT \\[INFO\\] tbl\\_name \\[(col\\_name,...)\\] VALUES(val,...)</span><br></pre></td></tr></table></figure>\n<p>如果省略 col_name (列名称)，就必须为所有字段都赋值</p>\n<h3 id=\"记录查找\"><a href=\"#记录查找\" class=\"headerlink\" title=\"记录查找\"></a>记录查找</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT expr,... FROM tbl_name</span><br></pre></td></tr></table></figure>\n<p>expr：表达式</p>\n<h2 id=\"字段属性设置\"><a href=\"#字段属性设置\" class=\"headerlink\" title=\"字段属性设置\"></a>字段属性设置</h2><h3 id=\"空值与非空\"><a href=\"#空值与非空\" class=\"headerlink\" title=\"空值与非空\"></a>空值与非空</h3><ul>\n<li>NULL：字段值可以为空（默认值）</li>\n<li>NOT NULL：字段值禁止为空</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE tbl_name(username VARCHAR(20) NOT NULL,age TINYINT UNSIGNED NULL);</span><br></pre></td></tr></table></figure>\n<div align=\"center\"><img src=\"/images/hexo_post_208.png\" alt=\"\" width=\"400\"></div>\n\n<h2 id=\"表级约束与列级约束\"><a href=\"#表级约束与列级约束\" class=\"headerlink\" title=\"表级约束与列级约束\"></a>表级约束与列级约束</h2><p>对一个数据列建立的约束，称为列级约束 对多个数据列建立的约束，称为表级约束 列级约束既可以在列定义时声明，也可以在列定义后声明 表级约束只能在列定义后声明</p>\n<h3 id=\"主键约束\"><a href=\"#主键约束\" class=\"headerlink\" title=\"主键约束\"></a>主键约束</h3><p>PRIMARY KEY：每张数据表只能存在一个主键，主键保证记录的唯一性，主键自动为 NOT NULL，主键不一定和下面的自动编号一起使用，但是不能赋相同的值</p>\n<h3 id=\"自动编号\"><a href=\"#自动编号\" class=\"headerlink\" title=\"自动编号\"></a>自动编号</h3><p>AUTO_INCREMENT：必须与主键组合使用，默认情况下，起始值为 1，每次的增量为 1，该字段的数据类型必须为数字，如果是浮点数必须小数位数为 0</p>\n<h3 id=\"唯一约束\"><a href=\"#唯一约束\" class=\"headerlink\" title=\"唯一约束\"></a>唯一约束</h3><p>UNIQUE KEY：可以保证记录的唯一性，字段可以为空值（NULL），每张数据表可以存在多个唯一约束</p>\n<h3 id=\"默认约束\"><a href=\"#默认约束\" class=\"headerlink\" title=\"默认约束\"></a>默认约束</h3><p>DEFAULT：当插入记录时，如果没有明确为字段赋值，则自动赋予默认值</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sex enum(<span class=\"string\">'1'</span>,<span class=\"string\">'2'</span>,<span class=\"string\">'3'</span>) DEFAULT <span class=\"string\">'3'</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"外键约束\"><a href=\"#外键约束\" class=\"headerlink\" title=\"外键约束\"></a>外键约束</h3><p>FOREIGN KEY：保持数据一致性和完整性，实现一对一或一对多关系</p>\n<h4 id=\"外键约束的要求\"><a href=\"#外键约束的要求\" class=\"headerlink\" title=\"外键约束的要求\"></a>外键约束的要求</h4><ol>\n<li>父表和子表必须使用相同的存储引擎，而且禁止使用临时表</li>\n<li>数据表的存储引擎只能为 InnoDB</li>\n<li>外键列和参照列必须具有相似的数据类型，其中数字的长度或是否有符号位必须相同；而字符的长度则可以不同</li>\n<li>外键列和参照列必须创建索引，如果外键列不存在索引的话，MySQL 将自动创建索引</li>\n</ol>\n<h4 id=\"外键约束的参照操作\"><a href=\"#外键约束的参照操作\" class=\"headerlink\" title=\"外键约束的参照操作\"></a>外键约束的参照操作</h4><ol>\n<li>CASCADE：从父表删除或更新且自动删除或更新子表中匹配的行</li>\n<li>SET NULL：从父表删除或更新行，并设置子表中的外键列为 NULL。如果使用该选项，必须保证子表列没有指定NOT NULL</li>\n<li>RESTRICT：拒绝对父表的删除或更新操作</li>\n<li>NO ACTION：标准 SQL 的关键字，在 MySQL 中与 RESTRICT 相同</li>\n</ol>\n<p>pid INT,FOREIGN KEY (pid) REFERENCES provinces (id) ON DELETE CASCADE =&gt; pid 为外键约束，参照数据表 provinces 中的 id 字段；并且删除时的参照操作为 CASCADE</p>\n<h2 id=\"修改数据表\"><a href=\"#修改数据表\" class=\"headerlink\" title=\"修改数据表\"></a>修改数据表</h2><h3 id=\"添加单列\"><a href=\"#添加单列\" class=\"headerlink\" title=\"添加单列\"></a>添加单列</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl\\_name ADD \\[COLUMN\\] col\\_name column\\_definition \\[FIRST | AFTER col\\_name\\]</span><br></pre></td></tr></table></figure>\n<p>FIRST：新添加的列将置于最前面<br>AFTER col_name：新添加的列将置于某一列后面<br>如果省略以上两项，新添加的列将位于所有列最后面</p>\n<h3 id=\"添加多列\"><a href=\"#添加多列\" class=\"headerlink\" title=\"添加多列\"></a>添加多列</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl\\_name ADD \\[COLUMN\\] (col\\_name column_definition,...)</span><br></pre></td></tr></table></figure>\n<p>添加多列时无法指定位置，只能位于最后面</p>\n<h3 id=\"删除列\"><a href=\"#删除列\" class=\"headerlink\" title=\"删除列\"></a>删除列</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl\\_name DROP \\[COLUMN\\] col\\_name</span><br></pre></td></tr></table></figure>\n<p>ALTER TABLE tbl_name DROP age,DROP password =&gt; 可以同时删除 age 列和 password 列</p>\n<h3 id=\"添加约束\"><a href=\"#添加约束\" class=\"headerlink\" title=\"添加约束\"></a>添加约束</h3><h4 id=\"添加主键约束\"><a href=\"#添加主键约束\" class=\"headerlink\" title=\"添加主键约束\"></a>添加主键约束</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl\\_name ADD \\[CONSTRAINT \\[symbol\\] \\] PRIMARY KEY \\[index\\_type\\] (index\\_col\\_name,...)</span><br></pre></td></tr></table></figure>\n<h4 id=\"添加唯一约束\"><a href=\"#添加唯一约束\" class=\"headerlink\" title=\"添加唯一约束\"></a>添加唯一约束</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl\\_name ADD \\[CONSTRAINT \\[symbol\\] \\] UNIQUE \\[INDEX | KEY\\] \\[index\\_name\\] \\[index\\_type\\] (index\\_col_name,...)</span><br></pre></td></tr></table></figure>\n<p>唯一约束可以给多列添加</p>\n<h4 id=\"添加外键约束\"><a href=\"#添加外键约束\" class=\"headerlink\" title=\"添加外键约束\"></a>添加外键约束</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl\\_name ADD \\[CONSTRAINT \\[symbol\\] \\] FOREIGN KEY \\[index\\_name\\] (index\\_col\\_name,...) reference_definition</span><br></pre></td></tr></table></figure>\n<h4 id=\"添加-删除默认约束\"><a href=\"#添加-删除默认约束\" class=\"headerlink\" title=\"添加/删除默认约束\"></a>添加/删除默认约束</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl\\_name ALTER \\[COLUMN\\] col\\_name &#123;SET DEFAULT literal | DROP DEFAULT&#125;</span><br></pre></td></tr></table></figure>\n<p>SET DEFAULT literal：添加默认约束<br>DROP DEFAULT：删除默认约束</p>\n<h3 id=\"删除约束\"><a href=\"#删除约束\" class=\"headerlink\" title=\"删除约束\"></a>删除约束</h3><h4 id=\"删除主键约束\"><a href=\"#删除主键约束\" class=\"headerlink\" title=\"删除主键约束\"></a>删除主键约束</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl_name DROP PRIMARY KEY</span><br></pre></td></tr></table></figure>\n<h4 id=\"删除唯一约束\"><a href=\"#删除唯一约束\" class=\"headerlink\" title=\"删除唯一约束\"></a>删除唯一约束</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl\\_name DROP &#123;INDEX | KEY&#125; index\\_name</span><br></pre></td></tr></table></figure>\n<p>一张表可以有多个唯一约束，所以需要查看约束的名字 =&gt; SHOW INDEXES FROM tbl_name [\\G];</p>\n<h4 id=\"删除外键约束\"><a href=\"#删除外键约束\" class=\"headerlink\" title=\"删除外键约束\"></a>删除外键约束</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl\\_name DROP FOREIGN KEY fk\\_symbol</span><br></pre></td></tr></table></figure>\n<p>fk_symbol：约束的名字，需要提前查看 =&gt; SHOW CREATE tbl_name</p>\n<h3 id=\"修改列定义\"><a href=\"#修改列定义\" class=\"headerlink\" title=\"修改列定义\"></a>修改列定义</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl\\_name MODIFY \\[COLUMN\\] col\\_name column\\_definition \\[FIRST | AFTER col\\_name\\]</span><br></pre></td></tr></table></figure>\n<p>可以修改数据类型以及数据列的位置</p>\n<h3 id=\"修改列名称\"><a href=\"#修改列名称\" class=\"headerlink\" title=\"修改列名称\"></a>修改列名称</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl\\_name CHANGE \\[COLUMN\\] old\\_col\\_name new\\_col\\_name column\\_definition \\[FIRST | AFTER col_name\\]</span><br></pre></td></tr></table></figure>\n<p>修改列名称的同时也可以修改列类型和位置，所以其功能要强大于修改列定义</p>\n<h3 id=\"数据表更名\"><a href=\"#数据表更名\" class=\"headerlink\" title=\"数据表更名\"></a>数据表更名</h3><p>尽量少更改数据表和数据列名字，因为如果创建过索引和约束，会影响到正常使用</p>\n<h4 id=\"方法1\"><a href=\"#方法1\" class=\"headerlink\" title=\"方法1\"></a>方法1</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl\\_name RENAME \\[TO | AS\\] new\\_tbl_name</span><br></pre></td></tr></table></figure>\n<h4 id=\"方法2\"><a href=\"#方法2\" class=\"headerlink\" title=\"方法2\"></a>方法2</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RENAME TABLE tbl\\_name TO new\\_tbl\\_name \\[,tbl\\_name2 TO new\\_tbl\\_name2\\] ...</span><br></pre></td></tr></table></figure>\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><div align=\"center\"><img src=\"/images/hexo_post_209.png\" alt=\"\" width=\"400\"></div>\n\n<h2 id=\"记录操作\"><a href=\"#记录操作\" class=\"headerlink\" title=\"记录操作\"></a>记录操作</h2><h3 id=\"插入记录-1\"><a href=\"#插入记录-1\" class=\"headerlink\" title=\"插入记录\"></a>插入记录</h3><h4 id=\"第一种\"><a href=\"#第一种\" class=\"headerlink\" title=\"第一种\"></a>第一种</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INSERT \\[INTO\\] tbl\\_name \\[(col\\_name,...)\\] &#123;VALUES | VALUE&#125; (&#123;expr | DEFAULT&#125;,...&#125;,(...),...</span><br></pre></td></tr></table></figure>\n<p>可以插入一条记录，也可以插入多条记录 INSERT users VALUES(NULL,’John’,’456’,25,1); =&gt; NULL 为空值，也可以为自增字段赋值（DEFAULT也可以）</p>\n<p>INSERT users VALUES(\bDEFAULT,’Tom’,’123’,3*7-5,1),(NULL,’Rose’,md5(‘123’),DEFAULT,0); =&gt; 插入多条记录，可以用表达式，也可以用函数、NULL、DEFAULT</p>\n<h4 id=\"第二种\"><a href=\"#第二种\" class=\"headerlink\" title=\"第二种\"></a>第二种</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INSERT \\[INTO\\] tbl\\_name SET col\\_name=&#123;expr | DEFAULT&#125;,...</span><br></pre></td></tr></table></figure>\n<p>与第一种方式的区别在于，此方法可以使用子查询(SubQuery)，但是此方法只能插入一条记录<br>INSERT users SET username=’Ben’,password=’456’; =&gt; 将这两条数据列插入users，其他数据列为默认值<br>INSERT test(username) SELECT username FROM users WHERE age&gt;=30; =&gt; 将 users 数据表中的 age &gt;= 30 的记录中的 username 数据列插入到 test 的 username 数据列中</p>\n<h3 id=\"第三种\"><a href=\"#第三种\" class=\"headerlink\" title=\"第三种\"></a>第三种</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INSERT \\[INTO\\] tbl\\_name \\[(col\\_name,...)\\] SELECT ...</span><br></pre></td></tr></table></figure>\n<p>此方法可以将查询结果插入到指定数据表</p>\n<h3 id=\"更新记录（单表更新）\"><a href=\"#更新记录（单表更新）\" class=\"headerlink\" title=\"更新记录（单表更新）\"></a>更新记录（单表更新）</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">UPDATE \\[LOW\\_PRIORITY\\] \\[IGNORE\\] table\\_reference SET col\\_name1=&#123;expr1 | DEFAULT&#125; \\[,col\\_name2=&#123;expr2 | DEFAULT&#125;\\] ... \\[WHERE where_condition\\]</span><br></pre></td></tr></table></figure>\n<p>UPDATE users SET age=age-id,sex=0 WHERE id%2=0; =&gt; 将 id 为偶数的记录的 age 设置为 age-id，sex 设置为 0</p>\n<h3 id=\"删除记录（单表删除）\"><a href=\"#删除记录（单表删除）\" class=\"headerlink\" title=\"删除记录（单表删除）\"></a>删除记录（单表删除）</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DELETE FROM tbl\\_name \\[WHERE <span class=\"built_in\">where</span>\\_condition\\]</span><br></pre></td></tr></table></figure>\n<h3 id=\"查找记录\"><a href=\"#查找记录\" class=\"headerlink\" title=\"查找记录\"></a>查找记录</h3><p>查找记录占据了 MySQL 语句的 80% 频率</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT select\\_expr \\[,select\\_expr ...\\] \\[ FROM table\\_references \\[WHERE <span class=\"built_in\">where</span>\\_condition\\] \\[GROUP BY &#123;col\\_name | position&#125; \\[ASC | DESC\\],...\\] \\[HAVING <span class=\"built_in\">where</span>\\_condition\\] \\[ORDER BY &#123;col\\_name | expr | position&#125; \\[ASC | DESC\\],...\\] \\[LIMIT &#123;\\[offset,\\] row\\_count | row_count OFFSET offset&#125;\\] \\]</span><br></pre></td></tr></table></figure>\n<h4 id=\"select-expr\"><a href=\"#select-expr\" class=\"headerlink\" title=\"select_expr\"></a>select_expr</h4><p>查询表达式</p>\n<ul>\n<li>每一个表达式表示想要的一列，必须有至少一个</li>\n<li>多个列之间以英文逗号分隔</li>\n<li>星号(<em>)表示所有列；tbl_name.</em> 可以表示命名表的所有列</li>\n<li>查询表达式可以使用 [AS] alias_name 为其赋予别名</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT username AS uname FROM users;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>别名可用于 GROUP BY,ORDRE BY 或 HAVING 子句</li>\n</ul>\n<h4 id=\"WHERE\"><a href=\"#WHERE\" class=\"headerlink\" title=\"WHERE\"></a>WHERE</h4><p>条件表达式 对记录进行过滤，如果没有指定WHERE子句，则显示所有记录 在 WHERE 表达式中，可以使用 MySQL 支持的函数或运算符</p>\n<h4 id=\"GROUP-BY\"><a href=\"#GROUP-BY\" class=\"headerlink\" title=\"GROUP BY\"></a>GROUP BY</h4><p>查询结果分组</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\\[GROUP BY &#123;col_name | position&#125; \\[ASC | DESC\\], ...\\]</span><br></pre></td></tr></table></figure>\n<p>既可以指定列名，也可以指定列的位置 ASC 为升序（默认），DESC 为降序</p>\n<h4 id=\"HAVING\"><a href=\"#HAVING\" class=\"headerlink\" title=\"HAVING\"></a>HAVING</h4><p>分组条件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\\[HAVING where_condition\\]</span><br></pre></td></tr></table></figure>\n<h4 id=\"ORDER-BY\"><a href=\"#ORDER-BY\" class=\"headerlink\" title=\"ORDER BY\"></a>ORDER BY</h4><p>对查询结果进行排序</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\\[ORDER BY &#123;col_name | expr | position&#125; \\[ASC | DESC\\],...\\]</span><br></pre></td></tr></table></figure>\n<p>可以指定多个数据列进行排序，当第一个数据列的值相同时，按照第二个数据列进行排序，以此类推……</p>\n<h4 id=\"LIMIT\"><a href=\"#LIMIT\" class=\"headerlink\" title=\"LIMIT\"></a>LIMIT</h4><p>限制查询结果返回的数量</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\\[LIMIT &#123;\\[offset,\\] row\\_count | row\\_count OFFSET offset&#125;\\]</span><br></pre></td></tr></table></figure>\n<p>SELECT * FROM users LIMIT 3,2; =&gt; 从索引值为 3（第四条记录）的记录开始返回两条记录</p>\n<h2 id=\"子查询\"><a href=\"#子查询\" class=\"headerlink\" title=\"子查询\"></a>子查询</h2><p>子查询(Subquery)是指出现在其他 SQL 语句内的 SELECT 子句<br>SELECT <em> FROM t1 WHERE col1 = (SELECT col2 FROM t2); =&gt; 其中SELECT </em> FROM t1 称为 Outer Query/Outer Statement,SELECT col2 FROM t2 称为 SubQuery</p>\n<ul>\n<li>子查询指嵌套在查询内部，且必须始终出现在圆括号内</li>\n<li>子查询可以包含多个关键字或条件，如 DISTINCT、GROUP BY、ORDER BY、LIMIT 函数等</li>\n<li>子查询的外层查询可以是：SELECT，INSERT，UPDATE，SET 或 DO</li>\n</ul>\n<h3 id=\"子查询返回值\"><a href=\"#子查询返回值\" class=\"headerlink\" title=\"子查询返回值\"></a>子查询返回值</h3><p>子查询可以返回标量、一行、一列或子查询</p>\n<h3 id=\"使用比较运算法的子查询\"><a href=\"#使用比较运算法的子查询\" class=\"headerlink\" title=\"使用比较运算法的子查询\"></a>使用比较运算法的子查询</h3><p>=、&gt;、&lt;、&gt;=、&lt;=、&lt;&gt;、!=、&lt;=&gt;</p>\n<h3 id=\"语法结构\"><a href=\"#语法结构\" class=\"headerlink\" title=\"语法结构\"></a>语法结构</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">operand comparison_operator subquery</span><br></pre></td></tr></table></figure>\n<h3 id=\"用-ANY、SOME-或-ALL-修饰的比较运算符\"><a href=\"#用-ANY、SOME-或-ALL-修饰的比较运算符\" class=\"headerlink\" title=\"用 ANY、SOME 或 ALL 修饰的比较运算符\"></a>用 ANY、SOME 或 ALL 修饰的比较运算符</h3><ol>\n<li>operand comparison_operator ANY (subquery)</li>\n<li>operand comparison_operator SOME (subquery)</li>\n<li>operand comparison_operator ALL (subquery)</li>\n</ol>\n<p>运算符和关键字相结合之后的结果类型：</p>\n<div align=\"center\"><img src=\"/images/hexo_post_210.png\" alt=\"\" width=\"400\"></div>\n\n<h3 id=\"使用-NOT-IN-的子查询\"><a href=\"#使用-NOT-IN-的子查询\" class=\"headerlink\" title=\"使用 [NOT] IN 的子查询\"></a>使用 [NOT] IN 的子查询</h3><h4 id=\"语法结构-1\"><a href=\"#语法结构-1\" class=\"headerlink\" title=\"语法结构\"></a>语法结构</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">operand comparison_operator \\[NOT\\] IN (subquery)</span><br></pre></td></tr></table></figure>\n<ul>\n<li>=ANY 运算符与 IN 等效</li>\n<li>!=ALL 或 &lt;&gt;ALL 运算符与 NOT IN 等效</li>\n</ul>\n<h3 id=\"使用-NOT-EXISTS-的子查询\"><a href=\"#使用-NOT-EXISTS-的子查询\" class=\"headerlink\" title=\"使用 [NOT] EXISTS 的子查询\"></a>使用 [NOT] EXISTS 的子查询</h3><p>如果子查询返回任何行，EXISTS 将返回 TRUE，否则为 FALSE</p>\n<h2 id=\"多表操作\"><a href=\"#多表操作\" class=\"headerlink\" title=\"多表操作\"></a>多表操作</h2><h3 id=\"多表更新\"><a href=\"#多表更新\" class=\"headerlink\" title=\"多表更新\"></a>多表更新</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">UPDATE table\\_references SET col\\_name1 = &#123;expr1 | DEFAULT&#125; \\[,col\\_name2= &#123;expr2 | DEFAULT&#125;\\] ...\\[WHERE <span class=\"built_in\">where</span>\\_condition\\]</span><br></pre></td></tr></table></figure>\n<h3 id=\"CREATE…SELECT\"><a href=\"#CREATE…SELECT\" class=\"headerlink\" title=\"CREATE…SELECT\"></a>CREATE…SELECT</h3><p>创建数据表同时将查询结果写入到数据表</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE \\[IF NOT EXISTS\\] tbl\\_name \\[(create\\_definition,...)\\] select_statement</span><br></pre></td></tr></table></figure>\n<p>CREATE TABLE tdb_goods_brands(brand_id SMALLINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,brand_name VARCHAR(40) NOT NULL) SELECT brand_name FROM tdb_goods GROUP BY brand_name; =&gt; 创建表 tdb_goods_brands 的同时将 tdb_goods 中的 brand_name 数据列的值赋给新表 tdb_goods_brands 中的 brand_name 数据列</p>\n<h3 id=\"表的连接\"><a href=\"#表的连接\" class=\"headerlink\" title=\"表的连接\"></a>表的连接</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">table\\_reference &#123;\\[INNER | CROSS\\] JOIN | &#123;LEFT | RIGHT&#125; \\[OUTER\\] JOIN&#125; table\\_reference ON conditional_expr</span><br></pre></td></tr></table></figure>\n<p>table_reference：连接的两张表的名字<br>conditional_expr：连接条件，使用 ON 关键字来设定连接条件，也可以使用 WHERE 来代替：通常使用 ON 关键字来设定连接条件，使用 WHERE 关键字进行结果集记录的过滤</p>\n<h4 id=\"连接类型\"><a href=\"#连接类型\" class=\"headerlink\" title=\"连接类型\"></a>连接类型</h4><ol>\n<li>INNER JOIN，内连接，在 MySQL 中，JOIN，CROSS JOIN 和 INNER JOIN 是等价的</li>\n<li>LEFT [OUTER] JOIN，左外连接</li>\n<li>RIGHT [OUTER] JOIN，右外连接</li>\n</ol>\n<p>UPDATE tdb_goods AS g INNER JOIN tdb_goods_brands AS b ON g.brand_name=b.brand_name SET g.brand_name=b.brand_id; =&gt; 按照 tdb_goods_brands (设置别名为 b)表更新 tdb_goods (设置别名为 g)表，连接条件为表 g 的brand_name 和表 b 的 brand_name 字段值相等，更新操作为将 g 中的 brand_name 更改为 b 中的 brand_id</p>\n<h4 id=\"内连接\"><a href=\"#内连接\" class=\"headerlink\" title=\"内连接\"></a>内连接</h4><p>仅显示左表及右表符合连接条件的记录（交集、公共部分）</p>\n<h4 id=\"左（右）外连接\"><a href=\"#左（右）外连接\" class=\"headerlink\" title=\"左（右）外连接\"></a>左（右）外连接</h4><p>显示左（右）表的全部记录及右（左）表符合连接条件的记录 A LEFT JOIN B join_condition 如果数据表 A 的某条记录符合 WHERE 条件，但是在数据表B不存在符合连接条件的记录，将生成一个所有列为空的额外的B行</p>\n<h3 id=\"多表删除\"><a href=\"#多表删除\" class=\"headerlink\" title=\"多表删除\"></a>多表删除</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DELETE tbl\\_name\\[.*\\] \\[,tbl\\_name\\[.*\\]\\] ... FROM table\\_references \\[WHERE <span class=\"built_in\">where</span>\\_condition\\]</span><br></pre></td></tr></table></figure>\n<h2 id=\"系统内置函数\"><a href=\"#系统内置函数\" class=\"headerlink\" title=\"系统内置函数\"></a>系统内置函数</h2><h3 id=\"字符函数\"><a href=\"#字符函数\" class=\"headerlink\" title=\"字符函数\"></a>字符函数</h3><table>\n<thead>\n<tr>\n<th>函数名称</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>CONCAT()</td>\n<td>字符连接</td>\n</tr>\n<tr>\n<td>CONCAT_WS()</td>\n<td>使用指定的分隔符进行字符连接</td>\n</tr>\n<tr>\n<td>FORMAT()</td>\n<td>数字格式化</td>\n</tr>\n<tr>\n<td>LOWER()</td>\n<td>转换成小写字母</td>\n</tr>\n<tr>\n<td>UPPER()</td>\n<td>转换成大写字母</td>\n</tr>\n<tr>\n<td>LEFT()</td>\n<td>获取左侧字符</td>\n</tr>\n<tr>\n<td>RIGHT()</td>\n<td>获取右侧字符</td>\n</tr>\n<tr>\n<td>LENGTH()</td>\n<td>获取字符串长度</td>\n</tr>\n<tr>\n<td>LTRIM()</td>\n<td>删除前导空格</td>\n</tr>\n<tr>\n<td>RTRIM()</td>\n<td>删除后续空格</td>\n</tr>\n<tr>\n<td>TRIM()</td>\n<td>删除前导和后续空格</td>\n</tr>\n<tr>\n<td>SUBSTRING()</td>\n<td>字符串截取</td>\n</tr>\n<tr>\n<td>[NOT] LIKE</td>\n<td>模式匹配</td>\n</tr>\n<tr>\n<td>REPLACE()</td>\n<td>字符串替换</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"CONCAT\"><a href=\"#CONCAT\" class=\"headerlink\" title=\"CONCAT()\"></a>CONCAT()</h3><p>SELECT CONCAT(first_name,last_name) AS fullname FROM test; =&gt; 将数据表 test 中的 first_name 和 last_name 中的数据连接到一起进行输出，并命名为 fullname</p>\n<h3 id=\"FORMAT\"><a href=\"#FORMAT\" class=\"headerlink\" title=\"FORMAT()\"></a>FORMAT()</h3><p>SELECT FORMAT(12560.75,2); =&gt; 转换成 12,560.75（千分位）<br>SELECT FORMAT(12560.75,1); =&gt; 转换成 12,560.8（四舍五入）<br>SELECT FORMAT(12560.75,0); =&gt; 转换成 12,561（取整）</p>\n<h3 id=\"TRIM\"><a href=\"#TRIM\" class=\"headerlink\" title=\"TRIM()\"></a>TRIM()</h3><p>除了删除首尾空格，还可以删除指定其他字符 SELECT TRIM(LEADING ‘?’ FROM ‘??MySQL???’); =&gt; MySQL???，LEADING 关键字代表前导，所以这句话的含义是删除字符串前面的’?’字符；将 LEADING 换为 TRAILING 表示去掉尾部相应字符，换为 BOTH 表示去掉首尾相应字符</p>\n<h3 id=\"NOT-LIKE\"><a href=\"#NOT-LIKE\" class=\"headerlink\" title=\"[NOT] LIKE\"></a>[NOT] LIKE</h3><p>SELECT <em> FROM test WHERE first_name LIKE ‘%o%’; => tom%，%相当于</em>，所以 LIKE 有点类似于正则匹配</p>\n<h3 id=\"数值运算符与函数\"><a href=\"#数值运算符与函数\" class=\"headerlink\" title=\"数值运算符与函数\"></a>数值运算符与函数</h3><table>\n<thead>\n<tr>\n<th>名称</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>CEIL()</td>\n<td>进一取整</td>\n</tr>\n<tr>\n<td>DIV</td>\n<td>整数除法</td>\n</tr>\n<tr>\n<td>FLOOR()</td>\n<td>舍一取整</td>\n</tr>\n<tr>\n<td>MOD</td>\n<td>取余数（取模）</td>\n</tr>\n<tr>\n<td>POWER()</td>\n<td>幂运算</td>\n</tr>\n<tr>\n<td>ROUND()</td>\n<td>四舍五入</td>\n</tr>\n<tr>\n<td>TRUNCATE()</td>\n<td>数字截取</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"TRUNCATE\"><a href=\"#TRUNCATE\" class=\"headerlink\" title=\"TRUNCATE()\"></a>TRUNCATE()</h3><p>数字截取，不会进行运算，TRUNCATE(125.89,0); => 125，TRUNCATE(125.89,-1); => 120</p>\n<h3 id=\"比较运算符与函数\"><a href=\"#比较运算符与函数\" class=\"headerlink\" title=\"比较运算符与函数\"></a>比较运算符与函数</h3><table>\n<thead>\n<tr>\n<th>名称</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>[NOT] BETWEEN…AND…</td>\n<td>[不]在范围之内</td>\n</tr>\n<tr>\n<td>[NOT] IN()</td>\n<td>[不]在列出值范围内</td>\n</tr>\n<tr>\n<td>IS [NOT] NULL</td>\n<td>[不]为空</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"日期时间函数\"><a href=\"#日期时间函数\" class=\"headerlink\" title=\"日期时间函数\"></a>日期时间函数</h3><table>\n<thead>\n<tr>\n<th>名称</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>NOW()</td>\n<td>当前日期和时间</td>\n</tr>\n<tr>\n<td>CURDATE()</td>\n<td>当前日期</td>\n</tr>\n<tr>\n<td>CURTIME()</td>\n<td>当前时间</td>\n</tr>\n<tr>\n<td>DATE_ADD()</td>\n<td>日期变化</td>\n</tr>\n<tr>\n<td>DATEDIFF()</td>\n<td>日期差值</td>\n</tr>\n<tr>\n<td>DATE_FORMAT()</td>\n<td>日期格式化</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"DATE-ADD\"><a href=\"#DATE-ADD\" class=\"headerlink\" title=\"DATE_ADD()\"></a>DATE_ADD()</h3><p>DATE_ADD(‘2014-3-12’,INTERVAL 3 \bWEEK); =&gt; 2014-04-02<br>DATE_ADD(‘2014-3-12’,INTERVAL -365 DAY); =&gt; 2013-3-12</p>\n<h3 id=\"DATEDIFF\"><a href=\"#DATEDIFF\" class=\"headerlink\" title=\"DATEDIFF()\"></a>DATEDIFF()</h3><p>DATEDIFF(‘2013-3-12’,’2014-3-12’); =&gt;-365</p>\n<h3 id=\"DATE-FORMAT\"><a href=\"#DATE-FORMAT\" class=\"headerlink\" title=\"DATE_FORMAT()\"></a>DATE_FORMAT()</h3><p>DATE_FORMAT(‘2014-3-2’,’%m/%d/%Y’); =&gt;03/02/2014</p>\n<h3 id=\"信息函数\"><a href=\"#信息函数\" class=\"headerlink\" title=\"信息函数\"></a>信息函数</h3><table>\n<thead>\n<tr>\n<th>名称</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>CONNECTION_ID()</td>\n<td>连接ID</td>\n</tr>\n<tr>\n<td>DATABASE()</td>\n<td>当前数据库</td>\n</tr>\n<tr>\n<td>LAST_INSERT_ID()</td>\n<td>最后插入记录的ID号</td>\n</tr>\n<tr>\n<td>USER()</td>\n<td>当前用户</td>\n</tr>\n<tr>\n<td>VERSION()</td>\n<td>版本信息</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"LAST-INSERT-ID\"><a href=\"#LAST-INSERT-ID\" class=\"headerlink\" title=\"LAST_INSERT_ID()\"></a>LAST_INSERT_ID()</h3><p>当使用该函数时，当前数据表中必须存在一个自增的字段，字段名可以不为 id，当同时写入多条记录时，只返回插入的第一条记录的 ID 值</p>\n<h3 id=\"聚合函数\"><a href=\"#聚合函数\" class=\"headerlink\" title=\"聚合函数\"></a>聚合函数</h3><table>\n<thead>\n<tr>\n<th>名称</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>AVG()</td>\n<td>平均值</td>\n</tr>\n<tr>\n<td>COUNT()</td>\n<td>计数</td>\n</tr>\n<tr>\n<td>MAX()</td>\n<td>最大值</td>\n</tr>\n<tr>\n<td>MIN()</td>\n<td>最小值</td>\n</tr>\n<tr>\n<td>SUM()</td>\n<td>求和</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"AVG\"><a href=\"#AVG\" class=\"headerlink\" title=\"AVG()\"></a>AVG()</h4><p>SELECT AVG(age) FROM test; =&gt; 返回 test 数据表中的 age 平均值</p>\n<h2 id=\"自定义函数\"><a href=\"#自定义函数\" class=\"headerlink\" title=\"自定义函数\"></a>自定义函数</h2><p>用户自定义函数（user-defined function,UDF）是一种对 MySQL 扩展的途径，其用法与内置函数相同</p>\n<h3 id=\"必要条件\"><a href=\"#必要条件\" class=\"headerlink\" title=\"必要条件\"></a>必要条件</h3><ol>\n<li>参数（理论上不超过 1024 个参数）</li>\n<li>返回值</li>\n</ol>\n<p>函数可以返回任意类型的值，同样可以接收这些类型的参数</p>\n<h3 id=\"创建自定义函数\"><a href=\"#创建自定义函数\" class=\"headerlink\" title=\"创建自定义函数\"></a>创建自定义函数</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE FUNCTION <span class=\"keyword\">function</span>\\_name RETURNS &#123;STRING | INTERGER | REAL | DECIMAL&#125; routine\\_body</span><br></pre></td></tr></table></figure>\n<p>CREATE FUNCTION f1() RETURNS VARCHAR(30) RETURN DATE_FORMAT(NOW(),’%Y年%m月%d日 %H点:%i分:%s秒’); =&gt; 不带有参数的函数，返回格式为 ‘2017年05月09日 21点:26分:15秒’</p>\n<h3 id=\"关于函数体\"><a href=\"#关于函数体\" class=\"headerlink\" title=\"关于函数体\"></a>关于函数体</h3><ol>\n<li>函数体由合法的 SQL 语句构成</li>\n<li>函数体可以是简单的 SELECT 或 INSERT 语句</li>\n<li>函数体如果为复合结构，则使用 BEGIN…END 语句</li>\n<li>复合结构可以包含声明，循环，控制结构</li>\n</ol>\n<h3 id=\"删除函数\"><a href=\"#删除函数\" class=\"headerlink\" title=\"删除函数\"></a>删除函数</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DROP FUNCTION \\[IF EXISTS\\] function_name</span><br></pre></td></tr></table></figure>\n<h2 id=\"MySQL命令执行过程\"><a href=\"#MySQL命令执行过程\" class=\"headerlink\" title=\"MySQL命令执行过程\"></a>MySQL命令执行过程</h2><div align=\"center\"><img src=\"/images/hexo_post_211.png\" alt=\"\" width=\"400\"></div>\n\n<h2 id=\"存储过程\"><a href=\"#存储过程\" class=\"headerlink\" title=\"存储过程\"></a>存储过程</h2><p>存储过程是 SQL 语句和控制语句的预编译集合，以一个名称存储并作为一个单元处理</p>\n<h3 id=\"存储过程的优点\"><a href=\"#存储过程的优点\" class=\"headerlink\" title=\"存储过程的优点\"></a>存储过程的优点</h3><ol>\n<li>增强 SQL 语句的功能和灵活性</li>\n<li>实现较快的执行速度</li>\n<li>减少网络流量</li>\n</ol>\n<h3 id=\"创建存储过程\"><a href=\"#创建存储过程\" class=\"headerlink\" title=\"创建存储过程\"></a>创建存储过程</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE \\[DEFINER = &#123;user | CURRENT\\_USER&#125;\\] PROCEDURE sp\\_name (\\[proc\\_parameter\\[,...\\]\\]) \\[characteristic ...\\] routine\\_body</span><br></pre></td></tr></table></figure>\n<p>和创建自定义函数类似，最大的不同就是参数部分不同</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">proc\\_parameter:\\[IN | OUT | INOUT\\] param\\_name <span class=\"built_in\">type</span></span><br></pre></td></tr></table></figure>\n<p>IN -&gt; 表示该参数的值必须在调用存储过程时指定<br>OUT -&gt; 表示该参数的值可以被存储过程改变，并且可以返回<br>INOUT -&gt; 表示该参数的调用时指定，并且可以被改变和返回</p>\n<h3 id=\"过程体\"><a href=\"#过程体\" class=\"headerlink\" title=\"过程体\"></a>过程体</h3><ol>\n<li>过程体由合法的 SQL 语句构成</li>\n<li>过程体可以是任意 SQL 语句</li>\n<li>过程体如果为复合结构则使用 BEGIN…END 语句</li>\n<li>复合结构可以包含声明，循环，控制结构</li>\n</ol>\n<h3 id=\"调用存储过程\"><a href=\"#调用存储过程\" class=\"headerlink\" title=\"调用存储过程\"></a>调用存储过程</h3><ul>\n<li>CALL sp_name([parameter[,…]])</li>\n<li>CALL sp_name[()]</li>\n</ul>\n<h3 id=\"修改存储过程\"><a href=\"#修改存储过程\" class=\"headerlink\" title=\"修改存储过程\"></a>修改存储过程</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER PROCEDURE sp_name \\[characteristic ...\\] COMMENT <span class=\"string\">'string'</span> | &#123;CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA&#125; | SQL SECURITY &#123; DEFINER | INVOKER &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"删除存储过程\"><a href=\"#删除存储过程\" class=\"headerlink\" title=\"删除存储过程\"></a>删除存储过程</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DROP PROCEDURE \\[IF EXISTS\\] sp_name</span><br></pre></td></tr></table></figure>\n<h3 id=\"实例\"><a href=\"#实例\" class=\"headerlink\" title=\"实例\"></a>实例</h3><p>CREATE PROCEDURE sp1() SELECTION VERSION(); -&gt; 创建存储体<br>CALL sp1; -&gt; 调用存储体</p>\n","more":"<h2 id=\"MySQL-基础\"><a href=\"#MySQL-基础\" class=\"headerlink\" title=\"MySQL 基础\"></a>MySQL 基础</h2><p>由瑞典 MySQL AB 公司开发，目前属于 Oracle 公司，MySQL 是一个开源的<strong>关系型</strong>数据库管理系统，分为社区版和企业版</p>\n<h2 id=\"MySQL-一些常用参数\"><a href=\"#MySQL-一些常用参数\" class=\"headerlink\" title=\"MySQL 一些常用参数\"></a>MySQL 一些常用参数</h2><table>\n<thead>\n<tr>\n<th>参数</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>-D，–database=name</td>\n<td>打开指定数据库</td>\n</tr>\n<tr>\n<td>–delimiter=name</td>\n<td>指定分隔符</td>\n</tr>\n<tr>\n<td>-h，–host=name</td>\n<td>服务器名称</td>\n</tr>\n<tr>\n<td>-p，–password[=name]</td>\n<td>密码</td>\n</tr>\n<tr>\n<td>-P，–port=#</td>\n<td>端口号</td>\n</tr>\n<tr>\n<td>–prompt=name</td>\n<td>设置提示符</td>\n</tr>\n<tr>\n<td>-u，–user=name</td>\n<td>用户名</td>\n</tr>\n<tr>\n<td>-V，–version</td>\n<td>输出版本信息并且退出</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"MySQL退出\"><a href=\"#MySQL退出\" class=\"headerlink\" title=\"MySQL退出\"></a>MySQL退出</h3><ul>\n<li>mysql &gt; exit;</li>\n<li>mysql &gt; quit;</li>\n<li>mysql &gt; \\q;</li>\n</ul>\n<h3 id=\"修改-MySQL-提示符\"><a href=\"#修改-MySQL-提示符\" class=\"headerlink\" title=\"修改 MySQL 提示符\"></a>修改 MySQL 提示符</h3><p>连接客户端时通过参数指定提示符：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shell&gt;mysql -uroot -proot --prompt</span><br></pre></td></tr></table></figure>\n<p>连接上客户端后，通过 prompt 命令修改提示符：mysql&gt;prompt，MySQL 提示符修改时可以用到的一些参数：</p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>\\D</td>\n<td>完整的日期</td>\n</tr>\n<tr>\n<td>\\d</td>\n<td>当前数据库</td>\n</tr>\n<tr>\n<td>\\h</td>\n<td>服务器名称</td>\n</tr>\n<tr>\n<td>\\u</td>\n<td>当前用户</td>\n</tr>\n</tbody>\n</table>\n<div align=\"center\"><img src=\"/images/hexo_post_207.png\" alt=\"\" width=\"500\"></div>\n\n<h3 id=\"修改数据表的默认存储引擎\"><a href=\"#修改数据表的默认存储引擎\" class=\"headerlink\" title=\"修改数据表的默认存储引擎\"></a>修改数据表的默认存储引擎</h3><p>找到 MySQL 配置文件：default-storage-engine=INNODB，修改完之后需要重启 MySQL</p>\n<h2 id=\"MySQL-语句的规范\"><a href=\"#MySQL-语句的规范\" class=\"headerlink\" title=\"MySQL 语句的规范\"></a>MySQL 语句的规范</h2><ul>\n<li>关键字与函数名称全部大写</li>\n<li>数据库名称、表名称、字段名称全部小写</li>\n<li>SQL 语句必须以分号结尾</li>\n</ul>\n<h2 id=\"数据类型\"><a href=\"#数据类型\" class=\"headerlink\" title=\"数据类型\"></a>数据类型</h2><ol>\n<li>字符型</li>\n<li>整型</li>\n<li>浮点型</li>\n<li>日期时间型</li>\n</ol>\n<h2 id=\"MySQL-常用命令\"><a href=\"#MySQL-常用命令\" class=\"headerlink\" title=\"MySQL 常用命令\"></a>MySQL 常用命令</h2><ul>\n<li>显示当前服务器版本：SELECT VERSION();</li>\n<li>显示当前日期时间：SELECT NOW();</li>\n<li>显示当前用户：SELECT USER();</li>\n</ul>\n<h3 id=\"创建数据库\"><a href=\"#创建数据库\" class=\"headerlink\" title=\"创建数据库\"></a>创建数据库</h3><ul>\n<li>|：表示可以互换的两项</li>\n<li>[]：表示可选项</li>\n<li>{}：表示必选项</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE &#123;DATABASE | SCHEMA&#125; \\[IF NOT EXISTS\\] db\\_name \\[DEFAULT\\] CHARACTER SET \\[=\\] charset\\_name</span><br></pre></td></tr></table></figure>\n<p>DATABASE | SCHEMA：这两个完全相同，任选其一即可<br>IF NOT EXISTS：可选项，如果存在就不创建，不存在才会创建<br>CHARACTER：设置编码格式，例如 utf-8，gbk</p>\n<h3 id=\"查看当前服务器下的数据表列表\"><a href=\"#查看当前服务器下的数据表列表\" class=\"headerlink\" title=\"查看当前服务器下的数据表列表\"></a>查看当前服务器下的数据表列表</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SHOW &#123;DATABASES | SCHEMAS&#125; \\[LIKE <span class=\"string\">'pattern'</span> | WHERE expr\\]</span><br></pre></td></tr></table></figure>\n<h3 id=\"修改数据库\"><a href=\"#修改数据库\" class=\"headerlink\" title=\"修改数据库\"></a>修改数据库</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER &#123;DATABASE | SCHEMA&#125; \\[db\\_name\\] \\[DEFAULT\\] CHARACTER SET \\[=\\] charset\\_name</span><br></pre></td></tr></table></figure>\n<p>通过以上语句可以修改某个数据库的编码格式</p>\n<h3 id=\"删除数据库\"><a href=\"#删除数据库\" class=\"headerlink\" title=\"删除数据库\"></a>删除数据库</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DROP &#123;DATABASE | SCHEMA&#125; \\[IF EXISTS\\] db_name</span><br></pre></td></tr></table></figure>\n<h3 id=\"打开数据库\"><a href=\"#打开数据库\" class=\"headerlink\" title=\"打开数据库\"></a>打开数据库</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">USE db_name</span><br></pre></td></tr></table></figure>\n<h3 id=\"创建数据表\"><a href=\"#创建数据表\" class=\"headerlink\" title=\"创建数据表\"></a>创建数据表</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE \\[IF NOT EXISTS\\] table\\_name( column\\_name data_type, .... )</span><br></pre></td></tr></table></figure>\n<h3 id=\"查看数据表列表\"><a href=\"#查看数据表列表\" class=\"headerlink\" title=\"查看数据表列表\"></a>查看数据表列表</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SHOW TABLES \\[FROM db_name\\] \\[LIKE <span class=\"string\">'pattern'</span> | WHERE expr\\]</span><br></pre></td></tr></table></figure>\n<p>FROM db_name：不仅可以查看当前数据库中的数据表，还可以查看其他数据库中的数据表</p>\n<h3 id=\"查看数据表结构\"><a href=\"#查看数据表结构\" class=\"headerlink\" title=\"查看数据表结构\"></a>查看数据表结构</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SHOW COLUMNS FROM tbl_name</span><br></pre></td></tr></table></figure>\n<p>tbl_name：数据表的名称</p>\n<h3 id=\"插入记录\"><a href=\"#插入记录\" class=\"headerlink\" title=\"插入记录\"></a>插入记录</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INSERT \\[INFO\\] tbl\\_name \\[(col\\_name,...)\\] VALUES(val,...)</span><br></pre></td></tr></table></figure>\n<p>如果省略 col_name (列名称)，就必须为所有字段都赋值</p>\n<h3 id=\"记录查找\"><a href=\"#记录查找\" class=\"headerlink\" title=\"记录查找\"></a>记录查找</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT expr,... FROM tbl_name</span><br></pre></td></tr></table></figure>\n<p>expr：表达式</p>\n<h2 id=\"字段属性设置\"><a href=\"#字段属性设置\" class=\"headerlink\" title=\"字段属性设置\"></a>字段属性设置</h2><h3 id=\"空值与非空\"><a href=\"#空值与非空\" class=\"headerlink\" title=\"空值与非空\"></a>空值与非空</h3><ul>\n<li>NULL：字段值可以为空（默认值）</li>\n<li>NOT NULL：字段值禁止为空</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE tbl_name(username VARCHAR(20) NOT NULL,age TINYINT UNSIGNED NULL);</span><br></pre></td></tr></table></figure>\n<div align=\"center\"><img src=\"/images/hexo_post_208.png\" alt=\"\" width=\"400\"></div>\n\n<h2 id=\"表级约束与列级约束\"><a href=\"#表级约束与列级约束\" class=\"headerlink\" title=\"表级约束与列级约束\"></a>表级约束与列级约束</h2><p>对一个数据列建立的约束，称为列级约束 对多个数据列建立的约束，称为表级约束 列级约束既可以在列定义时声明，也可以在列定义后声明 表级约束只能在列定义后声明</p>\n<h3 id=\"主键约束\"><a href=\"#主键约束\" class=\"headerlink\" title=\"主键约束\"></a>主键约束</h3><p>PRIMARY KEY：每张数据表只能存在一个主键，主键保证记录的唯一性，主键自动为 NOT NULL，主键不一定和下面的自动编号一起使用，但是不能赋相同的值</p>\n<h3 id=\"自动编号\"><a href=\"#自动编号\" class=\"headerlink\" title=\"自动编号\"></a>自动编号</h3><p>AUTO_INCREMENT：必须与主键组合使用，默认情况下，起始值为 1，每次的增量为 1，该字段的数据类型必须为数字，如果是浮点数必须小数位数为 0</p>\n<h3 id=\"唯一约束\"><a href=\"#唯一约束\" class=\"headerlink\" title=\"唯一约束\"></a>唯一约束</h3><p>UNIQUE KEY：可以保证记录的唯一性，字段可以为空值（NULL），每张数据表可以存在多个唯一约束</p>\n<h3 id=\"默认约束\"><a href=\"#默认约束\" class=\"headerlink\" title=\"默认约束\"></a>默认约束</h3><p>DEFAULT：当插入记录时，如果没有明确为字段赋值，则自动赋予默认值</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sex enum(<span class=\"string\">'1'</span>,<span class=\"string\">'2'</span>,<span class=\"string\">'3'</span>) DEFAULT <span class=\"string\">'3'</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"外键约束\"><a href=\"#外键约束\" class=\"headerlink\" title=\"外键约束\"></a>外键约束</h3><p>FOREIGN KEY：保持数据一致性和完整性，实现一对一或一对多关系</p>\n<h4 id=\"外键约束的要求\"><a href=\"#外键约束的要求\" class=\"headerlink\" title=\"外键约束的要求\"></a>外键约束的要求</h4><ol>\n<li>父表和子表必须使用相同的存储引擎，而且禁止使用临时表</li>\n<li>数据表的存储引擎只能为 InnoDB</li>\n<li>外键列和参照列必须具有相似的数据类型，其中数字的长度或是否有符号位必须相同；而字符的长度则可以不同</li>\n<li>外键列和参照列必须创建索引，如果外键列不存在索引的话，MySQL 将自动创建索引</li>\n</ol>\n<h4 id=\"外键约束的参照操作\"><a href=\"#外键约束的参照操作\" class=\"headerlink\" title=\"外键约束的参照操作\"></a>外键约束的参照操作</h4><ol>\n<li>CASCADE：从父表删除或更新且自动删除或更新子表中匹配的行</li>\n<li>SET NULL：从父表删除或更新行，并设置子表中的外键列为 NULL。如果使用该选项，必须保证子表列没有指定NOT NULL</li>\n<li>RESTRICT：拒绝对父表的删除或更新操作</li>\n<li>NO ACTION：标准 SQL 的关键字，在 MySQL 中与 RESTRICT 相同</li>\n</ol>\n<p>pid INT,FOREIGN KEY (pid) REFERENCES provinces (id) ON DELETE CASCADE =&gt; pid 为外键约束，参照数据表 provinces 中的 id 字段；并且删除时的参照操作为 CASCADE</p>\n<h2 id=\"修改数据表\"><a href=\"#修改数据表\" class=\"headerlink\" title=\"修改数据表\"></a>修改数据表</h2><h3 id=\"添加单列\"><a href=\"#添加单列\" class=\"headerlink\" title=\"添加单列\"></a>添加单列</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl\\_name ADD \\[COLUMN\\] col\\_name column\\_definition \\[FIRST | AFTER col\\_name\\]</span><br></pre></td></tr></table></figure>\n<p>FIRST：新添加的列将置于最前面<br>AFTER col_name：新添加的列将置于某一列后面<br>如果省略以上两项，新添加的列将位于所有列最后面</p>\n<h3 id=\"添加多列\"><a href=\"#添加多列\" class=\"headerlink\" title=\"添加多列\"></a>添加多列</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl\\_name ADD \\[COLUMN\\] (col\\_name column_definition,...)</span><br></pre></td></tr></table></figure>\n<p>添加多列时无法指定位置，只能位于最后面</p>\n<h3 id=\"删除列\"><a href=\"#删除列\" class=\"headerlink\" title=\"删除列\"></a>删除列</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl\\_name DROP \\[COLUMN\\] col\\_name</span><br></pre></td></tr></table></figure>\n<p>ALTER TABLE tbl_name DROP age,DROP password =&gt; 可以同时删除 age 列和 password 列</p>\n<h3 id=\"添加约束\"><a href=\"#添加约束\" class=\"headerlink\" title=\"添加约束\"></a>添加约束</h3><h4 id=\"添加主键约束\"><a href=\"#添加主键约束\" class=\"headerlink\" title=\"添加主键约束\"></a>添加主键约束</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl\\_name ADD \\[CONSTRAINT \\[symbol\\] \\] PRIMARY KEY \\[index\\_type\\] (index\\_col\\_name,...)</span><br></pre></td></tr></table></figure>\n<h4 id=\"添加唯一约束\"><a href=\"#添加唯一约束\" class=\"headerlink\" title=\"添加唯一约束\"></a>添加唯一约束</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl\\_name ADD \\[CONSTRAINT \\[symbol\\] \\] UNIQUE \\[INDEX | KEY\\] \\[index\\_name\\] \\[index\\_type\\] (index\\_col_name,...)</span><br></pre></td></tr></table></figure>\n<p>唯一约束可以给多列添加</p>\n<h4 id=\"添加外键约束\"><a href=\"#添加外键约束\" class=\"headerlink\" title=\"添加外键约束\"></a>添加外键约束</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl\\_name ADD \\[CONSTRAINT \\[symbol\\] \\] FOREIGN KEY \\[index\\_name\\] (index\\_col\\_name,...) reference_definition</span><br></pre></td></tr></table></figure>\n<h4 id=\"添加-删除默认约束\"><a href=\"#添加-删除默认约束\" class=\"headerlink\" title=\"添加/删除默认约束\"></a>添加/删除默认约束</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl\\_name ALTER \\[COLUMN\\] col\\_name &#123;SET DEFAULT literal | DROP DEFAULT&#125;</span><br></pre></td></tr></table></figure>\n<p>SET DEFAULT literal：添加默认约束<br>DROP DEFAULT：删除默认约束</p>\n<h3 id=\"删除约束\"><a href=\"#删除约束\" class=\"headerlink\" title=\"删除约束\"></a>删除约束</h3><h4 id=\"删除主键约束\"><a href=\"#删除主键约束\" class=\"headerlink\" title=\"删除主键约束\"></a>删除主键约束</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl_name DROP PRIMARY KEY</span><br></pre></td></tr></table></figure>\n<h4 id=\"删除唯一约束\"><a href=\"#删除唯一约束\" class=\"headerlink\" title=\"删除唯一约束\"></a>删除唯一约束</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl\\_name DROP &#123;INDEX | KEY&#125; index\\_name</span><br></pre></td></tr></table></figure>\n<p>一张表可以有多个唯一约束，所以需要查看约束的名字 =&gt; SHOW INDEXES FROM tbl_name [\\G];</p>\n<h4 id=\"删除外键约束\"><a href=\"#删除外键约束\" class=\"headerlink\" title=\"删除外键约束\"></a>删除外键约束</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl\\_name DROP FOREIGN KEY fk\\_symbol</span><br></pre></td></tr></table></figure>\n<p>fk_symbol：约束的名字，需要提前查看 =&gt; SHOW CREATE tbl_name</p>\n<h3 id=\"修改列定义\"><a href=\"#修改列定义\" class=\"headerlink\" title=\"修改列定义\"></a>修改列定义</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl\\_name MODIFY \\[COLUMN\\] col\\_name column\\_definition \\[FIRST | AFTER col\\_name\\]</span><br></pre></td></tr></table></figure>\n<p>可以修改数据类型以及数据列的位置</p>\n<h3 id=\"修改列名称\"><a href=\"#修改列名称\" class=\"headerlink\" title=\"修改列名称\"></a>修改列名称</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl\\_name CHANGE \\[COLUMN\\] old\\_col\\_name new\\_col\\_name column\\_definition \\[FIRST | AFTER col_name\\]</span><br></pre></td></tr></table></figure>\n<p>修改列名称的同时也可以修改列类型和位置，所以其功能要强大于修改列定义</p>\n<h3 id=\"数据表更名\"><a href=\"#数据表更名\" class=\"headerlink\" title=\"数据表更名\"></a>数据表更名</h3><p>尽量少更改数据表和数据列名字，因为如果创建过索引和约束，会影响到正常使用</p>\n<h4 id=\"方法1\"><a href=\"#方法1\" class=\"headerlink\" title=\"方法1\"></a>方法1</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl\\_name RENAME \\[TO | AS\\] new\\_tbl_name</span><br></pre></td></tr></table></figure>\n<h4 id=\"方法2\"><a href=\"#方法2\" class=\"headerlink\" title=\"方法2\"></a>方法2</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RENAME TABLE tbl\\_name TO new\\_tbl\\_name \\[,tbl\\_name2 TO new\\_tbl\\_name2\\] ...</span><br></pre></td></tr></table></figure>\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><div align=\"center\"><img src=\"/images/hexo_post_209.png\" alt=\"\" width=\"400\"></div>\n\n<h2 id=\"记录操作\"><a href=\"#记录操作\" class=\"headerlink\" title=\"记录操作\"></a>记录操作</h2><h3 id=\"插入记录-1\"><a href=\"#插入记录-1\" class=\"headerlink\" title=\"插入记录\"></a>插入记录</h3><h4 id=\"第一种\"><a href=\"#第一种\" class=\"headerlink\" title=\"第一种\"></a>第一种</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INSERT \\[INTO\\] tbl\\_name \\[(col\\_name,...)\\] &#123;VALUES | VALUE&#125; (&#123;expr | DEFAULT&#125;,...&#125;,(...),...</span><br></pre></td></tr></table></figure>\n<p>可以插入一条记录，也可以插入多条记录 INSERT users VALUES(NULL,’John’,’456’,25,1); =&gt; NULL 为空值，也可以为自增字段赋值（DEFAULT也可以）</p>\n<p>INSERT users VALUES(\bDEFAULT,’Tom’,’123’,3*7-5,1),(NULL,’Rose’,md5(‘123’),DEFAULT,0); =&gt; 插入多条记录，可以用表达式，也可以用函数、NULL、DEFAULT</p>\n<h4 id=\"第二种\"><a href=\"#第二种\" class=\"headerlink\" title=\"第二种\"></a>第二种</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INSERT \\[INTO\\] tbl\\_name SET col\\_name=&#123;expr | DEFAULT&#125;,...</span><br></pre></td></tr></table></figure>\n<p>与第一种方式的区别在于，此方法可以使用子查询(SubQuery)，但是此方法只能插入一条记录<br>INSERT users SET username=’Ben’,password=’456’; =&gt; 将这两条数据列插入users，其他数据列为默认值<br>INSERT test(username) SELECT username FROM users WHERE age&gt;=30; =&gt; 将 users 数据表中的 age &gt;= 30 的记录中的 username 数据列插入到 test 的 username 数据列中</p>\n<h3 id=\"第三种\"><a href=\"#第三种\" class=\"headerlink\" title=\"第三种\"></a>第三种</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INSERT \\[INTO\\] tbl\\_name \\[(col\\_name,...)\\] SELECT ...</span><br></pre></td></tr></table></figure>\n<p>此方法可以将查询结果插入到指定数据表</p>\n<h3 id=\"更新记录（单表更新）\"><a href=\"#更新记录（单表更新）\" class=\"headerlink\" title=\"更新记录（单表更新）\"></a>更新记录（单表更新）</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">UPDATE \\[LOW\\_PRIORITY\\] \\[IGNORE\\] table\\_reference SET col\\_name1=&#123;expr1 | DEFAULT&#125; \\[,col\\_name2=&#123;expr2 | DEFAULT&#125;\\] ... \\[WHERE where_condition\\]</span><br></pre></td></tr></table></figure>\n<p>UPDATE users SET age=age-id,sex=0 WHERE id%2=0; =&gt; 将 id 为偶数的记录的 age 设置为 age-id，sex 设置为 0</p>\n<h3 id=\"删除记录（单表删除）\"><a href=\"#删除记录（单表删除）\" class=\"headerlink\" title=\"删除记录（单表删除）\"></a>删除记录（单表删除）</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DELETE FROM tbl\\_name \\[WHERE <span class=\"built_in\">where</span>\\_condition\\]</span><br></pre></td></tr></table></figure>\n<h3 id=\"查找记录\"><a href=\"#查找记录\" class=\"headerlink\" title=\"查找记录\"></a>查找记录</h3><p>查找记录占据了 MySQL 语句的 80% 频率</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT select\\_expr \\[,select\\_expr ...\\] \\[ FROM table\\_references \\[WHERE <span class=\"built_in\">where</span>\\_condition\\] \\[GROUP BY &#123;col\\_name | position&#125; \\[ASC | DESC\\],...\\] \\[HAVING <span class=\"built_in\">where</span>\\_condition\\] \\[ORDER BY &#123;col\\_name | expr | position&#125; \\[ASC | DESC\\],...\\] \\[LIMIT &#123;\\[offset,\\] row\\_count | row_count OFFSET offset&#125;\\] \\]</span><br></pre></td></tr></table></figure>\n<h4 id=\"select-expr\"><a href=\"#select-expr\" class=\"headerlink\" title=\"select_expr\"></a>select_expr</h4><p>查询表达式</p>\n<ul>\n<li>每一个表达式表示想要的一列，必须有至少一个</li>\n<li>多个列之间以英文逗号分隔</li>\n<li>星号(<em>)表示所有列；tbl_name.</em> 可以表示命名表的所有列</li>\n<li>查询表达式可以使用 [AS] alias_name 为其赋予别名</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT username AS uname FROM users;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>别名可用于 GROUP BY,ORDRE BY 或 HAVING 子句</li>\n</ul>\n<h4 id=\"WHERE\"><a href=\"#WHERE\" class=\"headerlink\" title=\"WHERE\"></a>WHERE</h4><p>条件表达式 对记录进行过滤，如果没有指定WHERE子句，则显示所有记录 在 WHERE 表达式中，可以使用 MySQL 支持的函数或运算符</p>\n<h4 id=\"GROUP-BY\"><a href=\"#GROUP-BY\" class=\"headerlink\" title=\"GROUP BY\"></a>GROUP BY</h4><p>查询结果分组</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\\[GROUP BY &#123;col_name | position&#125; \\[ASC | DESC\\], ...\\]</span><br></pre></td></tr></table></figure>\n<p>既可以指定列名，也可以指定列的位置 ASC 为升序（默认），DESC 为降序</p>\n<h4 id=\"HAVING\"><a href=\"#HAVING\" class=\"headerlink\" title=\"HAVING\"></a>HAVING</h4><p>分组条件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\\[HAVING where_condition\\]</span><br></pre></td></tr></table></figure>\n<h4 id=\"ORDER-BY\"><a href=\"#ORDER-BY\" class=\"headerlink\" title=\"ORDER BY\"></a>ORDER BY</h4><p>对查询结果进行排序</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\\[ORDER BY &#123;col_name | expr | position&#125; \\[ASC | DESC\\],...\\]</span><br></pre></td></tr></table></figure>\n<p>可以指定多个数据列进行排序，当第一个数据列的值相同时，按照第二个数据列进行排序，以此类推……</p>\n<h4 id=\"LIMIT\"><a href=\"#LIMIT\" class=\"headerlink\" title=\"LIMIT\"></a>LIMIT</h4><p>限制查询结果返回的数量</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\\[LIMIT &#123;\\[offset,\\] row\\_count | row\\_count OFFSET offset&#125;\\]</span><br></pre></td></tr></table></figure>\n<p>SELECT * FROM users LIMIT 3,2; =&gt; 从索引值为 3（第四条记录）的记录开始返回两条记录</p>\n<h2 id=\"子查询\"><a href=\"#子查询\" class=\"headerlink\" title=\"子查询\"></a>子查询</h2><p>子查询(Subquery)是指出现在其他 SQL 语句内的 SELECT 子句<br>SELECT <em> FROM t1 WHERE col1 = (SELECT col2 FROM t2); =&gt; 其中SELECT </em> FROM t1 称为 Outer Query/Outer Statement,SELECT col2 FROM t2 称为 SubQuery</p>\n<ul>\n<li>子查询指嵌套在查询内部，且必须始终出现在圆括号内</li>\n<li>子查询可以包含多个关键字或条件，如 DISTINCT、GROUP BY、ORDER BY、LIMIT 函数等</li>\n<li>子查询的外层查询可以是：SELECT，INSERT，UPDATE，SET 或 DO</li>\n</ul>\n<h3 id=\"子查询返回值\"><a href=\"#子查询返回值\" class=\"headerlink\" title=\"子查询返回值\"></a>子查询返回值</h3><p>子查询可以返回标量、一行、一列或子查询</p>\n<h3 id=\"使用比较运算法的子查询\"><a href=\"#使用比较运算法的子查询\" class=\"headerlink\" title=\"使用比较运算法的子查询\"></a>使用比较运算法的子查询</h3><p>=、&gt;、&lt;、&gt;=、&lt;=、&lt;&gt;、!=、&lt;=&gt;</p>\n<h3 id=\"语法结构\"><a href=\"#语法结构\" class=\"headerlink\" title=\"语法结构\"></a>语法结构</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">operand comparison_operator subquery</span><br></pre></td></tr></table></figure>\n<h3 id=\"用-ANY、SOME-或-ALL-修饰的比较运算符\"><a href=\"#用-ANY、SOME-或-ALL-修饰的比较运算符\" class=\"headerlink\" title=\"用 ANY、SOME 或 ALL 修饰的比较运算符\"></a>用 ANY、SOME 或 ALL 修饰的比较运算符</h3><ol>\n<li>operand comparison_operator ANY (subquery)</li>\n<li>operand comparison_operator SOME (subquery)</li>\n<li>operand comparison_operator ALL (subquery)</li>\n</ol>\n<p>运算符和关键字相结合之后的结果类型：</p>\n<div align=\"center\"><img src=\"/images/hexo_post_210.png\" alt=\"\" width=\"400\"></div>\n\n<h3 id=\"使用-NOT-IN-的子查询\"><a href=\"#使用-NOT-IN-的子查询\" class=\"headerlink\" title=\"使用 [NOT] IN 的子查询\"></a>使用 [NOT] IN 的子查询</h3><h4 id=\"语法结构-1\"><a href=\"#语法结构-1\" class=\"headerlink\" title=\"语法结构\"></a>语法结构</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">operand comparison_operator \\[NOT\\] IN (subquery)</span><br></pre></td></tr></table></figure>\n<ul>\n<li>=ANY 运算符与 IN 等效</li>\n<li>!=ALL 或 &lt;&gt;ALL 运算符与 NOT IN 等效</li>\n</ul>\n<h3 id=\"使用-NOT-EXISTS-的子查询\"><a href=\"#使用-NOT-EXISTS-的子查询\" class=\"headerlink\" title=\"使用 [NOT] EXISTS 的子查询\"></a>使用 [NOT] EXISTS 的子查询</h3><p>如果子查询返回任何行，EXISTS 将返回 TRUE，否则为 FALSE</p>\n<h2 id=\"多表操作\"><a href=\"#多表操作\" class=\"headerlink\" title=\"多表操作\"></a>多表操作</h2><h3 id=\"多表更新\"><a href=\"#多表更新\" class=\"headerlink\" title=\"多表更新\"></a>多表更新</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">UPDATE table\\_references SET col\\_name1 = &#123;expr1 | DEFAULT&#125; \\[,col\\_name2= &#123;expr2 | DEFAULT&#125;\\] ...\\[WHERE <span class=\"built_in\">where</span>\\_condition\\]</span><br></pre></td></tr></table></figure>\n<h3 id=\"CREATE…SELECT\"><a href=\"#CREATE…SELECT\" class=\"headerlink\" title=\"CREATE…SELECT\"></a>CREATE…SELECT</h3><p>创建数据表同时将查询结果写入到数据表</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE \\[IF NOT EXISTS\\] tbl\\_name \\[(create\\_definition,...)\\] select_statement</span><br></pre></td></tr></table></figure>\n<p>CREATE TABLE tdb_goods_brands(brand_id SMALLINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,brand_name VARCHAR(40) NOT NULL) SELECT brand_name FROM tdb_goods GROUP BY brand_name; =&gt; 创建表 tdb_goods_brands 的同时将 tdb_goods 中的 brand_name 数据列的值赋给新表 tdb_goods_brands 中的 brand_name 数据列</p>\n<h3 id=\"表的连接\"><a href=\"#表的连接\" class=\"headerlink\" title=\"表的连接\"></a>表的连接</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">table\\_reference &#123;\\[INNER | CROSS\\] JOIN | &#123;LEFT | RIGHT&#125; \\[OUTER\\] JOIN&#125; table\\_reference ON conditional_expr</span><br></pre></td></tr></table></figure>\n<p>table_reference：连接的两张表的名字<br>conditional_expr：连接条件，使用 ON 关键字来设定连接条件，也可以使用 WHERE 来代替：通常使用 ON 关键字来设定连接条件，使用 WHERE 关键字进行结果集记录的过滤</p>\n<h4 id=\"连接类型\"><a href=\"#连接类型\" class=\"headerlink\" title=\"连接类型\"></a>连接类型</h4><ol>\n<li>INNER JOIN，内连接，在 MySQL 中，JOIN，CROSS JOIN 和 INNER JOIN 是等价的</li>\n<li>LEFT [OUTER] JOIN，左外连接</li>\n<li>RIGHT [OUTER] JOIN，右外连接</li>\n</ol>\n<p>UPDATE tdb_goods AS g INNER JOIN tdb_goods_brands AS b ON g.brand_name=b.brand_name SET g.brand_name=b.brand_id; =&gt; 按照 tdb_goods_brands (设置别名为 b)表更新 tdb_goods (设置别名为 g)表，连接条件为表 g 的brand_name 和表 b 的 brand_name 字段值相等，更新操作为将 g 中的 brand_name 更改为 b 中的 brand_id</p>\n<h4 id=\"内连接\"><a href=\"#内连接\" class=\"headerlink\" title=\"内连接\"></a>内连接</h4><p>仅显示左表及右表符合连接条件的记录（交集、公共部分）</p>\n<h4 id=\"左（右）外连接\"><a href=\"#左（右）外连接\" class=\"headerlink\" title=\"左（右）外连接\"></a>左（右）外连接</h4><p>显示左（右）表的全部记录及右（左）表符合连接条件的记录 A LEFT JOIN B join_condition 如果数据表 A 的某条记录符合 WHERE 条件，但是在数据表B不存在符合连接条件的记录，将生成一个所有列为空的额外的B行</p>\n<h3 id=\"多表删除\"><a href=\"#多表删除\" class=\"headerlink\" title=\"多表删除\"></a>多表删除</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DELETE tbl\\_name\\[.*\\] \\[,tbl\\_name\\[.*\\]\\] ... FROM table\\_references \\[WHERE <span class=\"built_in\">where</span>\\_condition\\]</span><br></pre></td></tr></table></figure>\n<h2 id=\"系统内置函数\"><a href=\"#系统内置函数\" class=\"headerlink\" title=\"系统内置函数\"></a>系统内置函数</h2><h3 id=\"字符函数\"><a href=\"#字符函数\" class=\"headerlink\" title=\"字符函数\"></a>字符函数</h3><table>\n<thead>\n<tr>\n<th>函数名称</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>CONCAT()</td>\n<td>字符连接</td>\n</tr>\n<tr>\n<td>CONCAT_WS()</td>\n<td>使用指定的分隔符进行字符连接</td>\n</tr>\n<tr>\n<td>FORMAT()</td>\n<td>数字格式化</td>\n</tr>\n<tr>\n<td>LOWER()</td>\n<td>转换成小写字母</td>\n</tr>\n<tr>\n<td>UPPER()</td>\n<td>转换成大写字母</td>\n</tr>\n<tr>\n<td>LEFT()</td>\n<td>获取左侧字符</td>\n</tr>\n<tr>\n<td>RIGHT()</td>\n<td>获取右侧字符</td>\n</tr>\n<tr>\n<td>LENGTH()</td>\n<td>获取字符串长度</td>\n</tr>\n<tr>\n<td>LTRIM()</td>\n<td>删除前导空格</td>\n</tr>\n<tr>\n<td>RTRIM()</td>\n<td>删除后续空格</td>\n</tr>\n<tr>\n<td>TRIM()</td>\n<td>删除前导和后续空格</td>\n</tr>\n<tr>\n<td>SUBSTRING()</td>\n<td>字符串截取</td>\n</tr>\n<tr>\n<td>[NOT] LIKE</td>\n<td>模式匹配</td>\n</tr>\n<tr>\n<td>REPLACE()</td>\n<td>字符串替换</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"CONCAT\"><a href=\"#CONCAT\" class=\"headerlink\" title=\"CONCAT()\"></a>CONCAT()</h3><p>SELECT CONCAT(first_name,last_name) AS fullname FROM test; =&gt; 将数据表 test 中的 first_name 和 last_name 中的数据连接到一起进行输出，并命名为 fullname</p>\n<h3 id=\"FORMAT\"><a href=\"#FORMAT\" class=\"headerlink\" title=\"FORMAT()\"></a>FORMAT()</h3><p>SELECT FORMAT(12560.75,2); =&gt; 转换成 12,560.75（千分位）<br>SELECT FORMAT(12560.75,1); =&gt; 转换成 12,560.8（四舍五入）<br>SELECT FORMAT(12560.75,0); =&gt; 转换成 12,561（取整）</p>\n<h3 id=\"TRIM\"><a href=\"#TRIM\" class=\"headerlink\" title=\"TRIM()\"></a>TRIM()</h3><p>除了删除首尾空格，还可以删除指定其他字符 SELECT TRIM(LEADING ‘?’ FROM ‘??MySQL???’); =&gt; MySQL???，LEADING 关键字代表前导，所以这句话的含义是删除字符串前面的’?’字符；将 LEADING 换为 TRAILING 表示去掉尾部相应字符，换为 BOTH 表示去掉首尾相应字符</p>\n<h3 id=\"NOT-LIKE\"><a href=\"#NOT-LIKE\" class=\"headerlink\" title=\"[NOT] LIKE\"></a>[NOT] LIKE</h3><p>SELECT <em> FROM test WHERE first_name LIKE ‘%o%’; => tom%，%相当于</em>，所以 LIKE 有点类似于正则匹配</p>\n<h3 id=\"数值运算符与函数\"><a href=\"#数值运算符与函数\" class=\"headerlink\" title=\"数值运算符与函数\"></a>数值运算符与函数</h3><table>\n<thead>\n<tr>\n<th>名称</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>CEIL()</td>\n<td>进一取整</td>\n</tr>\n<tr>\n<td>DIV</td>\n<td>整数除法</td>\n</tr>\n<tr>\n<td>FLOOR()</td>\n<td>舍一取整</td>\n</tr>\n<tr>\n<td>MOD</td>\n<td>取余数（取模）</td>\n</tr>\n<tr>\n<td>POWER()</td>\n<td>幂运算</td>\n</tr>\n<tr>\n<td>ROUND()</td>\n<td>四舍五入</td>\n</tr>\n<tr>\n<td>TRUNCATE()</td>\n<td>数字截取</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"TRUNCATE\"><a href=\"#TRUNCATE\" class=\"headerlink\" title=\"TRUNCATE()\"></a>TRUNCATE()</h3><p>数字截取，不会进行运算，TRUNCATE(125.89,0); => 125，TRUNCATE(125.89,-1); => 120</p>\n<h3 id=\"比较运算符与函数\"><a href=\"#比较运算符与函数\" class=\"headerlink\" title=\"比较运算符与函数\"></a>比较运算符与函数</h3><table>\n<thead>\n<tr>\n<th>名称</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>[NOT] BETWEEN…AND…</td>\n<td>[不]在范围之内</td>\n</tr>\n<tr>\n<td>[NOT] IN()</td>\n<td>[不]在列出值范围内</td>\n</tr>\n<tr>\n<td>IS [NOT] NULL</td>\n<td>[不]为空</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"日期时间函数\"><a href=\"#日期时间函数\" class=\"headerlink\" title=\"日期时间函数\"></a>日期时间函数</h3><table>\n<thead>\n<tr>\n<th>名称</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>NOW()</td>\n<td>当前日期和时间</td>\n</tr>\n<tr>\n<td>CURDATE()</td>\n<td>当前日期</td>\n</tr>\n<tr>\n<td>CURTIME()</td>\n<td>当前时间</td>\n</tr>\n<tr>\n<td>DATE_ADD()</td>\n<td>日期变化</td>\n</tr>\n<tr>\n<td>DATEDIFF()</td>\n<td>日期差值</td>\n</tr>\n<tr>\n<td>DATE_FORMAT()</td>\n<td>日期格式化</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"DATE-ADD\"><a href=\"#DATE-ADD\" class=\"headerlink\" title=\"DATE_ADD()\"></a>DATE_ADD()</h3><p>DATE_ADD(‘2014-3-12’,INTERVAL 3 \bWEEK); =&gt; 2014-04-02<br>DATE_ADD(‘2014-3-12’,INTERVAL -365 DAY); =&gt; 2013-3-12</p>\n<h3 id=\"DATEDIFF\"><a href=\"#DATEDIFF\" class=\"headerlink\" title=\"DATEDIFF()\"></a>DATEDIFF()</h3><p>DATEDIFF(‘2013-3-12’,’2014-3-12’); =&gt;-365</p>\n<h3 id=\"DATE-FORMAT\"><a href=\"#DATE-FORMAT\" class=\"headerlink\" title=\"DATE_FORMAT()\"></a>DATE_FORMAT()</h3><p>DATE_FORMAT(‘2014-3-2’,’%m/%d/%Y’); =&gt;03/02/2014</p>\n<h3 id=\"信息函数\"><a href=\"#信息函数\" class=\"headerlink\" title=\"信息函数\"></a>信息函数</h3><table>\n<thead>\n<tr>\n<th>名称</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>CONNECTION_ID()</td>\n<td>连接ID</td>\n</tr>\n<tr>\n<td>DATABASE()</td>\n<td>当前数据库</td>\n</tr>\n<tr>\n<td>LAST_INSERT_ID()</td>\n<td>最后插入记录的ID号</td>\n</tr>\n<tr>\n<td>USER()</td>\n<td>当前用户</td>\n</tr>\n<tr>\n<td>VERSION()</td>\n<td>版本信息</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"LAST-INSERT-ID\"><a href=\"#LAST-INSERT-ID\" class=\"headerlink\" title=\"LAST_INSERT_ID()\"></a>LAST_INSERT_ID()</h3><p>当使用该函数时，当前数据表中必须存在一个自增的字段，字段名可以不为 id，当同时写入多条记录时，只返回插入的第一条记录的 ID 值</p>\n<h3 id=\"聚合函数\"><a href=\"#聚合函数\" class=\"headerlink\" title=\"聚合函数\"></a>聚合函数</h3><table>\n<thead>\n<tr>\n<th>名称</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>AVG()</td>\n<td>平均值</td>\n</tr>\n<tr>\n<td>COUNT()</td>\n<td>计数</td>\n</tr>\n<tr>\n<td>MAX()</td>\n<td>最大值</td>\n</tr>\n<tr>\n<td>MIN()</td>\n<td>最小值</td>\n</tr>\n<tr>\n<td>SUM()</td>\n<td>求和</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"AVG\"><a href=\"#AVG\" class=\"headerlink\" title=\"AVG()\"></a>AVG()</h4><p>SELECT AVG(age) FROM test; =&gt; 返回 test 数据表中的 age 平均值</p>\n<h2 id=\"自定义函数\"><a href=\"#自定义函数\" class=\"headerlink\" title=\"自定义函数\"></a>自定义函数</h2><p>用户自定义函数（user-defined function,UDF）是一种对 MySQL 扩展的途径，其用法与内置函数相同</p>\n<h3 id=\"必要条件\"><a href=\"#必要条件\" class=\"headerlink\" title=\"必要条件\"></a>必要条件</h3><ol>\n<li>参数（理论上不超过 1024 个参数）</li>\n<li>返回值</li>\n</ol>\n<p>函数可以返回任意类型的值，同样可以接收这些类型的参数</p>\n<h3 id=\"创建自定义函数\"><a href=\"#创建自定义函数\" class=\"headerlink\" title=\"创建自定义函数\"></a>创建自定义函数</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE FUNCTION <span class=\"keyword\">function</span>\\_name RETURNS &#123;STRING | INTERGER | REAL | DECIMAL&#125; routine\\_body</span><br></pre></td></tr></table></figure>\n<p>CREATE FUNCTION f1() RETURNS VARCHAR(30) RETURN DATE_FORMAT(NOW(),’%Y年%m月%d日 %H点:%i分:%s秒’); =&gt; 不带有参数的函数，返回格式为 ‘2017年05月09日 21点:26分:15秒’</p>\n<h3 id=\"关于函数体\"><a href=\"#关于函数体\" class=\"headerlink\" title=\"关于函数体\"></a>关于函数体</h3><ol>\n<li>函数体由合法的 SQL 语句构成</li>\n<li>函数体可以是简单的 SELECT 或 INSERT 语句</li>\n<li>函数体如果为复合结构，则使用 BEGIN…END 语句</li>\n<li>复合结构可以包含声明，循环，控制结构</li>\n</ol>\n<h3 id=\"删除函数\"><a href=\"#删除函数\" class=\"headerlink\" title=\"删除函数\"></a>删除函数</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DROP FUNCTION \\[IF EXISTS\\] function_name</span><br></pre></td></tr></table></figure>\n<h2 id=\"MySQL命令执行过程\"><a href=\"#MySQL命令执行过程\" class=\"headerlink\" title=\"MySQL命令执行过程\"></a>MySQL命令执行过程</h2><div align=\"center\"><img src=\"/images/hexo_post_211.png\" alt=\"\" width=\"400\"></div>\n\n<h2 id=\"存储过程\"><a href=\"#存储过程\" class=\"headerlink\" title=\"存储过程\"></a>存储过程</h2><p>存储过程是 SQL 语句和控制语句的预编译集合，以一个名称存储并作为一个单元处理</p>\n<h3 id=\"存储过程的优点\"><a href=\"#存储过程的优点\" class=\"headerlink\" title=\"存储过程的优点\"></a>存储过程的优点</h3><ol>\n<li>增强 SQL 语句的功能和灵活性</li>\n<li>实现较快的执行速度</li>\n<li>减少网络流量</li>\n</ol>\n<h3 id=\"创建存储过程\"><a href=\"#创建存储过程\" class=\"headerlink\" title=\"创建存储过程\"></a>创建存储过程</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE \\[DEFINER = &#123;user | CURRENT\\_USER&#125;\\] PROCEDURE sp\\_name (\\[proc\\_parameter\\[,...\\]\\]) \\[characteristic ...\\] routine\\_body</span><br></pre></td></tr></table></figure>\n<p>和创建自定义函数类似，最大的不同就是参数部分不同</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">proc\\_parameter:\\[IN | OUT | INOUT\\] param\\_name <span class=\"built_in\">type</span></span><br></pre></td></tr></table></figure>\n<p>IN -&gt; 表示该参数的值必须在调用存储过程时指定<br>OUT -&gt; 表示该参数的值可以被存储过程改变，并且可以返回<br>INOUT -&gt; 表示该参数的调用时指定，并且可以被改变和返回</p>\n<h3 id=\"过程体\"><a href=\"#过程体\" class=\"headerlink\" title=\"过程体\"></a>过程体</h3><ol>\n<li>过程体由合法的 SQL 语句构成</li>\n<li>过程体可以是任意 SQL 语句</li>\n<li>过程体如果为复合结构则使用 BEGIN…END 语句</li>\n<li>复合结构可以包含声明，循环，控制结构</li>\n</ol>\n<h3 id=\"调用存储过程\"><a href=\"#调用存储过程\" class=\"headerlink\" title=\"调用存储过程\"></a>调用存储过程</h3><ul>\n<li>CALL sp_name([parameter[,…]])</li>\n<li>CALL sp_name[()]</li>\n</ul>\n<h3 id=\"修改存储过程\"><a href=\"#修改存储过程\" class=\"headerlink\" title=\"修改存储过程\"></a>修改存储过程</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER PROCEDURE sp_name \\[characteristic ...\\] COMMENT <span class=\"string\">'string'</span> | &#123;CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA&#125; | SQL SECURITY &#123; DEFINER | INVOKER &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"删除存储过程\"><a href=\"#删除存储过程\" class=\"headerlink\" title=\"删除存储过程\"></a>删除存储过程</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DROP PROCEDURE \\[IF EXISTS\\] sp_name</span><br></pre></td></tr></table></figure>\n<h3 id=\"实例\"><a href=\"#实例\" class=\"headerlink\" title=\"实例\"></a>实例</h3><p>CREATE PROCEDURE sp1() SELECTION VERSION(); -&gt; 创建存储体<br>CALL sp1; -&gt; 调用存储体</p>\n","categories":[{"name":"慕课网","path":"api/categories/慕课网.json"}],"tags":[{"name":"mysql","path":"api/tags/mysql.json"},{"name":"数据库","path":"api/tags/数据库.json"}]}